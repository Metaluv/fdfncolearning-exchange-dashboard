<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Co-learning Exchange Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-dark': '#0f0f0f',
                        'secondary-dark': '#1a1a1a',
                        'tertiary-dark': '#252525',
                        'accent-blue': '#3b82f6',
                        'accent-blue-light': '#60a5fa',
                        'accent-blue-dark': '#2563eb',
                        'text-primary': '#e5e5e5',
                        'text-secondary': '#a3a3a3',
                        'text-tertiary': '#737373',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'slide-in': 'slideIn 0.3s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)' },
                            '100%': { transform: 'translateX(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        ::-webkit-scrollbar-thumb {
            background: #404040;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Smooth transitions */
        * {
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        /* Sidebar collapsed state styling */
        .sidebar-collapsed .nav-item {
            justify-content: center;
            padding: 0.75rem;
        }
        
        .sidebar-collapsed .nav-item i {
            margin: 0;
            font-size: 1.25rem;
        }
        
        .sidebar-collapsed .nav-item span {
            display: none;
        }
        
        .sidebar-collapsed .nav-item.active::after {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 24px;
            background-color: #3b82f6;
            border-radius: 0 2px 2px 0;
        }
        
        /* Responsive table styles */
        @media (max-width: 768px) {
            .table-container {
                font-size: 0.875rem;
            }
            
            table th, table td {
                padding: 0.5rem !important;
                font-size: 0.75rem;
            }
            
            .hide-mobile {
                display: none !important;
            }
        }
        
        @media (max-width: 640px) {
            /* Main content padding on mobile */
            #mainContent > div {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            /* Header adjustments */
            header {
                padding: 0.75rem;
            }
            
            /* Table responsiveness */
            table {
                font-size: 0.75rem;
            }
            
            table th, table td {
                padding: 0.5rem !important;
                white-space: nowrap;
            }
            
            /* Hide less important columns on very small screens */
            .hide-mobile {
                display: none;
            }
            
            /* Better scrolling for tables */
            .overflow-x-auto {
                -webkit-overflow-scrolling: touch;
                scrollbar-width: thin;
            }
            
            /* Table wrapper on mobile */
            .table-container {
                margin: 0 -1rem;
            }
            
            .table-container .overflow-x-auto {
                padding: 0 0.5rem;
            }
            
            /* Minimum table width on mobile */
            table {
                min-width: 500px;
            }
            
            /* Sticky table headers */
            thead th {
                position: sticky;
                top: 0;
                background-color: #252525;
                z-index: 10;
            }
            
            /* Card padding adjustments */
            .bg-secondary-dark {
                padding: 1rem;
            }
            
            /* Button text on mobile */
            .mobile-compact {
                font-size: 0.875rem;
                padding: 0.5rem 1rem;
            }
        }
        
        /* Sidebar collapsed state styles */
        #sidebar.lg\\:w-16 .nav-item {
            justify-content: center;
        }
        
        #sidebar.lg\\:w-16 .nav-item i {
            margin-right: 0;
        }
        
        /* Smooth transitions for width changes */
        #sidebar, #mainContent {
            transition: all 300ms ease-in-out;
        }
        
        /* Drag and drop styles */
        .draggable-event {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .draggable-event:active {
            cursor: grabbing;
        }
        
        .draggable-event.dragging {
            opacity: 0.5;
            transform: rotate(2deg);
        }
        
        .drop-zone {
            min-height: 50px;
            transition: all 0.3s ease;
        }
        
        .drop-zone.drag-over {
            background-color: rgba(59, 130, 246, 0.1);
            border: 2px dashed rgb(59, 130, 246);
            border-radius: 8px;
            padding: 8px;
        }
    </style>
</head>
<body class="bg-primary-dark text-text-primary font-sans antialiased">
    <!-- Main Container -->
    <div class="flex h-screen overflow-hidden">
        
        <!-- Left Sidebar -->
        <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-secondary-dark border-r border-tertiary-dark z-30 transform transition-all duration-300 -translate-x-full lg:translate-x-0 lg:w-64">
            <div class="h-full flex flex-col">
                <!-- Logo/Brand with Collapse Button -->
                <div class="p-6 border-b border-tertiary-dark flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-accent-blue">Co-learning Exchange</h1>
                        <p class="text-sm text-text-secondary mt-1">June 10-14, 2025</p>
                    </div>
                    <!-- Desktop Collapse Button -->
                    <button onclick="toggleSidebarDesktop()" class="hidden lg:block p-2 rounded-lg hover:bg-tertiary-dark transition-colors">
                        <i class="fas fa-chevron-left text-text-secondary" id="sidebarToggleIcon"></i>
                    </button>
                </div>
                
                <!-- Navigation -->
                <nav class="flex-1 overflow-y-auto p-4">
                    <ul class="space-y-2">
                        <li>
                            <a href="#overview" onclick="showSection('overview', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-home w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Overview</span>
                            </a>
                        </li>
                        <li>
                            <a href="#participants" onclick="showSection('participants', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-users w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Participants</span>
                            </a>
                        </li>
                        <li>
                            <a href="#organizations" onclick="showSection('organizations', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-building w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Organizations</span>
                            </a>
                        </li>
                        <li>
                            <a href="#accommodations" onclick="showSection('accommodations', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-bed w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Accommodations</span>
                            </a>
                        </li>
                        <li>
                            <a href="#health" onclick="showSection('health', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-heartbeat w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Health & Safety</span>
                            </a>
                        </li>
                        <li>
                            <a href="#financial" onclick="showSection('financial', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-file-invoice-dollar w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Financial</span>
                            </a>
                        </li>
                        <li>
                            <a href="#agenda" onclick="showSection('agenda', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-calendar-alt w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Agenda</span>
                            </a>
                        </li>
                        <li>
                            <a href="#menu" onclick="showSection('menu', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-utensils w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Menu</span>
                            </a>
                        </li>
                        <li>
                            <a href="#changelog" onclick="showSection('changelog', event)" class="nav-item flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark group">
                                <i class="fas fa-history w-5 text-text-secondary group-hover:text-accent-blue"></i>
                                <span class="text-text-primary group-hover:text-accent-blue">Changelog</span>
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- User Profile -->
                <div class="p-4 border-t border-tertiary-dark">
                    <div class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-tertiary-dark cursor-pointer">
                        <div class="w-10 h-10 rounded-full bg-accent-blue flex items-center justify-center">
                            <i class="fas fa-user text-white"></i>
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium">Event Admin</p>
                            <p class="text-xs text-text-secondary">FDFN Coordinator</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Mobile Overlay -->
        <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden lg:hidden" onclick="toggleSidebar()"></div>
        
        <!-- Main Content Area -->
        <main class="flex-1 transition-all duration-300 lg:ml-64 h-screen overflow-y-auto" id="mainContent">
            <!-- Top Header -->
            <header class="sticky top-0 z-10 bg-secondary-dark border-b border-tertiary-dark px-3 sm:px-6 py-3 sm:py-4">
                <div class="flex items-center justify-between">
                    <!-- Mobile Menu Button / Desktop Expand Button -->
                    <button onclick="toggleSidebar()" class="p-2 rounded-lg hover:bg-tertiary-dark transition-colors">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    
                    <!-- Search Bar -->
                    <div class="flex-1 max-w-2xl mx-2 sm:mx-4">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search participants, organizations..." class="w-full bg-tertiary-dark text-text-primary px-3 sm:px-4 py-2 pl-10 sm:pl-12 pr-3 rounded-lg text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-accent-blue">
                            <i class="fas fa-search absolute left-3 sm:left-4 top-1/2 transform -translate-y-1/2 text-text-secondary"></i>
                            <!-- Search Results Dropdown -->
                            <div id="searchResults" class="absolute top-full mt-1 w-full bg-secondary-dark rounded-lg shadow-lg border border-tertiary-dark hidden max-h-96 overflow-y-auto z-50">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Header Actions -->
                    <div class="flex items-center space-x-4">
                        <button onclick="refreshData()" class="p-2 rounded-lg hover:bg-tertiary-dark">
                            <i class="fas fa-sync-alt text-xl"></i>
                        </button>
                        <button class="p-2 rounded-lg hover:bg-tertiary-dark relative">
                            <i class="fas fa-bell text-xl"></i>
                            <span class="absolute top-0 right-0 w-2 h-2 bg-accent-blue rounded-full"></span>
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Dashboard Content -->
            <div class="p-3 sm:p-6 animate-fade-in">
                <!-- Overview Section -->
                <section id="overview" class="block">
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-8">
                        <!-- Total Participants -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg hover:shadow-xl hover:scale-105">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 bg-accent-blue bg-opacity-20 rounded-lg">
                                    <i class="fas fa-users text-accent-blue text-xl"></i>
                                </div>
                                <span class="text-sm text-green-400">Active</span>
                            </div>
                            <h3 id="totalParticipants" class="text-2xl font-bold mb-1">35</h3>
                            <p class="text-text-secondary text-sm">Total Participants</p>
                        </div>
                        
                        <!-- Total Revenue -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg hover:shadow-xl hover:scale-105">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 bg-accent-blue bg-opacity-20 rounded-lg">
                                    <i class="fas fa-dollar-sign text-accent-blue text-xl"></i>
                                </div>
                                <span class="text-sm text-green-400">CAD</span>
                            </div>
                            <h3 id="totalRevenue" class="text-2xl font-bold mb-1">$22,869.50</h3>
                            <p class="text-text-secondary text-sm">Revenue (before tax)</p>
                            <p class="text-sm text-yellow-400 mt-1">$25,385.15 with tax</p>
                        </div>
                        
                        <!-- Organizations -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg hover:shadow-xl hover:scale-105">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 bg-accent-blue bg-opacity-20 rounded-lg">
                                    <i class="fas fa-building text-accent-blue text-xl"></i>
                                </div>
                                <span class="text-sm text-blue-400">Partners</span>
                            </div>
                            <h3 id="totalOrganizations" class="text-2xl font-bold mb-1">7</h3>
                            <p class="text-text-secondary text-sm">Organizations</p>
                        </div>
                        
                        <!-- Average Cost -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg hover:shadow-xl hover:scale-105">
                            <div class="flex items-center justify-between mb-4">
                                <div class="p-3 bg-accent-blue bg-opacity-20 rounded-lg">
                                    <i class="fas fa-chart-line text-accent-blue text-xl"></i>
                                </div>
                                <span class="text-sm text-yellow-400">Avg</span>
                            </div>
                            <h3 id="avgCost" class="text-2xl font-bold mb-1">$653.41</h3>
                            <p class="text-text-secondary text-sm">Avg Cost/Person</p>
                        </div>
                    </div>
                    
                    <!-- Charts Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <!-- Organizations Chart -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                            <h2 class="text-xl font-semibold mb-6">Participants by Organization</h2>
                            <div class="h-64">
                                <canvas id="orgChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Accommodations Chart -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                            <h2 class="text-xl font-semibold mb-6">Accommodation Types</h2>
                            <div class="h-64">
                                <canvas id="accommodationChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Participants Table -->
                <section id="participants" class="mb-8 hidden">
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold">Participants List</h2>
                            <div class="flex space-x-2">
                                <select id="orgFilter" class="bg-tertiary-dark text-text-primary px-3 py-1 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-blue">
                                    <option value="">All Organizations</option>
                                </select>
                                <button onclick="toggleTableEdit('participants')" id="editParticipantsBtn" class="px-4 py-1 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark">
                                    <i class="fas fa-edit mr-2"></i>Edit
                                </button>
                                <button onclick="saveTableChanges('participants')" id="saveParticipantsBtn" class="hidden px-4 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600">
                                    <i class="fas fa-save mr-2"></i>Save
                                </button>
                                <button onclick="cancelTableEdit('participants')" id="cancelParticipantsBtn" class="hidden px-4 py-1 bg-red-500 text-white rounded-lg hover:bg-red-600">
                                    <i class="fas fa-times mr-2"></i>Cancel
                                </button>
                                <button onclick="exportParticipantsPDF()" class="px-4 py-1 bg-purple-500 text-white rounded-lg hover:bg-purple-600">
                                    <i class="fas fa-file-pdf mr-2"></i>PDF
                                </button>
                            </div>
                        </div>
                        <div class="relative table-container">
                            <div class="overflow-x-auto overflow-y-auto max-h-96 rounded-lg border border-tertiary-dark">
                                <table class="w-full min-w-[600px]">
                                    <thead class="bg-tertiary-dark sticky top-0 z-10">
                                        <tr class="border-b border-secondary-dark">
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue whitespace-nowrap" onclick="sortTable('participant_id')">
                                                <span class="hidden sm:inline">#</span>
                                                <span class="sm:hidden">#</span>
                                                <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortTable('name')">
                                                Name <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue hidden sm:table-cell" onclick="sortTable('organization')">
                                                <span class="hidden lg:inline">Organization</span>
                                                <span class="lg:hidden">Org</span>
                                                <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortTable('room_number')">
                                                Room <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortTable('total_cost')">
                                                Cost <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium hide-mobile">Dietary</th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium hide-mobile">Medical</th>
                                        </tr>
                                    </thead>
                                    <tbody id="participantsTable">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-2 text-sm text-text-secondary">
                                <i class="fas fa-info-circle mr-1"></i>
                                Scroll to view all <span id="participantCount">35</span> participants
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Organizations Section -->
                <section id="organizations" class="mb-8 hidden">
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                        <!-- Populated by JavaScript -->
                    </div>
                </section>
                
                <!-- Accommodations Section -->
                <section id="accommodations" class="mb-8 hidden">
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold">Accommodations Detail</h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleAccommodationsEdit()" id="editAccommodationsBtn" class="px-4 py-2 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors">
                                    <i class="fas fa-edit mr-2"></i>Edit
                                </button>
                                <button onclick="saveAccommodationsChanges()" id="saveAccommodationsBtn" class="hidden px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                                    <i class="fas fa-save mr-2"></i>Save
                                </button>
                                <button onclick="cancelAccommodationsEdit()" id="cancelAccommodationsBtn" class="hidden px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                                    <i class="fas fa-times mr-2"></i>Cancel
                                </button>
                            </div>
                        </div>
                        <div class="relative table-container">
                            <div class="overflow-x-auto overflow-y-auto max-h-96 rounded-lg border border-tertiary-dark">
                                <table class="w-full min-w-[500px]">
                                    <thead class="bg-tertiary-dark sticky top-0 z-10">
                                        <tr class="border-b border-secondary-dark">
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortAccommodations('room_number')">
                                                Room <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortAccommodations('room_type')">
                                                Type <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortAccommodations('current_occupancy')">
                                                <span class="hidden sm:inline">Occupancy</span>
                                                <span class="sm:hidden">Occ.</span>
                                                <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortAccommodations('price_per_night')">
                                                <span class="hidden sm:inline">Price/Night</span>
                                                <span class="sm:hidden">$/N</span>
                                                <i class="fas fa-sort text-xs ml-1"></i>
                                            </th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium hide-mobile">Total Revenue</th>
                                        </tr>
                                    </thead>
                                    <tbody id="accommodationsTable">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="mt-2 text-sm text-text-secondary">
                                <i class="fas fa-info-circle mr-1"></i>
                                Total of 24 accommodations across 4 types
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Health & Safety Summary -->
                <section id="health" class="mb-8 hidden">
                    <!-- Weather Widget -->
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-semibold">
                                <i class="fas fa-cloud-sun mr-2"></i>Weather Forecast - Meadow Lake Provincial Park
                            </h2>
                            <button onclick="refreshWeather()" class="px-3 py-1 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors text-sm">
                                <i class="fas fa-sync-alt mr-1"></i>Refresh
                            </button>
                        </div>
                        <p class="text-sm text-text-secondary mb-4">Near Dorintosh, SK - Event Dates: June 10-14, 2025</p>
                        <div id="weatherWidget" class="space-y-4">
                            <!-- Weather content will be populated by JavaScript -->
                            <div class="text-center py-8">
                                <i class="fas fa-spinner fa-spin text-4xl text-accent-blue"></i>
                                <p class="mt-2 text-text-secondary">Loading weather data...</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fire Information Widget -->
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-semibold">
                                <i class="fas fa-fire mr-2 text-orange-500"></i>Fire Ban & Safety Information
                            </h2>
                            <div class="flex space-x-2">
                                <a href="https://wfm.gov.sk.ca/static/public/MunicipalFireBans.pdf" target="_blank" class="px-3 py-1 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors text-sm">
                                    <i class="fas fa-file-pdf mr-1"></i>View PDF
                                </a>
                                <button onclick="refreshFireInfo()" class="px-3 py-1 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors text-sm">
                                    <i class="fas fa-sync-alt mr-1"></i>Refresh
                                </button>
                            </div>
                        </div>
                        <p class="text-sm text-text-secondary mb-4">Meadow Lake Provincial Park - Current Fire Restrictions</p>
                        <div id="fireInfoWidget">
                            <!-- Fire information will be populated by JavaScript -->
                            <div class="bg-tertiary-dark rounded-lg p-6">
                                <div class="flex items-start space-x-4">
                                    <div class="flex-shrink-0">
                                        <div id="fireStatusIcon" class="text-5xl">
                                            <i class="fas fa-fire-extinguisher text-green-500"></i>
                                        </div>
                                    </div>
                                    <div class="flex-grow">
                                        <h3 id="fireStatusTitle" class="text-lg font-semibold mb-2">Fire Ban Status: Loading...</h3>
                                        <div id="fireStatusDetails" class="space-y-2 text-sm text-text-secondary">
                                            <p>Checking current fire restrictions...</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                    <div class="bg-primary-dark rounded-lg p-4">
                                        <h4 class="font-medium mb-2 text-yellow-400">
                                            <i class="fas fa-exclamation-triangle mr-2"></i>Fire Safety Tips
                                        </h4>
                                        <ul class="text-sm text-text-secondary space-y-1">
                                            <li>• Always check current fire bans before lighting any fire</li>
                                            <li>• Keep water or sand nearby when having campfires</li>
                                            <li>• Ensure fires are completely extinguished</li>
                                            <li>• Report wildfires immediately: 1-800-667-9660</li>
                                        </ul>
                                    </div>
                                    <div class="bg-primary-dark rounded-lg p-4">
                                        <h4 class="font-medium mb-2 text-blue-400">
                                            <i class="fas fa-phone-alt mr-2"></i>Emergency Contacts
                                        </h4>
                                        <ul class="text-sm text-text-secondary space-y-1">
                                            <li>• Wildfire Report Line: <strong>1-800-667-9660</strong></li>
                                            <li>• Emergency: <strong>911</strong></li>
                                            <li>• Park Office: <strong>306-236-7680</strong></li>
                                            <li>• Non-Emergency RCMP: <strong>306-236-2570</strong></li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="mt-4 p-3 bg-yellow-900 bg-opacity-20 border border-yellow-600 rounded-lg">
                                    <p class="text-xs text-yellow-400">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Fire ban information is subject to change. Always verify current conditions with local authorities before any outdoor burning.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Park Safety Information -->
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-semibold">
                                <i class="fas fa-tree mr-2 text-green-500"></i>Meadow Lake Provincial Park Safety Guide
                            </h2>
                            <button onclick="toggleParkInfo()" class="px-3 py-1 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors text-sm">
                                <i class="fas fa-chevron-down mr-1" id="parkInfoToggleIcon"></i>View All
                            </button>
                        </div>
                        
                        <div id="parkSafetyInfo" class="space-y-4">
                            <!-- Bear Safety -->
                            <div class="bg-tertiary-dark rounded-lg p-4 border-l-4 border-orange-500">
                                <h3 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-paw mr-2 text-orange-500"></i>Bear Safety
                                </h3>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <h4 class="font-medium mb-2 text-yellow-400">Prevention</h4>
                                        <ul class="text-sm text-text-secondary space-y-1">
                                            <li>• Make noise while hiking (talk, clap, sing)</li>
                                            <li>• Travel in groups when possible</li>
                                            <li>• Store all food in bear-proof containers</li>
                                            <li>• Never feed bears or leave food out</li>
                                            <li>• Keep your campsite clean</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="font-medium mb-2 text-red-400">If You Encounter a Bear</h4>
                                        <ul class="text-sm text-text-secondary space-y-1">
                                            <li>• Do NOT run - back away slowly</li>
                                            <li>• Make yourself appear large</li>
                                            <li>• Avoid direct eye contact</li>
                                            <li>• Speak in calm, firm tones</li>
                                            <li>• If attacked: PLAY DEAD (black bears may require fighting back)</li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="mt-3 p-2 bg-orange-900 bg-opacity-20 rounded text-xs text-orange-400">
                                    <i class="fas fa-info-circle mr-1"></i>Black bears are common in the area. Report sightings to park staff immediately.
                                </div>
                            </div>
                            
                            <!-- Wildlife Safety -->
                            <div class="bg-tertiary-dark rounded-lg p-4 border-l-4 border-green-500">
                                <h3 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-deer mr-2 text-green-500"></i>Wildlife Encounters
                                </h3>
                                <div class="text-sm text-text-secondary space-y-2">
                                    <p><strong>Common Wildlife:</strong> Moose, deer, wolves, foxes, beavers, and various bird species</p>
                                    <ul class="space-y-1 mt-2">
                                        <li>• Observe wildlife from a safe distance (min. 30m)</li>
                                        <li>• Never approach or feed wild animals</li>
                                        <li>• Be especially cautious during dawn and dusk</li>
                                        <li>• Moose can be aggressive - give them extra space</li>
                                        <li>• Store food securely to avoid attracting animals</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Water Safety -->
                            <div class="bg-tertiary-dark rounded-lg p-4 border-l-4 border-blue-500">
                                <h3 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-water mr-2 text-blue-500"></i>Water & Lake Safety
                                </h3>
                                <div class="grid md:grid-cols-2 gap-4 text-sm text-text-secondary">
                                    <div>
                                        <h4 class="font-medium mb-2 text-blue-400">Swimming & Boating</h4>
                                        <ul class="space-y-1">
                                            <li>• No lifeguards on duty - swim at own risk</li>
                                            <li>• Wear life jackets when boating</li>
                                            <li>• Water temperature can be cold even in summer</li>
                                            <li>• Watch for underwater hazards</li>
                                            <li>• Children must be supervised at all times</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="font-medium mb-2 text-blue-400">Drinking Water</h4>
                                        <ul class="space-y-1">
                                            <li>• Bring bottled water or purification tablets</li>
                                            <li>• Do not drink untreated lake water</li>
                                            <li>• Boil water for min. 1 minute if needed</li>
                                            <li>• Park taps are safe for drinking</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Insect Protection -->
                            <div class="bg-tertiary-dark rounded-lg p-4 border-l-4 border-purple-500 parkInfoCollapsible hidden">
                                <h3 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-bug mr-2 text-purple-500"></i>Insect Protection
                                </h3>
                                <div class="grid md:grid-cols-2 gap-4 text-sm text-text-secondary">
                                    <div>
                                        <h4 class="font-medium mb-2 text-purple-400">Mosquitoes & Black Flies</h4>
                                        <ul class="space-y-1">
                                            <li>• Peak season: June-July (event timing!)</li>
                                            <li>• Use DEET-based repellents</li>
                                            <li>• Wear long sleeves/pants at dawn/dusk</li>
                                            <li>• Light-colored clothing recommended</li>
                                            <li>• Consider bug nets for extreme conditions</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="font-medium mb-2 text-purple-400">Tick Prevention</h4>
                                        <ul class="space-y-1">
                                            <li>• Check for ticks after outdoor activities</li>
                                            <li>• Tuck pants into socks when hiking</li>
                                            <li>• Stay on marked trails</li>
                                            <li>• Wood ticks are common May-July</li>
                                            <li>• Remove ticks promptly with tweezers</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Trail Safety -->
                            <div class="bg-tertiary-dark rounded-lg p-4 border-l-4 border-yellow-500 parkInfoCollapsible hidden">
                                <h3 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-hiking mr-2 text-yellow-500"></i>Trail & Outdoor Safety
                                </h3>
                                <div class="text-sm text-text-secondary space-y-2">
                                    <ul class="space-y-1">
                                        <li>• Stay on marked trails to prevent getting lost</li>
                                        <li>• Inform someone of your hiking plans</li>
                                        <li>• Carry a map, compass, or GPS device</li>
                                        <li>• Bring extra water and snacks</li>
                                        <li>• Wear appropriate footwear</li>
                                        <li>• Be prepared for weather changes</li>
                                        <li>• Cell service is limited in many areas</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <!-- Emergency Information -->
                            <div class="bg-tertiary-dark rounded-lg p-4 border-l-4 border-red-500 parkInfoCollapsible hidden">
                                <h3 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-first-aid mr-2 text-red-500"></i>Emergency Information
                                </h3>
                                <div class="grid md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <h4 class="font-medium mb-2 text-red-400">Medical Facilities</h4>
                                        <ul class="text-text-secondary space-y-1">
                                            <li>• Nearest Hospital: Meadow Lake (30 min)</li>
                                            <li>• Park First Aid: Main Office</li>
                                            <li>• Cell Coverage: Limited/Spotty</li>
                                            <li>• Emergency Phone at Park Office</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="font-medium mb-2 text-red-400">Emergency Contacts</h4>
                                        <ul class="text-text-secondary space-y-1">
                                            <li>• Emergency: <strong>911</strong></li>
                                            <li>• Park Office: <strong>306-236-7680</strong></li>
                                            <li>• Conservation Officer: <strong>1-800-667-7561</strong></li>
                                            <li>• Health Link: <strong>811</strong></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Park Rules -->
                            <div class="bg-tertiary-dark rounded-lg p-4 border-l-4 border-gray-500 parkInfoCollapsible hidden">
                                <h3 class="font-semibold text-lg mb-3 flex items-center">
                                    <i class="fas fa-clipboard-list mr-2 text-gray-500"></i>Park Rules & Regulations
                                </h3>
                                <div class="text-sm text-text-secondary">
                                    <ul class="space-y-1">
                                        <li>• Quiet hours: 11:00 PM - 7:00 AM</li>
                                        <li>• Pets must be leashed at all times</li>
                                        <li>• No drones without permit</li>
                                        <li>• Fishing requires valid Saskatchewan license</li>
                                        <li>• Maximum 8 people per campsite</li>
                                        <li>• No washing dishes in lake or washrooms</li>
                                        <li>• Pack out all garbage - Leave No Trace</li>
                                        <li>• Alcohol permitted at campsites only</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Dietary Requirements -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                            <h2 class="text-xl font-semibold mb-4">Dietary Requirements</h2>
                            <div id="dietaryList" class="space-y-2 max-h-64 overflow-y-auto">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Allergies -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                            <h2 class="text-xl font-semibold mb-4">Allergies</h2>
                            <div id="allergyList" class="space-y-2 max-h-64 overflow-y-auto">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                        
                        <!-- Certifications -->
                        <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                            <h2 class="text-xl font-semibold mb-4">Emergency Certifications</h2>
                            <div id="certificationsList" class="space-y-2">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Menu Section -->
                <section id="menu" class="mb-8 hidden">
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-semibold">
                                <i class="fas fa-utensils mr-2"></i>Event Menu & Catering
                            </h2>
                            <div class="flex space-x-2">
                                <button onclick="toggleMenuEdit()" id="editMenuBtn" class="px-3 sm:px-4 py-2 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors text-sm sm:text-base">
                                    <i class="fas fa-edit mr-1 sm:mr-2"></i>Edit
                                </button>
                                <button onclick="saveMenuChanges()" id="saveMenuBtn" class="hidden px-3 sm:px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm sm:text-base">
                                    <i class="fas fa-save mr-1 sm:mr-2"></i>Save
                                </button>
                                <button onclick="cancelMenuEdit()" id="cancelMenuBtn" class="hidden px-3 sm:px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm sm:text-base">
                                    <i class="fas fa-times mr-1 sm:mr-2"></i>Cancel
                                </button>
                                <button onclick="exportMenuPDF()" class="px-3 sm:px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm sm:text-base">
                                    <i class="fas fa-file-pdf mr-1 sm:mr-2"></i><span class="hidden sm:inline">Export </span>PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="relative table-container">
                            <div class="overflow-x-auto overflow-y-auto max-h-96 rounded-lg border border-tertiary-dark">
                                <table class="w-full min-w-[600px]">
                                    <thead class="bg-tertiary-dark sticky top-0 z-10">
                                        <tr class="border-b border-secondary-dark">
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium">Date</th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium">Meal</th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium w-2/5">Description</th>
                                            <th class="text-right py-3 px-4 text-text-secondary font-medium">Cost</th>
                                            <th class="text-center py-3 px-4 text-text-secondary font-medium">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="menuTable">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-tertiary-dark rounded-lg p-4">
                                <h3 class="text-lg font-semibold mb-3">Menu Summary</h3>
                                <div class="space-y-2">
                                    <div class="flex justify-between items-center">
                                        <span class="text-text-secondary">Total Menu Cost:</span>
                                        <span id="totalMenuCost" class="font-bold text-green-400">$0.00</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-text-secondary">GST (5%):</span>
                                        <span id="menuGST" class="font-bold">$0.00</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-text-secondary">PST (6%):</span>
                                        <span id="menuPST" class="font-bold">$0.00</span>
                                    </div>
                                    <div class="flex justify-between items-center pt-2 border-t border-secondary-dark">
                                        <span class="text-text-primary font-semibold">Total with Tax:</span>
                                        <span id="menuTotalWithTax" class="font-bold text-accent-blue">$0.00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-tertiary-dark rounded-lg p-4">
                                <h3 class="text-lg font-semibold mb-3">Add Menu Item</h3>
                                <div class="space-y-3">
                                    <input type="date" id="menuItemDate" class="w-full px-3 py-2 bg-secondary-dark text-text-primary rounded border border-tertiary-dark focus:border-accent-blue focus:outline-none">
                                    <input type="text" id="menuItemMeal" placeholder="Meal type (e.g., Welcome Supper)" class="w-full px-3 py-2 bg-secondary-dark text-text-primary rounded border border-tertiary-dark focus:border-accent-blue focus:outline-none">
                                    <textarea id="menuItemDescription" placeholder="Description" rows="2" class="w-full px-3 py-2 bg-secondary-dark text-text-primary rounded border border-tertiary-dark focus:border-accent-blue focus:outline-none"></textarea>
                                    <input type="number" id="menuItemCost" placeholder="Cost" step="0.01" class="w-full px-3 py-2 bg-secondary-dark text-text-primary rounded border border-tertiary-dark focus:border-accent-blue focus:outline-none">
                                    <button onclick="addMenuItem()" class="w-full px-4 py-2 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors">
                                        <i class="fas fa-plus mr-2"></i>Add Menu Item
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Grocery Shopping List Section -->
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg mt-6">
                        <h2 class="text-xl font-semibold mb-6">
                            <i class="fas fa-shopping-cart mr-2"></i>Grocery Shopping List (35 Participants)
                        </h2>
                        
                        <!-- Dietary Restrictions Summary -->
                        <div class="mb-4 p-4 bg-yellow-900/20 rounded-lg border border-yellow-600/30">
                            <h3 class="font-semibold text-yellow-400 mb-2">Dietary Restrictions to Consider:</h3>
                            <ul class="text-sm text-yellow-300/80 space-y-1">
                                <li>• 4 Vegetarians (Rebecca, Teresa, Veg eat fish: Sarah D, Kevin)</li>
                                <li>• 1 Vegan (Grace)</li>
                                <li>• 1 No pork (Destiny)</li>
                                <li>• 1 Lactose intolerant (Brenda)</li>
                                <li>• 1 Diabetic (Joe - No veg oil)</li>
                                <li>• 1 No seafood/potatoes/carrots (Brenda)</li>
                                <li>• 1 Avocado allergy (Adam)</li>
                            </ul>
                        </div>

                        <!-- Shopping List Table -->
                        <div class="relative table-container">
                            <div class="overflow-x-auto overflow-y-auto max-h-96 rounded-lg border border-tertiary-dark">
                                <table class="w-full min-w-[800px]">
                                    <thead class="bg-tertiary-dark sticky top-0 z-10">
                                        <tr class="border-b border-secondary-dark">
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium">Category</th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium">Item</th>
                                            <th class="text-right py-3 px-4 text-text-secondary font-medium">Quantity</th>
                                            <th class="text-left py-3 px-4 text-text-secondary font-medium">Dietary Adjustments</th>
                                            <th class="text-right py-3 px-4 text-text-secondary font-medium">Est. Price</th>
                                        </tr>
                                    </thead>
                                    <tbody id="shoppingListTable">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                    <tfoot class="bg-tertiary-dark">
                                        <tr class="border-t-2 border-secondary-dark">
                                            <td colspan="4" class="py-3 px-4 text-right font-semibold">Total Estimated Cost:</td>
                                            <td class="py-3 px-4 text-right font-bold text-green-400" id="shoppingListTotal">$0.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-sm text-text-secondary">
                            <p>* Prices are estimates based on average Canadian grocery costs (2025)</p>
                            <p>* Quantities adjusted for dietary restrictions and 35 participants over 4 days</p>
                        </div>
                    </div>
                </section>
                
                <!-- Changelog Section -->
                <section id="changelog" class="mb-8 hidden">
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                        <h2 class="text-xl font-semibold mb-6">
                            <i class="fas fa-history mr-2"></i>Dashboard Changelog
                        </h2>
                        <div class="space-y-6">
                            <!-- Version 1.9.0 -->
                            <div class="border-l-4 border-indigo-400 pl-4">
                                <h3 class="text-lg font-semibold text-indigo-400">Version 1.9.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 9, 2025 - Latest</p>
                                <ul class="text-sm space-y-1 list-disc list-inside">
                                    <li>
                                        <span class="text-accent-blue font-medium">Feature:</span>
                                        <span>Added PDF export functionality for agenda</span>
                                    </li>
                                    <li>
                                        <span class="text-red-400 font-medium">Feature:</span>
                                        <span>Added Saskatchewan PST (6%) and GST (5%) tax calculations</span>
                                    </li>
                                    <li>
                                        <span class="text-red-400 font-medium">Fix:</span>
                                        <span>Corrected all event dates (June 10-14 is Tuesday-Saturday)</span>
                                    </li>
                                    <li>
                                        <span class="text-green-400 font-medium">Mobile:</span>
                                        <span>Enhanced mobile responsiveness with scrollable content</span>
                                    </li>
                                    <li>
                                        <span class="text-yellow-400 font-medium">Tables:</span>
                                        <span>Improved table responsiveness with better mobile layouts</span>
                                    </li>
                                    <li>
                                        <span class="text-purple-400 font-medium">Financial:</span>
                                        <span>Dynamic tax calculations that update with data changes</span>
                                    </li>
                                    <li>
                                        <span class="text-orange-400 font-medium">Technical:</span>
                                        <span>Added smooth scrolling and sticky headers for tables</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.8.0 -->
                            <div class="border-l-4 border-pink-400 pl-4">
                                <h3 class="text-lg font-semibold text-pink-400">Version 1.8.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 9, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-calendar-plus text-pink-400 mt-1 mr-2"></i>
                                        <span>Added ability to add and remove time blocks in agenda</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-clock text-pink-400 mt-1 mr-2"></i>
                                        <span>Each day can have unlimited time blocks added or removed</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-calendar-day text-pink-400 mt-1 mr-2"></i>
                                        <span>Can add or remove entire days from the agenda</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-seedling text-green-400 mt-1 mr-2"></i>
                                        <span>Updated agenda to focus on Flying Dust Market Garden activities</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-drumstick-bite text-pink-400 mt-1 mr-2"></i>
                                        <span>Added bison processing and value-added production workshops</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.7.0 -->
                            <div class="border-l-4 border-indigo-400 pl-4">
                                <h3 class="text-lg font-semibold text-indigo-400">Version 1.7.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 9, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-table text-indigo-400 mt-1 mr-2"></i>
                                        <span>Made all tables editable with inline cell editing</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-sort text-indigo-400 mt-1 mr-2"></i>
                                        <span>Added sortable columns for all tables (Participants, Organizations, Accommodations)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-save text-green-400 mt-1 mr-2"></i>
                                        <span>Table changes persist in browser local storage</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-sync text-indigo-400 mt-1 mr-2"></i>
                                        <span>Real-time updates to statistics when editing data</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-mobile-alt text-indigo-400 mt-1 mr-2"></i>
                                        <span>Improved responsive design for all tables on mobile devices</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-building text-indigo-400 mt-1 mr-2"></i>
                                        <span>Organizations section now uses table layout with editing capabilities</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.6.0 -->
                            <div class="border-l-4 border-teal-400 pl-4">
                                <h3 class="text-lg font-semibold text-teal-400">Version 1.6.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 8, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-scroll text-teal-400 mt-1 mr-2"></i>
                                        <span>Made agenda section scrollable for better navigation</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-edit text-teal-400 mt-1 mr-2"></i>
                                        <span>Added inline editing capability for all agenda content</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-save text-green-400 mt-1 mr-2"></i>
                                        <span>Auto-save to browser local storage for persistent changes</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-plus-circle text-teal-400 mt-1 mr-2"></i>
                                        <span>Add/remove detail items for each agenda event</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.5.0 -->
                            <div class="border-l-4 border-red-400 pl-4">
                                <h3 class="text-lg font-semibold text-red-400">Version 1.5.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 8, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-calendar-alt text-red-400 mt-1 mr-2"></i>
                                        <span>Added comprehensive agenda section for June 10-14, 2025 event</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-clock text-red-400 mt-1 mr-2"></i>
                                        <span>Detailed daily schedules with times, locations, and activities</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-users text-red-400 mt-1 mr-2"></i>
                                        <span>Presentation topics for all participating organizations</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-info-circle text-yellow-400 mt-1 mr-2"></i>
                                        <span>Important notes and guidelines for participants</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.4.0 -->
                            <div class="border-l-4 border-purple-400 pl-4">
                                <h3 class="text-lg font-semibold text-purple-400">Version 1.4.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 8, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-percentage text-purple-400 mt-1 mr-2"></i>
                                        <span>Applied 15% discount to all room rates</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-users text-purple-400 mt-1 mr-2"></i>
                                        <span>Shared rooms now split costs among occupants</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-calculator text-purple-400 mt-1 mr-2"></i>
                                        <span>Recalculated all participant costs with per-person rates</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-dollar-sign text-green-400 mt-1 mr-2"></i>
                                        <span>Total revenue: $22,869.50 (accommodation: $17,008.50)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-chart-line text-yellow-400 mt-1 mr-2"></i>
                                        <span>Average cost per participant: $653.41</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.3.0 -->
                            <div class="border-l-4 border-green-400 pl-4">
                                <h3 class="text-lg font-semibold text-green-400">Version 1.3.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 8, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-dollar-sign text-green-400 mt-1 mr-2"></i>
                                        <span>Updated room rates based on official pricing CSV</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                                        <span>Cabins: $300/night (was $75-100)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                                        <span>Family Suite: $275/night (was $92)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                                        <span>Overflow Rooms: $275/night (was $137.50)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-chart-line text-yellow-400 mt-1 mr-2"></i>
                                        <span>Total revenue increased to $38,431 (from $23,408)</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.2.0 -->
                            <div class="border-l-4 border-accent-blue pl-4">
                                <h3 class="text-lg font-semibold text-accent-blue">Version 1.2.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 8, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                                        <span>Added changelog section to track updates</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                                        <span>Made all tables scrollable with improved styling</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-green-400 mt-1 mr-2"></i>
                                        <span>Fixed navigation tab functionality</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.1.0 -->
                            <div class="border-l-4 border-text-secondary pl-4">
                                <h3 class="text-lg font-semibold">Version 1.1.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 8, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-plus text-blue-400 mt-1 mr-2"></i>
                                        <span>Added Organizations section with detailed breakdown</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-plus text-blue-400 mt-1 mr-2"></i>
                                        <span>Added Accommodations section with room details</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-bug text-yellow-400 mt-1 mr-2"></i>
                                        <span>Fixed chart height overflow issues</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-bug text-yellow-400 mt-1 mr-2"></i>
                                        <span>Fixed page reload issues</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <!-- Version 1.0.0 -->
                            <div class="border-l-4 border-text-tertiary pl-4">
                                <h3 class="text-lg font-semibold">Version 1.0.0</h3>
                                <p class="text-sm text-text-secondary mb-2">June 8, 2025</p>
                                <ul class="space-y-1 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-rocket text-purple-400 mt-1 mr-2"></i>
                                        <span>Initial release of Co-learning Exchange Dashboard</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-database text-purple-400 mt-1 mr-2"></i>
                                        <span>Integrated attendance data from CSV file</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-chart-bar text-purple-400 mt-1 mr-2"></i>
                                        <span>Added interactive charts for organizations and accommodations</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-users text-purple-400 mt-1 mr-2"></i>
                                        <span>Created participant management with search and filter</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-heartbeat text-purple-400 mt-1 mr-2"></i>
                                        <span>Added health & safety tracking features</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="mt-8 p-4 bg-tertiary-dark rounded-lg">
                            <p class="text-sm text-text-secondary">
                                <i class="fas fa-info-circle mr-2"></i>
                                This dashboard was created for the Flying Dust First Nation Co-learning Exchange event, June 10-14, 2025.
                            </p>
                        </div>
                    </div>
                </section>
                
                <!-- Financial Summary Section -->
                <section id="financial" class="mb-8 hidden">
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                        <h2 class="text-xl font-semibold mb-6">
                            <i class="fas fa-file-invoice-dollar mr-2"></i>Financial Summary
                        </h2>
                        
                        <!-- Revenue Breakdown -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <!-- Accommodation Revenue -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Accommodation Revenue</h3>
                                <div id="accommodationRevenueDisplay" class="space-y-3">
                                    <!-- Populated dynamically -->
                                </div>
                                
                                <!-- Honorarium Section -->
                                <h3 class="text-lg font-semibold mb-4 mt-6">Presenter & Community Honorarium</h3>
                                <div class="space-y-3" id="honorariumRevenue">
                                    <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                                        <span class="flex items-center">
                                            <i class="fas fa-hand-holding-heart mr-2 text-purple-400"></i>Honorarium Fee per Participant
                                        </span>
                                        <span class="font-bold text-green-400">$250.00</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                                        <span class="flex items-center">
                                            <i class="fas fa-users mr-2 text-purple-400"></i>Total Participants
                                        </span>
                                        <span class="font-bold">35</span>
                                    </div>
                                    <div class="flex justify-between items-center p-3 bg-purple-400 bg-opacity-20 rounded font-bold">
                                        <span>Total Honorarium Revenue</span>
                                        <span id="totalHonorariumRevenue" class="text-purple-400">$0.00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Food Service Revenue -->
                            <div>
                                <h3 class="text-lg font-semibold mb-4">Food Service Revenue</h3>
                                <div id="foodServiceRevenue" class="space-y-3">
                                    <!-- Populated dynamically from menu data -->
                                </div>
                                
                                <!-- Grand Total -->
                                <div class="mt-6 p-4 bg-green-400 bg-opacity-10 rounded-lg border border-green-400">
                                    <div class="flex justify-between items-center">
                                        <span class="text-lg font-bold">Event Subtotal</span>
                                        <span id="eventSubtotal" class="text-2xl font-bold text-green-400">$22,869.50</span>
                                    </div>
                                    <p class="text-sm text-text-secondary mt-1">Based on 35 participants over 4 nights</p>
                                </div>
                                
                                <!-- Gratuity -->
                                <div class="mt-4 p-4 bg-yellow-400 bg-opacity-10 rounded-lg border border-yellow-400">
                                    <div class="flex justify-between items-center">
                                        <span class="font-bold">Gratuity (15%)</span>
                                        <span id="gratuityAmount" class="font-bold text-yellow-400">$0.00</span>
                                    </div>
                                    <div class="mt-2 border-t border-yellow-400 pt-2">
                                        <div class="flex justify-between items-center">
                                            <span class="font-bold">Subtotal with Gratuity</span>
                                            <span id="subtotalWithGratuity" class="font-bold text-yellow-400">$0.00</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tax Calculations -->
                                <div class="mt-6 p-4 bg-purple-400 bg-opacity-10 rounded-lg border border-purple-400">
                                    <h4 class="text-lg font-bold mb-3">Saskatchewan Tax Breakdown</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm">GST (5%)</span>
                                            <span id="gstAmount" class="font-bold text-purple-400">$1,143.48</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm">PST (6%)</span>
                                            <span id="pstAmount" class="font-bold text-purple-400">$1,372.17</span>
                                        </div>
                                        <div class="border-t border-purple-400 pt-2 mt-2">
                                            <div class="flex justify-between items-center">
                                                <span class="font-bold">Total Taxes (11%)</span>
                                                <span id="totalTaxes" class="font-bold text-purple-400">$2,515.65</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Final Total with Taxes -->
                                <div class="mt-4 p-4 bg-red-400 bg-opacity-10 rounded-lg border-2 border-red-400">
                                    <div class="flex justify-between items-center">
                                        <span class="text-xl font-bold">Total with Taxes</span>
                                        <span id="totalWithTaxes" class="text-3xl font-bold text-red-400">$25,385.15</span>
                                    </div>
                                    <p class="text-sm text-text-secondary mt-1">Includes GST (5%) and PST (6%)</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Daily Rate Card -->
                        <div class="mt-6 p-4 bg-tertiary-dark rounded-lg">
                            <h3 class="text-lg font-semibold mb-3">Daily Accommodation Rates (15% Discount Applied)</h3>
                            <div class="grid grid-cols-2 md:grid-cols-5 gap-3 text-sm">
                                <div class="text-center">
                                    <p class="text-text-secondary">Lodge Rooms</p>
                                    <p class="font-bold text-lg">$161.50</p>
                                    <p class="text-xs text-text-tertiary line-through">$190</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-text-secondary">Cabins</p>
                                    <p class="font-bold text-lg">$255.00</p>
                                    <p class="text-xs text-text-tertiary line-through">$300</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-text-secondary">Tipis</p>
                                    <p class="font-bold text-lg">$161.50</p>
                                    <p class="text-xs text-text-tertiary line-through">$190</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-text-secondary">Overflow</p>
                                    <p class="font-bold text-lg">$233.75</p>
                                    <p class="text-xs text-text-tertiary line-through">$275</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-text-secondary">Family Suite</p>
                                    <p class="font-bold text-lg">$233.75</p>
                                    <p class="text-xs text-text-tertiary line-through">$275</p>
                                </div>
                            </div>
                            <p class="text-xs text-text-secondary mt-3 text-center">
                                <i class="fas fa-info-circle mr-1"></i>
                                Shared rooms (Cabins & Family Suite) split the room rate among occupants
                            </p>
                        </div>
                    </div>
                </section>
                
                <!-- Agenda Section -->
                <section id="agenda" class="mb-8 hidden">
                    <div class="bg-secondary-dark rounded-xl p-4 sm:p-6 shadow-lg">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h2 class="text-xl font-semibold">
                                    <i class="fas fa-calendar-alt mr-2"></i>Market Garden Co-learning Exchange Agenda
                                </h2>
                                <p class="text-text-secondary mt-1">June 10-14, 2025</p>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="exportAgendaToPDF()" class="px-3 sm:px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors text-sm sm:text-base">
                                    <i class="fas fa-file-pdf mr-1 sm:mr-2"></i><span class="hidden sm:inline">Export </span>PDF
                                </button>
                                <button onclick="toggleAgendaEdit()" id="editAgendaBtn" class="px-3 sm:px-4 py-2 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors text-sm sm:text-base">
                                    <i class="fas fa-edit mr-1 sm:mr-2"></i>Edit
                                </button>
                                <button onclick="saveAgenda()" id="saveAgendaBtn" class="hidden px-3 sm:px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors text-sm sm:text-base">
                                    <i class="fas fa-save mr-1 sm:mr-2"></i>Save
                                </button>
                                <button onclick="cancelAgendaEdit()" id="cancelAgendaBtn" class="hidden px-3 sm:px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm sm:text-base">
                                    <i class="fas fa-times mr-1 sm:mr-2"></i>Cancel
                                </button>
                            </div>
                        </div>
                        
                        <!-- Scrollable container -->
                        <div class="overflow-y-auto max-h-[600px] pr-2" id="agendaContent">
                        
                        <!-- Day 1 - Tuesday -->
                        <div class="mb-8 border-l-4 border-accent-blue pl-4">
                            <h3 class="text-lg font-semibold text-accent-blue mb-3">Tuesday, June 10, 2025</h3>
                            <div class="space-y-3">
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">5:00 PM</span>
                                        <span class="text-sm text-text-secondary">Greig Lake - Meadow Lake Provincial Park</span>
                                    </div>
                                    <p class="text-sm">Students arriving from Edmonton by vans</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">5:30 PM</span>
                                        <span class="text-sm text-text-secondary">Community Fire Place - Lake Front</span>
                                    </div>
                                    <p class="text-sm">Supper - New York Steak Buffet</p>
                                    <p class="text-xs text-text-tertiary mt-1">Two seasonal green salads, potato salad, garlic toast, dessert, and Blueberry Ice tea</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">7:00 PM</span>
                                        <span class="text-sm text-text-secondary">Presentation Area</span>
                                    </div>
                                    <p class="text-sm">Introduction to Flying Dust Market Garden & Projects</p>
                                    <p class="text-xs text-text-tertiary mt-1">Soil Science presentation by Teresa Porter and Lauren Reynolds (UofS)</p>
                                    <p class="text-xs text-text-tertiary mt-1">Open sharing time for all participants</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">After Presentations</span>
                                        <span class="text-sm text-text-secondary">Various Locations</span>
                                    </div>
                                    <p class="text-sm">Free Time</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">10:30 PM - 12:00 AM</span>
                                        <span class="text-sm text-text-secondary">Accommodations</span>
                                    </div>
                                    <p class="text-sm">Bedtime</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Day 2 - Wednesday -->
                        <div class="mb-8 border-l-4 border-green-400 pl-4">
                            <h3 class="text-lg font-semibold text-green-400 mb-3">Wednesday, June 11, 2025</h3>
                            <div class="space-y-3">
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">7:00 AM - 9:00 AM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Breakfast</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">9:00 AM - 12:00 PM</span>
                                        <span class="text-sm text-text-secondary">Board Room</span>
                                    </div>
                                    <p class="text-sm font-medium mb-2">FDFN Market Garden Presentation</p>
                                    <ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">
                                        <li>Operations</li>
                                        <li>Lessons Learned</li>
                                        <li>Cold Frame Operations</li>
                                        <li>Transplanting Techniques</li>
                                        <li>Equipment & Processes</li>
                                        <li>Funding Opportunities</li>
                                        <li>Soil Health</li>
                                        <li>Questions & Answer Period</li>
                                    </ul>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">12:00 PM - 1:00 PM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Lunch</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">1:00 PM - 3:00 PM</span>
                                        <span class="text-sm text-text-secondary">Board Room</span>
                                    </div>
                                    <p class="text-sm font-medium mb-2">Kent State University Presentation</p>
                                    <ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">
                                        <li>Hoop House Design & Management</li>
                                        <li>Site Preparation & Installation Process</li>
                                        <li>Seasonal Planning & Crop Rotation</li>
                                        <li>Best Practices for Year-Round Growing</li>
                                    </ul>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">3:00 PM - 5:00 PM</span>
                                        <span class="text-sm text-text-secondary">Market Garden</span>
                                    </div>
                                    <p class="text-sm">Market Garden Tour</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">5:30 PM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Dinner & Cultural Activities</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Day 3 - Thursday -->
                        <div class="mb-8 border-l-4 border-yellow-400 pl-4">
                            <h3 class="text-lg font-semibold text-yellow-400 mb-3">Thursday, June 12, 2025</h3>
                            <div class="space-y-3">
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">7:00 AM - 9:00 AM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Breakfast</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">9:00 AM - 12:00 PM</span>
                                        <span class="text-sm text-text-secondary">Board Room</span>
                                    </div>
                                    <p class="text-sm font-medium mb-2">Pan-America University Presentation</p>
                                    <ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">
                                        <li>Traditional Indigenous Food Systems</li>
                                        <li>Blending Traditional & Contemporary Practices</li>
                                        <li>Strategies for Community Engagement</li>
                                        <li>Knowledge Transfer Methodologies</li>
                                        <li>Food Sovereignty Initiatives</li>
                                    </ul>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">12:00 PM - 1:00 PM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Lunch</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">1:00 PM - 3:00 PM</span>
                                        <span class="text-sm text-text-secondary">Board Room</span>
                                    </div>
                                    <p class="text-sm font-medium mb-2">University of Alberta Presentation</p>
                                    <ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">
                                        <li>Sustainable Agriculture Research</li>
                                        <li>Community Garden Models</li>
                                        <li>Student Engagement Programs</li>
                                        <li>Research & Development Opportunities</li>
                                    </ul>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">3:00 PM - 5:00 PM</span>
                                        <span class="text-sm text-text-secondary">Market Garden</span>
                                    </div>
                                    <p class="text-sm">Hands-On Workshop: Transplanting & Seeding Techniques</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">5:30 PM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Dinner & Evening Activities</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Day 4 - Friday -->
                        <div class="mb-8 border-l-4 border-purple-400 pl-4">
                            <h3 class="text-lg font-semibold text-purple-400 mb-3">Friday, June 13, 2025</h3>
                            <div class="space-y-3">
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">7:00 AM - 9:00 AM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Breakfast</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">9:00 AM - 12:00 PM</span>
                                        <span class="text-sm text-text-secondary">Board Room</span>
                                    </div>
                                    <p class="text-sm font-medium mb-2">University of Saskatchewan & Government of Saskatchewan</p>
                                    <ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">
                                        <li>Provincial Agriculture Programs</li>
                                        <li>Policy Development & Implementation</li>
                                        <li>Funding Opportunities & Support</li>
                                        <li>Research Partnerships</li>
                                    </ul>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">12:00 PM - 1:00 PM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Lunch</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">1:00 PM - 3:00 PM</span>
                                        <span class="text-sm text-text-secondary">Board Room</span>
                                    </div>
                                    <p class="text-sm font-medium mb-2">Other Participant Presentations & Discussion</p>
                                    <ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">
                                        <li>Saskatchewan Indian Institute of Technologies</li>
                                        <li>Makeway</li>
                                        <li>Open Discussion Forum</li>
                                    </ul>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">3:00 PM - 5:00 PM</span>
                                        <span class="text-sm text-text-secondary">Market Garden</span>
                                    </div>
                                    <p class="text-sm">Equipment Demonstration & Maintenance Workshop</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">5:30 PM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Feast & Cultural Sharing</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Day 5 - Saturday -->
                        <div class="mb-8 border-l-4 border-red-400 pl-4">
                            <h3 class="text-lg font-semibold text-red-400 mb-3">Saturday, June 14, 2025</h3>
                            <div class="space-y-3">
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">7:00 AM - 9:00 AM</span>
                                        <span class="text-sm text-text-secondary">Dining Room</span>
                                    </div>
                                    <p class="text-sm">Breakfast</p>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">9:00 AM - 11:00 AM</span>
                                        <span class="text-sm text-text-secondary">Board Room</span>
                                    </div>
                                    <p class="text-sm font-medium mb-2">Wrap-Up Session</p>
                                    <ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">
                                        <li>Knowledge Exchange Summary</li>
                                        <li>Next Steps & Action Items</li>
                                        <li>Partnership Opportunities</li>
                                        <li>Future Collaboration Planning</li>
                                        <li>Closing Ceremony</li>
                                    </ul>
                                </div>
                                <div class="bg-tertiary-dark rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">11:00 AM</span>
                                        <span class="text-sm text-text-secondary">Departure</span>
                                    </div>
                                    <p class="text-sm">Guest Departures</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Notes Section -->
                        <div class="mt-8 p-4 bg-tertiary-dark rounded-lg">
                            <h4 class="font-medium text-yellow-400 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>Important Notes
                            </h4>
                            <ul class="text-sm text-text-secondary space-y-1 list-disc list-inside">
                                <li>All sessions in the Board Room include refreshments</li>
                                <li>Weather-appropriate clothing recommended for outdoor activities</li>
                                <li>Hands-on workshops require closed-toe shoes</li>
                                <li>Evening cultural activities are optional but encouraged</li>
                                <li>Schedule subject to minor adjustments based on weather or participant needs</li>
                            </ul>
                        </div>
                        </div><!-- End scrollable container -->
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- Profile Modal -->
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-secondary-dark rounded-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-secondary-dark border-b border-tertiary-dark p-6 flex justify-between items-center">
                <h2 id="profileTitle" class="text-2xl font-bold">Profile</h2>
                <button onclick="closeProfileModal()" class="p-2 rounded-lg hover:bg-tertiary-dark transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="profileContent" class="p-6">
                <!-- Profile content will be populated dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-20 right-4 z-50 space-y-2 max-w-sm">
        <!-- Notifications will be added here dynamically -->
    </div>
    
    <script>
        // Financial constants
        const FINANCIAL_CONSTANTS = {
            HONORARIUM_PER_PARTICIPANT: 250.00,
            GRATUITY_RATE: 0.15,
            GST_RATE: 0.05,
            PST_RATE: 0.06,
            ROOM_DISCOUNT_RATE: 0.15  // 15% discount on room rates
        };
        
        // Menu data initialization
        let menuData = [];
        let isEditingMenu = false;
        let originalMenuData = null;
        
        // Embedded attendance data
        const attendanceData = {
            "summary": {
                "id": 1,
                "total_participants": 35,
                "total_revenue": 22869.50,
                "average_cost_per_participant": 653.41,
                "organizations_count": 7,
                "event_dates": "June 10-14, 2025",
                "last_updated": "2025-06-09 05:12:45"
            },
            "participants": [
                {"id": 1, "participant_id": 1, "name": "Lillian Urie", "organization": "Kent State University", "total_cost": 420.0, "room_number": "Cabin #01", "room_price": 75.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "Yes", "cpr_certified": "Y, exp", "first_aid_certified": "Y, exp", "will_present": "", "attendance_status": 1},
                {"id": 2, "participant_id": 2, "name": "Rebecca Weiner", "organization": "Kent State University", "total_cost": 420.0, "room_number": "Cabin #01", "room_price": 75.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "Veg", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 3, "participant_id": 3, "name": "Grace Powers", "organization": "Kent State University", "total_cost": 420.0, "room_number": "Cabin #01", "room_price": 75.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "Vegan", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "Yes", "attendance_status": 1},
                {"id": 4, "participant_id": 4, "name": "McKenzie Bernier", "organization": "Kent State University", "total_cost": 420.0, "room_number": "Cabin #01", "room_price": 75.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "Yes", "attendance_status": 1},
                {"id": 5, "participant_id": 5, "name": "Destiny Otadese", "organization": "University of Alberta", "total_cost": 505.0, "room_number": "Cabin #02", "room_price": 100.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "No pork", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "Yes", "attendance_status": 1},
                {"id": 6, "participant_id": 6, "name": "Luke Wonneck", "organization": "University of Alberta", "total_cost": 505.0, "room_number": "Cabin #02", "room_price": 100.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 7, "participant_id": 7, "name": "Kacey Currie", "organization": "University of Alberta", "total_cost": 505.0, "room_number": "Cabin #02", "room_price": 100.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "d", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 8, "participant_id": 8, "name": "Sarah DeLano", "organization": "University of Alberta", "total_cost": 505.0, "room_number": "Cabin #03", "room_price": 100.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "Veg, eat fish", "food_allergies": "", "environmental_allergies": "Bee", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "Y, exp", "will_present": "", "attendance_status": 1},
                {"id": 9, "participant_id": 9, "name": "Temitope Atanda", "organization": "University of Alberta", "total_cost": 505.0, "room_number": "Cabin #03", "room_price": 100.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "No", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "Yes", "attendance_status": 1},
                {"id": 10, "participant_id": 10, "name": "Ashley Krehut", "organization": "University of Alberta", "total_cost": 505.0, "room_number": "Cabin #03", "room_price": 100.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "Yes", "first_aid_certified": "Yes", "will_present": "", "attendance_status": 1},
                {"id": 11, "participant_id": 11, "name": "Avery O'Bryant", "organization": "Kent State University", "total_cost": 505.0, "room_number": "Cabin #03", "room_price": 100.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "Pollen, dust, mold", "medical_conditions": "Reynaud's", "can_swim": "", "lake_swim": "Cold temp S", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "Y, exp", "will_present": "Yes", "attendance_status": 1},
                {"id": 12, "participant_id": 12, "name": "Edgardo Nieto Vera", "organization": "Pan-American University", "total_cost": 477.8, "room_number": "Family Suite", "room_price": 92.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 13, "participant_id": 13, "name": "Jorge Esteban Anaya Minjarez", "organization": "Pan-American University", "total_cost": 477.8, "room_number": "Family Suite", "room_price": 92.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 14, "participant_id": 14, "name": "Santiago Rey Fernandez", "organization": "Pan-American University", "total_cost": 477.8, "room_number": "Family Suite", "room_price": 92.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 15, "participant_id": 15, "name": "Salvador Aceves", "organization": "Pan-American University", "total_cost": 811.0, "room_number": "Room #01", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 16, "participant_id": 16, "name": "Brenda Ávalos Magaña", "organization": "Pan-American University", "total_cost": 811.0, "room_number": "Room #02", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "No seafood, potatoes, carrots", "food_allergies": "Lactose intolerant", "environmental_allergies": "Dust", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 17, "participant_id": 17, "name": "Joe Monroe", "organization": "Makeway", "total_cost": 811.0, "room_number": "Room #03", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "No Veg Oil, Diabectic", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 18, "participant_id": 18, "name": "Jessica Richardson", "organization": "Kent State University", "total_cost": 811.0, "room_number": "Room #04", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "Not comfort", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "Y, exp", "will_present": "Yes", "attendance_status": 1},
                {"id": 19, "participant_id": 19, "name": "Mary Beckie", "organization": "University of Alberta", "total_cost": 811.0, "room_number": "Room #05", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 20, "participant_id": 20, "name": "Graham Parsons", "organization": "Government of Saskatchewan", "total_cost": 691.0, "room_number": "Room #06 (Night of June 11 @ 6pm)", "room_price": 190.0, "nights": 1, "lunch_cost": 15.0, "supper_cost": 30.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 21, "participant_id": 21, "name": "Kevin Jones", "organization": "University of Alberta", "total_cost": 811.0, "room_number": "Room #07", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "Veg, eat fish", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 22, "participant_id": 22, "name": "Jose Pablo Freire Blanco", "organization": "Pan-American University", "total_cost": 811.0, "room_number": "Room #08", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 23, "participant_id": 23, "name": "Rafael Castilla González", "organization": "Pan-American University", "total_cost": 811.0, "room_number": "Room #08", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "Yes", "attendance_status": 1},
                {"id": 24, "participant_id": 24, "name": "Danyta Kennedy", "organization": "Government of Saskatchewan", "total_cost": 632.5, "room_number": "Room #E1", "room_price": 137.5, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 25, "participant_id": 25, "name": "Shelly Daniels", "organization": "Government of Saskatchewan", "total_cost": 632.5, "room_number": "Room #E2", "room_price": 137.5, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 26, "participant_id": 26, "name": "Sarah Schmidt", "organization": "Kent State University", "total_cost": 811.0, "room_number": "Tipi #01", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "Bee", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "Yes", "cpr_certified": "Yes", "first_aid_certified": "Yes", "will_present": "", "attendance_status": 1},
                {"id": 27, "participant_id": 27, "name": "Adam Dwinnells", "organization": "Kent State University", "total_cost": 811.0, "room_number": "Tipi #02", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "Avacado", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "Yes", "first_aid_certified": "Yes", "will_present": "", "attendance_status": 1},
                {"id": 28, "participant_id": 28, "name": "Brenna Marrelli", "organization": "Kent State University", "total_cost": 811.0, "room_number": "Tipi #03", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "Yes", "first_aid_certified": "Yes", "will_present": "", "attendance_status": 1},
                {"id": 29, "participant_id": 29, "name": "Rominy Moss", "organization": "Kent State University", "total_cost": 811.0, "room_number": "Tipi #04", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "Yes", "first_aid_certified": "Yes", "will_present": "Yes", "attendance_status": 1},
                {"id": 30, "participant_id": 30, "name": "Lee Gast", "organization": "Kent State University", "total_cost": 811.0, "room_number": "Tipi #05", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "Bee, pollen, dust", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 31, "participant_id": 31, "name": "Irlanda Valentina Memije Almanza", "organization": "Pan-American University", "total_cost": 811.0, "room_number": "Tipi #06", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "Yes", "attendance_status": 1},
                {"id": 32, "participant_id": 32, "name": "Teresa Porter", "organization": "University of Saskatchewan", "total_cost": 811.0, "room_number": "Tipi #07", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "Veg", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 33, "participant_id": 33, "name": "Lauren Reynolds", "organization": "University of Saskatchewan", "total_cost": 811.0, "room_number": "Tipi #08", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 34, "participant_id": 34, "name": "Brynn Jones", "organization": "Government of Saskatchewan", "total_cost": 811.0, "room_number": "Tipi #09", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1},
                {"id": 35, "participant_id": 35, "name": "Cale Passmore", "organization": "Saskatchewan Indian Institute of Technologies", "total_cost": 811.0, "room_number": "Tipi #10", "room_price": 190.0, "nights": 4, "lunch_cost": 45.0, "supper_cost": 120.0, "food_preferences": "", "food_allergies": "", "environmental_allergies": "", "medical_conditions": "", "can_swim": "", "lake_swim": "", "lifeguard": "", "cpr_certified": "", "first_aid_certified": "", "will_present": "", "attendance_status": 1}
            ],
            "organizations": [
                {"id": 1, "name": "Kent State University", "participant_count": 11, "total_revenue": 7293.0},
                {"id": 2, "name": "University of Alberta", "participant_count": 8, "total_revenue": 4605.0},
                {"id": 3, "name": "Pan-American University", "participant_count": 8, "total_revenue": 5623.4},
                {"id": 4, "name": "Government of Saskatchewan", "participant_count": 4, "total_revenue": 2970.0},
                {"id": 5, "name": "University of Saskatchewan", "participant_count": 2, "total_revenue": 1634.0},
                {"id": 6, "name": "Makeway", "participant_count": 1, "total_revenue": 817.0},
                {"id": 7, "name": "Saskatchewan Indian Institute of Technologies", "participant_count": 1, "total_revenue": 817.0}
            ],
            "accommodations": [
                {"id": 1, "room_type": "Cabin", "room_number": "Cabin #01", "capacity": null, "current_occupancy": 4, "price_per_night": 75.0},
                {"id": 2, "room_type": "Cabin", "room_number": "Cabin #02", "capacity": null, "current_occupancy": 3, "price_per_night": 100.0},
                {"id": 3, "room_type": "Cabin", "room_number": "Cabin #03", "capacity": null, "current_occupancy": 4, "price_per_night": 100.0},
                {"id": 4, "room_type": "Suite", "room_number": "Family Suite", "capacity": null, "current_occupancy": 3, "price_per_night": 92.0},
                {"id": 5, "room_type": "Room", "room_number": "Room #01", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 6, "room_type": "Room", "room_number": "Room #02", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 7, "room_type": "Room", "room_number": "Room #03", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 8, "room_type": "Room", "room_number": "Room #04", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 9, "room_type": "Room", "room_number": "Room #05", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 10, "room_type": "Room", "room_number": "Room #06 (Night of June 11 @ 6pm)", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 11, "room_type": "Room", "room_number": "Room #07", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 12, "room_type": "Room", "room_number": "Room #08", "capacity": null, "current_occupancy": 2, "price_per_night": 190.0},
                {"id": 13, "room_type": "Room", "room_number": "Room #E1", "capacity": null, "current_occupancy": 1, "price_per_night": 137.5},
                {"id": 14, "room_type": "Room", "room_number": "Room #E2", "capacity": null, "current_occupancy": 1, "price_per_night": 137.5},
                {"id": 15, "room_type": "Tipi", "room_number": "Tipi #01", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 16, "room_type": "Tipi", "room_number": "Tipi #02", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 17, "room_type": "Tipi", "room_number": "Tipi #03", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 18, "room_type": "Tipi", "room_number": "Tipi #04", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 19, "room_type": "Tipi", "room_number": "Tipi #05", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 20, "room_type": "Tipi", "room_number": "Tipi #06", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 21, "room_type": "Tipi", "room_number": "Tipi #07", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 22, "room_type": "Tipi", "room_number": "Tipi #08", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 23, "room_type": "Tipi", "room_number": "Tipi #09", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0},
                {"id": 24, "room_type": "Tipi", "room_number": "Tipi #10", "capacity": null, "current_occupancy": 1, "price_per_night": 190.0}
            ]
        };
        
        // Default menu items - moved here so it's available for organization calculations
        const defaultMenuItems = [
            {
                id: 1,
                date: '2025-06-10',
                meal: 'Welcome Supper',
                description: 'Around the community fire place in front of the lake. New York Steak buffet, two seasonal green salads, potato salad, garlic toast, dessert and Blueberry Ice tea',
                cost: 713.00
            },
            {
                id: 2,
                date: '2025-06-10',
                meal: 'Bagged Daily Lunches',
                description: 'Daily lunch packages for all participants',
                cost: 1380.00
            },
            {
                id: 3,
                date: '2025-06-10',
                meal: 'Continental Breakfast',
                description: 'Free continental cold breakfast, bagels, bread, fruit, etc.',
                cost: 0.00
            },
            {
                id: 4,
                date: '2025-06-10',
                meal: 'Second Supper',
                description: 'Boreal burger bar buffet, wedges, salad, and blueberry ice tea',
                cost: 552.00
            },
            {
                id: 5,
                date: '2025-06-10',
                meal: 'Celestial Experience Snacks',
                description: 'Four popcorn bags for guest plus hot chocolate, and muskeg tea during celestial experience',
                cost: 69.00
            },
            {
                id: 6,
                date: '2025-06-10',
                meal: 'Third Supper',
                description: 'Chicken parmesan, spaghetti, alfredo, garlic bread, caesar salad, blueberry ice tea',
                cost: 690.00
            },
            {
                id: 7,
                date: '2025-06-10',
                meal: 'Celestial Experience',
                description: 'GST&PST A celestial experience, astrology excursion',
                cost: 575.00
            },
            {
                id: 8,
                date: '2025-06-10',
                meal: 'Shore Lunch',
                description: 'Fried Pickerel, wedges, coleslaw, sweet gale, bannock, berries and blueberry icetea',
                cost: 552.00
            },
            {
                id: 9,
                date: '2025-06-10',
                meal: 'Fourth Supper - Bison Feast',
                description: 'Traditional bison roast, wild rice, roasted root vegetables, bannock, berry compote, and blueberry ice tea',
                cost: 759.00
            }
        ];
        
        // Function to calculate organization revenue using invoice total logic
        function calculateOrganizationInvoiceTotal(organizationName) {
            // Get participants for this organization
            const orgParticipants = attendanceData.participants.filter(p => p.organization === organizationName);
            if (orgParticipants.length === 0) return 0;
            
            // Calculate accommodation total with 15% discount
            let accommodationSubtotal = 0;
            orgParticipants.forEach(p => {
                const nights = p.nights || 4;
                const roomPrice = p.room_price || 0;
                const roomCost = nights * roomPrice;
                const discountedRoomCost = roomCost * (1 - FINANCIAL_CONSTANTS.ROOM_DISCOUNT_RATE);
                accommodationSubtotal += discountedRoomCost;
            });
            
            // Calculate meals total
            let mealsSubtotal = 0;
            const participantCount = orgParticipants.length;
            
            // Add bagged lunches (4 days × participants × $15)
            const lunchTotal = participantCount * 4 * 15.00;
            mealsSubtotal += lunchTotal;
            
            // Add suppers (4 days × participants × $30)
            const supperTotal = participantCount * 4 * 30.00;
            mealsSubtotal += supperTotal;
            
            // Calculate honorarium
            const honorariumTotal = FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT * participantCount;
            
            // Calculate subtotals
            const subtotalBeforeGratuity = accommodationSubtotal + mealsSubtotal + honorariumTotal;
            
            // Calculate gratuity (15% on accommodation + meals only)
            const gratuityBase = accommodationSubtotal + mealsSubtotal;
            const gratuity = gratuityBase * FINANCIAL_CONSTANTS.GRATUITY_RATE;
            
            // Calculate taxes
            const subtotalWithGratuity = subtotalBeforeGratuity + gratuity;
            const gst = subtotalWithGratuity * FINANCIAL_CONSTANTS.GST_RATE;
            const pst = subtotalWithGratuity * FINANCIAL_CONSTANTS.PST_RATE;
            const totalTaxes = gst + pst;
            
            // Calculate grand total (invoice total)
            const grandTotal = subtotalWithGratuity + totalTaxes;
            
            return grandTotal;
        }
        
        // Function to recalculate organization revenues using invoice totals
        function recalculateOrganizationRevenues() {
            // Update each organization's total revenue to match their invoice total
            attendanceData.organizations.forEach(org => {
                org.total_revenue = calculateOrganizationInvoiceTotal(org.name);
            });
            
            // Update the summary total revenue
            let totalRevenue = 0;
            attendanceData.organizations.forEach(org => {
                totalRevenue += org.total_revenue;
            });
            
            attendanceData.summary.total_revenue = totalRevenue;
            attendanceData.summary.average_cost_per_participant = attendanceData.summary.total_revenue / attendanceData.participants.length;
        }
        
        // Comprehensive financial calculation function
        function calculateFinancials() {
            // Calculate accommodation revenue from actual participant data with 15% discount
            const accommodationRevenue = attendanceData.participants.reduce((sum, p) => {
                const roomCost = p.room_price * p.nights;
                const discountedCost = roomCost * (1 - FINANCIAL_CONSTANTS.ROOM_DISCOUNT_RATE);
                return sum + discountedCost;
            }, 0);
            
            // Calculate individual meals revenue from participant data
            const individualMealsRevenue = attendanceData.participants.reduce((sum, p) => 
                sum + p.lunch_cost + p.supper_cost, 0
            );
            
            // Get menu revenue if available
            const menuItems = (menuData && menuData.length > 0) ? menuData : defaultMenuItems;
            const menuRevenue = menuItems.reduce((sum, item) => sum + item.cost, 0);
            
            // Calculate honorarium revenue
            const totalParticipants = attendanceData.participants.length;
            const honorariumRevenue = totalParticipants * FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
            
            // Calculate gratuity only on accommodation and food service
            const gratuityBase = accommodationRevenue + menuRevenue;
            const gratuity = gratuityBase * FINANCIAL_CONSTANTS.GRATUITY_RATE;
            
            // Calculate subtotals and taxes
            const subtotal = accommodationRevenue + menuRevenue + honorariumRevenue;
            const subtotalWithGratuity = subtotal + gratuity;
            const gst = subtotalWithGratuity * FINANCIAL_CONSTANTS.GST_RATE;
            const pst = subtotalWithGratuity * FINANCIAL_CONSTANTS.PST_RATE;
            const totalTaxes = gst + pst;
            const grandTotal = subtotalWithGratuity + totalTaxes;
            
            return {
                accommodation: accommodationRevenue,
                individualMeals: individualMealsRevenue,
                menuMeals: menuRevenue,
                honorarium: honorariumRevenue,
                subtotal: subtotal,
                gratuity: gratuity,
                gratuityBase: gratuityBase,
                subtotalWithGratuity: subtotalWithGratuity,
                gst: gst,
                pst: pst,
                totalTaxes: totalTaxes,
                grandTotal: grandTotal
            };
        }
        
        // Sidebar state
        let sidebarCollapsed = false;
        
        // Toggle sidebar for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            const isOpen = !sidebar.classList.contains('-translate-x-full');
            
            if (window.innerWidth < 1024) {
                // Mobile behavior
                if (isOpen) {
                    sidebar.classList.add('-translate-x-full');
                    overlay.classList.add('hidden');
                } else {
                    sidebar.classList.remove('-translate-x-full');
                    overlay.classList.remove('hidden');
                }
            } else {
                // Desktop behavior when hamburger menu is clicked
                if (sidebarCollapsed) {
                    expandSidebar();
                }
            }
        }
        
        // Toggle sidebar for desktop
        function toggleSidebarDesktop() {
            if (sidebarCollapsed) {
                expandSidebar();
            } else {
                collapseSidebar();
            }
        }
        
        // Collapse sidebar (desktop only)
        function collapseSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const icon = document.getElementById('sidebarToggleIcon');
            
            sidebarCollapsed = true;
            sidebar.classList.add('lg:w-16', 'sidebar-collapsed');
            sidebar.classList.remove('lg:w-64');
            mainContent.classList.add('lg:ml-16');
            mainContent.classList.remove('lg:ml-64');
            icon.classList.remove('fa-chevron-left');
            icon.classList.add('fa-chevron-right');
            
            // Hide text in sidebar
            sidebar.querySelectorAll('span').forEach(span => {
                span.classList.add('lg:hidden');
            });
            sidebar.querySelectorAll('h1, p').forEach(el => {
                el.classList.add('lg:hidden');
            });
            
            // Store state
            localStorage.setItem('sidebarCollapsed', 'true');
        }
        
        // Expand sidebar (desktop only)
        function expandSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const icon = document.getElementById('sidebarToggleIcon');
            
            sidebarCollapsed = false;
            sidebar.classList.remove('lg:w-16', 'sidebar-collapsed');
            sidebar.classList.add('lg:w-64');
            mainContent.classList.remove('lg:ml-16');
            mainContent.classList.add('lg:ml-64');
            icon.classList.add('fa-chevron-left');
            icon.classList.remove('fa-chevron-right');
            
            // Show text in sidebar
            sidebar.querySelectorAll('span').forEach(span => {
                span.classList.remove('lg:hidden');
            });
            sidebar.querySelectorAll('h1, p').forEach(el => {
                el.classList.remove('lg:hidden');
            });
            
            // Store state
            localStorage.setItem('sidebarCollapsed', 'false');
        }
        
        // Search functionality
        let searchTimeout;
        function initializeSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                const query = e.target.value.trim().toLowerCase();
                
                if (query.length < 2) {
                    searchResults.classList.add('hidden');
                    return;
                }
                
                searchTimeout = setTimeout(() => {
                    performSearch(query);
                }, 300);
            });
            
            // Close search results when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.relative')) {
                    searchResults.classList.add('hidden');
                }
            });
        }
        
        function performSearch(query) {
            const searchResults = document.getElementById('searchResults');
            const results = [];
            
            // Search participants
            attendanceData.participants.forEach(participant => {
                if (participant.name.toLowerCase().includes(query) || 
                    participant.organization.toLowerCase().includes(query)) {
                    results.push({
                        type: 'participant',
                        data: participant
                    });
                }
            });
            
            // Search organizations
            attendanceData.organizations.forEach(org => {
                if (org.name.toLowerCase().includes(query)) {
                    results.push({
                        type: 'organization',
                        data: org
                    });
                }
            });
            
            // Display results
            if (results.length > 0) {
                let html = '';
                results.forEach(result => {
                    if (result.type === 'participant') {
                        html += `
                            <div class="p-3 hover:bg-tertiary-dark cursor-pointer border-b border-tertiary-dark" onclick="showParticipantProfile(${result.data.id})">
                                <div class="flex items-center">
                                    <i class="fas fa-user mr-3 text-accent-blue"></i>
                                    <div>
                                        <div class="font-semibold">${result.data.name}</div>
                                        <div class="text-sm text-text-secondary">${result.data.organization}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="p-3 hover:bg-tertiary-dark cursor-pointer border-b border-tertiary-dark" onclick="showOrganizationProfile('${result.data.name}')">
                                <div class="flex items-center">
                                    <i class="fas fa-building mr-3 text-purple-400"></i>
                                    <div>
                                        <div class="font-semibold">${result.data.name}</div>
                                        <div class="text-sm text-text-secondary">${result.data.participant_count} participants</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                });
                searchResults.innerHTML = html;
                searchResults.classList.remove('hidden');
            } else {
                searchResults.innerHTML = '<div class="p-4 text-text-secondary text-center">No results found</div>';
                searchResults.classList.remove('hidden');
            }
        }
        
        // Profile Modal Functions
        function showParticipantProfile(participantId) {
            const participant = attendanceData.participants.find(p => p.id === participantId);
            if (!participant) return;
            
            const modal = document.getElementById('profileModal');
            const title = document.getElementById('profileTitle');
            const content = document.getElementById('profileContent');
            
            title.textContent = participant.name;
            
            // Calculate costs with room discount
            const roomCost = participant.room_price * participant.nights;
            const roomDiscount = roomCost * FINANCIAL_CONSTANTS.ROOM_DISCOUNT_RATE;
            const discountedRoomCost = roomCost - roomDiscount;
            const mealsCost = participant.lunch_cost + participant.supper_cost;
            const honorarium = FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
            const subtotal = discountedRoomCost + mealsCost + honorarium;
            const gratuity = (discountedRoomCost + mealsCost) * FINANCIAL_CONSTANTS.GRATUITY_RATE;
            const subtotalWithGratuity = subtotal + gratuity;
            const gst = subtotalWithGratuity * FINANCIAL_CONSTANTS.GST_RATE;
            const pst = subtotalWithGratuity * FINANCIAL_CONSTANTS.PST_RATE;
            const total = subtotalWithGratuity + gst + pst;
            
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Personal Information -->
                    <div class="bg-tertiary-dark rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-user mr-2 text-accent-blue"></i>Personal Information
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Organization:</span>
                                <span class="font-medium">${participant.organization}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Status:</span>
                                <span class="font-medium ${participant.attendance_status === 1 ? 'text-green-400' : 'text-red-400'}">
                                    ${participant.attendance_status === 1 ? 'Confirmed' : 'Pending'}
                                </span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Will Present:</span>
                                <span class="font-medium">${participant.will_present || 'No'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Accommodation Details -->
                    <div class="bg-tertiary-dark rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-bed mr-2 text-purple-400"></i>Accommodation
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Room:</span>
                                <span class="font-medium">${participant.room_number}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Nights:</span>
                                <span class="font-medium">${participant.nights}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Rate/Night:</span>
                                <span class="font-medium">$${participant.room_price.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Room Total:</span>
                                <span class="font-medium">$${roomCost.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between text-green-400">
                                <span class="text-text-secondary">15% Discount:</span>
                                <span class="font-medium">-$${roomDiscount.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between border-t border-tertiary-dark pt-2">
                                <span class="text-text-secondary">Total:</span>
                                <span class="font-medium text-green-400">$${discountedRoomCost.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Health & Safety -->
                    <div class="bg-tertiary-dark rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-heart mr-2 text-red-400"></i>Health & Safety
                        </h3>
                        <div class="space-y-3">
                            <div>
                                <span class="text-text-secondary">Food Preferences:</span>
                                <span class="font-medium ml-2">${participant.food_preferences || 'None'}</span>
                            </div>
                            <div>
                                <span class="text-text-secondary">Food Allergies:</span>
                                <span class="font-medium ml-2 ${participant.food_allergies ? 'text-yellow-400' : ''}">${participant.food_allergies || 'None'}</span>
                            </div>
                            <div>
                                <span class="text-text-secondary">Environmental Allergies:</span>
                                <span class="font-medium ml-2 ${participant.environmental_allergies ? 'text-yellow-400' : ''}">${participant.environmental_allergies || 'None'}</span>
                            </div>
                            <div>
                                <span class="text-text-secondary">Medical Conditions:</span>
                                <span class="font-medium ml-2 ${participant.medical_conditions ? 'text-orange-400' : ''}">${participant.medical_conditions || 'None'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Skills & Certifications -->
                    <div class="bg-tertiary-dark rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-certificate mr-2 text-yellow-400"></i>Skills & Certifications
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Can Swim:</span>
                                <span class="font-medium">${participant.can_swim || 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Lake Swimming:</span>
                                <span class="font-medium">${participant.lake_swim || 'Unknown'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Lifeguard:</span>
                                <span class="font-medium ${participant.lifeguard === 'Yes' ? 'text-green-400' : ''}">${participant.lifeguard || 'No'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">CPR Certified:</span>
                                <span class="font-medium ${participant.cpr_certified && participant.cpr_certified.includes('Y') ? 'text-green-400' : ''}">${participant.cpr_certified || 'No'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">First Aid:</span>
                                <span class="font-medium ${participant.first_aid_certified && participant.first_aid_certified.includes('Y') ? 'text-green-400' : ''}">${participant.first_aid_certified || 'No'}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Financial Summary -->
                <div class="mt-6 bg-tertiary-dark rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-dollar-sign mr-2 text-green-400"></i>Financial Summary
                    </h3>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-text-secondary">Accommodation (with 15% discount):</span>
                            <span>$${discountedRoomCost.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-text-secondary">Meals:</span>
                            <span>$${mealsCost.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-text-secondary">Honorarium:</span>
                            <span>$${honorarium.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between pt-2 border-t border-tertiary-dark">
                            <span class="text-text-secondary">Subtotal:</span>
                            <span>$${subtotal.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-text-secondary">Gratuity (15%):</span>
                            <span>$${gratuity.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-text-secondary">GST (5%):</span>
                            <span>$${gst.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-text-secondary">PST (6%):</span>
                            <span>$${pst.toFixed(2)}</span>
                        </div>
                        <div class="flex justify-between pt-2 border-t border-tertiary-dark font-bold text-lg">
                            <span>Total:</span>
                            <span class="text-green-400">$${total.toFixed(2)}</span>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            document.getElementById('searchResults').classList.add('hidden');
        }
        
        function showOrganizationProfile(orgName) {
            const org = attendanceData.organizations.find(o => o.name === orgName);
            if (!org) return;
            
            const modal = document.getElementById('profileModal');
            const title = document.getElementById('profileTitle');
            const content = document.getElementById('profileContent');
            
            title.textContent = org.name;
            
            // Get participants from this organization
            const orgParticipants = attendanceData.participants.filter(p => p.organization === org.name);
            
            // Calculate financial summary
            let totalAccommodation = 0;
            let totalMeals = 0;
            let totalHonorarium = org.participant_count * FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
            
            orgParticipants.forEach(p => {
                totalAccommodation += p.room_price * p.nights;
                totalMeals += p.lunch_cost + p.supper_cost;
            });
            
            const subtotal = totalAccommodation + totalMeals + totalHonorarium;
            const gratuity = (totalAccommodation + totalMeals) * FINANCIAL_CONSTANTS.GRATUITY_RATE;
            const subtotalWithGratuity = subtotal + gratuity;
            const gst = subtotalWithGratuity * FINANCIAL_CONSTANTS.GST_RATE;
            const pst = subtotalWithGratuity * FINANCIAL_CONSTANTS.PST_RATE;
            const total = subtotalWithGratuity + gst + pst;
            
            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <!-- Organization Overview -->
                    <div class="bg-tertiary-dark rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-building mr-2 text-purple-400"></i>Overview
                        </h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Total Participants:</span>
                                <span class="font-medium text-2xl">${org.participant_count}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Confirmed:</span>
                                <span class="font-medium text-green-400">${orgParticipants.filter(p => p.attendance_status === 1).length}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Presenters:</span>
                                <span class="font-medium">${orgParticipants.filter(p => p.will_present === 'Yes').length}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Financial Summary -->
                    <div class="bg-tertiary-dark rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-dollar-sign mr-2 text-green-400"></i>Financial Summary
                        </h3>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Accommodation:</span>
                                <span>$${totalAccommodation.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Meals:</span>
                                <span>$${totalMeals.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Honorarium:</span>
                                <span>$${totalHonorarium.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Gratuity:</span>
                                <span>$${gratuity.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-text-secondary">Taxes:</span>
                                <span>$${(gst + pst).toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between pt-2 border-t border-tertiary-dark font-bold text-lg">
                                <span>Total:</span>
                                <span class="text-green-400">$${total.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Participants List -->
                <div class="bg-tertiary-dark rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-users mr-2 text-accent-blue"></i>Participants
                    </h3>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-tertiary-dark">
                                    <th class="text-left py-2 px-3 text-text-secondary font-medium">Name</th>
                                    <th class="text-left py-2 px-3 text-text-secondary font-medium">Room</th>
                                    <th class="text-left py-2 px-3 text-text-secondary font-medium">Status</th>
                                    <th class="text-right py-2 px-3 text-text-secondary font-medium">Cost</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${orgParticipants.map(p => {
                                    const pTotal = p.total_cost + FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
                                    const pGratuity = (p.room_price * p.nights + p.lunch_cost + p.supper_cost) * FINANCIAL_CONSTANTS.GRATUITY_RATE;
                                    const pWithGratuity = pTotal + pGratuity;
                                    const pTaxes = pWithGratuity * (FINANCIAL_CONSTANTS.GST_RATE + FINANCIAL_CONSTANTS.PST_RATE);
                                    const pGrandTotal = pWithGratuity + pTaxes;
                                    
                                    return `
                                        <tr class="border-b border-tertiary-dark hover:bg-primary-dark cursor-pointer" onclick="showParticipantProfile(${p.id})">
                                            <td class="py-2 px-3">
                                                <div class="font-medium">${p.name}</div>
                                                ${p.will_present === 'Yes' ? '<span class="text-xs text-yellow-400">Presenter</span>' : ''}
                                            </td>
                                            <td class="py-2 px-3 text-sm">${p.room_number}</td>
                                            <td class="py-2 px-3">
                                                <span class="text-xs px-2 py-1 rounded-full ${p.attendance_status === 1 ? 'bg-green-400 bg-opacity-20 text-green-400' : 'bg-yellow-400 bg-opacity-20 text-yellow-400'}">
                                                    ${p.attendance_status === 1 ? 'Confirmed' : 'Pending'}
                                                </span>
                                            </td>
                                            <td class="py-2 px-3 text-right font-medium">$${pGrandTotal.toFixed(2)}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Actions -->
                <div class="mt-6 flex justify-end space-x-4">
                    <button onclick="exportOrganizationInvoice('${org.name}')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
                        <i class="fas fa-file-pdf mr-2"></i>Export Invoice (Original)
                    </button>
                    <button onclick="generateValidatedInvoice('${org.name}')" class="px-4 py-2 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors">
                        <i class="fas fa-file-invoice-dollar mr-2"></i>Generate Validated Invoice
                    </button>
                </div>
            `;
            
            modal.classList.remove('hidden');
            document.getElementById('searchResults').classList.add('hidden');
        }
        
        function closeProfileModal() {
            document.getElementById('profileModal').classList.add('hidden');
        }
        
        // Notification System
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            const id = 'notification-' + Date.now();
            
            const icons = {
                'success': 'fa-check-circle text-green-400',
                'error': 'fa-exclamation-circle text-red-400',
                'warning': 'fa-exclamation-triangle text-yellow-400',
                'info': 'fa-info-circle text-accent-blue'
            };
            
            notification.id = id;
            notification.className = 'bg-secondary-dark border border-tertiary-dark rounded-lg p-4 shadow-lg flex items-start space-x-3 animate-fade-in';
            notification.innerHTML = `
                <i class="fas ${icons[type]} text-xl flex-shrink-0 mt-0.5"></i>
                <div class="flex-1">
                    <p class="text-sm">${message}</p>
                </div>
                <button onclick="dismissNotification('${id}')" class="flex-shrink-0 text-text-secondary hover:text-text-primary">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Auto dismiss after 5 seconds
            setTimeout(() => {
                dismissNotification(id);
            }, 5000);
        }
        
        function dismissNotification(id) {
            const notification = document.getElementById(id);
            if (notification) {
                notification.classList.add('opacity-0', 'transform', 'translate-x-full');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }
        }
        
        // Initialize dashboard
        function initDashboard() {
            try {
                // Initialize sidebar state
                const savedSidebarState = localStorage.getItem('sidebarCollapsed');
                if (savedSidebarState === 'true' && window.innerWidth >= 1024) {
                    collapseSidebar();
                }
                
                // Initialize menu data first
                initializeMenu();
                
                // Initialize search functionality
                initializeSearch();
                
                // Recalculate organization revenues with current data
                recalculateOrganizationRevenues();
                
                // Update all sections
                updateStats();
                updateCharts();
                updateParticipantsTable();
                updateHealthSafety();
                updateFinancialSummary();
                updateOrganizationsSection();
                updateAccommodationsSection();
                updateMenuDisplay();
                populateFilters();
                initializeTableSearch();
                
                // Initialize financial tab elements
                const financialElements = {
                    totalMenuCost: document.getElementById('totalMenuCost'),
                    menuGST: document.getElementById('menuGST'),
                    menuPST: document.getElementById('menuPST'),
                    menuTotalWithTax: document.getElementById('menuTotalWithTax')
                };
                
                // Ensure all elements exist before updating
                if (financialElements.totalMenuCost) {
                    updateMenuSummary();
                }
                
                // Show overview by default
                showSection('overview');
            } catch (error) {
                console.error('Dashboard initialization error:', error);
            }
        }
        
        // Update statistics cards
        function updateStats() {
            try {
                const summary = attendanceData.summary;
                document.getElementById('totalParticipants').textContent = summary.total_participants;
                
                // Use the total revenue from organizations (sum of all invoice totals)
                const totalRevenue = summary.total_revenue;
                
                // Calculate the revenue without taxes (need to reverse calculate from grand total)
                // Grand Total = Subtotal with Gratuity + GST + PST
                // Grand Total = Subtotal with Gratuity * (1 + 0.05 + 0.06)
                // Grand Total = Subtotal with Gratuity * 1.11
                // So: Subtotal with Gratuity = Grand Total / 1.11
                const subtotalWithGratuity = totalRevenue / 1.11;
                
                // To get subtotal without gratuity, we need to reverse that too
                // But we need to know what portion was gratuity base (accommodation + meals)
                // For display purposes, we'll show the subtotal before taxes
                const revenue = subtotalWithGratuity;
                
                const revenueElement = document.getElementById('totalRevenue');
                if (revenueElement) {
                    revenueElement.textContent = `$${revenue.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                }
                
                // Update the tax display with the actual total from organizations
                const taxDisplay = revenueElement?.nextElementSibling?.nextElementSibling;
                if (taxDisplay) {
                    taxDisplay.textContent = `$${totalRevenue.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})} with tax`;
                }
                
                document.getElementById('totalOrganizations').textContent = summary.organizations_count;
                
                // Calculate average cost per participant from the total revenue
                const avgCostPerParticipant = totalRevenue / summary.total_participants;
                document.getElementById('avgCost').textContent = `$${avgCostPerParticipant.toFixed(2)}`;
            } catch (error) {
                console.error('Error in updateStats:', error);
            }
        }
        
        // Update accommodation revenue display in financial tab
        function updateAccommodationRevenueDisplay() {
            // Calculate accommodation revenue by room type
            const roomTypeRevenue = {};
            attendanceData.participants.forEach(p => {
                // Find accommodation for this participant
                const accommodation = attendanceData.accommodations.find(a => a.room_number === p.room_number);
                if (accommodation) {
                    const roomType = accommodation.room_type;
                    if (!roomTypeRevenue[roomType]) {
                        roomTypeRevenue[roomType] = {
                            count: 0,
                            guests: 0,
                            revenue: 0
                        };
                    }
                    roomTypeRevenue[roomType].guests++;
                    const roomCost = p.room_price * p.nights;
                    const discountedCost = roomCost * (1 - FINANCIAL_CONSTANTS.ROOM_DISCOUNT_RATE);
                    roomTypeRevenue[roomType].revenue += discountedCost;
                }
            });
            
            // Count unique rooms per type
            const roomCounts = {};
            attendanceData.accommodations.forEach(a => {
                if (!roomCounts[a.room_type]) {
                    roomCounts[a.room_type] = 0;
                }
                roomCounts[a.room_type]++;
            });
            
            // Update the display
            const accommodationContainer = document.getElementById('accommodationRevenueDisplay');
            if (accommodationContainer) {
                let html = '';
                
                // Display each room type
                const roomTypeIcons = {
                    'Cabin': 'fa-house-chimney',
                    'Room': 'fa-home',
                    'Tipi': 'fa-campground',
                    'Suite': 'fa-users',
                    'Overflow Room': 'fa-door-open'
                };
                
                let totalRevenue = 0;
                for (const [roomType, data] of Object.entries(roomTypeRevenue)) {
                    if (data.revenue > 0) {
                        const icon = roomTypeIcons[roomType] || 'fa-bed';
                        const units = roomCounts[roomType] || 0;
                        totalRevenue += data.revenue;
                        html += `
                            <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                                <span class="flex items-center">
                                    <i class="fas ${icon} mr-2 text-accent-blue"></i>${roomType}s (${units} units, ${data.guests} guests)
                                </span>
                                <span class="font-bold text-green-400">$${data.revenue.toLocaleString('en-CA', {minimumFractionDigits: 2})}</span>
                            </div>
                        `;
                    }
                }
                
                // Add note about shared rooms
                html += `
                    <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                        <span class="flex items-center">
                            <i class="fas fa-info-circle mr-2 text-yellow-400"></i>Note: Shared rooms split cost
                        </span>
                        <span class="text-text-secondary text-sm">Per person rates</span>
                    </div>
                `;
                
                // Add total
                html += `
                    <div class="flex justify-between items-center p-3 bg-accent-blue bg-opacity-20 rounded font-bold">
                        <span>Total Accommodation Revenue (15% discount applied)</span>
                        <span class="text-accent-blue">$${totalRevenue.toLocaleString('en-CA', {minimumFractionDigits: 2})}</span>
                    </div>
                `;
                
                accommodationContainer.innerHTML = html;
            }
        }
        
        // Update honorarium revenue display
        function updateHonorariumDisplay() {
            const honorariumContainer = document.getElementById('honorariumRevenue');
            if (honorariumContainer) {
                const totalParticipants = attendanceData.participants.length;
                const honorariumPerParticipant = FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
                const totalHonorarium = totalParticipants * honorariumPerParticipant;
                
                honorariumContainer.innerHTML = `
                    <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                        <span class="flex items-center">
                            <i class="fas fa-hand-holding-heart mr-2 text-purple-400"></i>Honorarium Fee per Participant
                        </span>
                        <span class="font-bold text-green-400">$${honorariumPerParticipant.toFixed(2)}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                        <span class="flex items-center">
                            <i class="fas fa-users mr-2 text-purple-400"></i>Total Participants
                        </span>
                        <span class="font-bold">${totalParticipants}</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-purple-400 bg-opacity-20 rounded font-bold">
                        <span>Total Honorarium Revenue</span>
                        <span class="text-purple-400">$${totalHonorarium.toLocaleString('en-CA', {minimumFractionDigits: 2})}</span>
                    </div>
                `;
            }
            
            // Also update the standalone total honorarium element if it exists
            const totalHonorariumEl = document.getElementById('totalHonorariumRevenue');
            if (totalHonorariumEl) {
                const totalParticipants = attendanceData.participants.length;
                const totalHonorarium = totalParticipants * FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
                totalHonorariumEl.textContent = `$${totalHonorarium.toLocaleString('en-CA', {minimumFractionDigits: 2})}`;
            }
        }
        
        // Update financial summary with tax calculations
        function updateFinancialSummary() {
            // Update accommodation revenue display
            updateAccommodationRevenueDisplay();
            
            // Update honorarium display
            updateHonorariumDisplay();
            
            // Update food service revenue from menu data
            const foodServiceContainer = document.getElementById('foodServiceRevenue');
            if (foodServiceContainer) {
                const menuItems = menuData || defaultMenuItems;
                const menuTotal = menuItems.reduce((sum, item) => sum + item.cost, 0);
                
                let foodServiceHTML = '';
                menuItems.forEach(item => {
                    foodServiceHTML += `
                        <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                            <span class="flex items-center">
                                <i class="fas fa-utensils mr-2 text-yellow-400"></i>${item.meal}
                            </span>
                            <span class="font-bold text-green-400">$${item.cost.toLocaleString('en-CA', {minimumFractionDigits: 2})}</span>
                        </div>
                    `;
                });
                
                foodServiceHTML += `
                    <div class="flex justify-between items-center p-3 bg-yellow-400 bg-opacity-20 rounded font-bold">
                        <span>Total Food Service</span>
                        <span class="text-yellow-400">$${menuTotal.toLocaleString('en-CA', {minimumFractionDigits: 2})}</span>
                    </div>
                `;
                
                foodServiceContainer.innerHTML = foodServiceHTML;
            }
            
            // Calculate financials using the centralized function
            const financials = calculateFinancials();
            
            // Update financial section elements if they exist
            const subtotalElement = document.getElementById('eventSubtotal');
            if (subtotalElement) {
                subtotalElement.textContent = `$${financials.subtotal.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
            
            const gstElement = document.getElementById('gstAmount');
            if (gstElement) {
                gstElement.textContent = `$${financials.gst.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
            
            const pstElement = document.getElementById('pstAmount');
            if (pstElement) {
                pstElement.textContent = `$${financials.pst.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
            
            const totalTaxesElement = document.getElementById('totalTaxes');
            if (totalTaxesElement) {
                totalTaxesElement.textContent = `$${financials.totalTaxes.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
            
            const totalWithTaxesElement = document.getElementById('totalWithTaxes');
            if (totalWithTaxesElement) {
                totalWithTaxesElement.textContent = `$${financials.grandTotal.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
            
            // Update gratuity elements
            const gratuityElement = document.getElementById('gratuityAmount');
            if (gratuityElement) {
                gratuityElement.textContent = `$${financials.gratuity.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
            
            const subtotalWithGratuityElement = document.getElementById('subtotalWithGratuity');
            if (subtotalWithGratuityElement) {
                subtotalWithGratuityElement.textContent = `$${financials.subtotalWithGratuity.toLocaleString('en-CA', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
            }
        }
        
        // Chart instances
        let orgChart = null;
        let accomChart = null;
        
        // Update charts
        function updateCharts() {
            // Destroy existing charts if they exist
            if (orgChart) {
                orgChart.destroy();
            }
            if (accomChart) {
                accomChart.destroy();
            }
            
            // Organization Chart
            const orgCtx = document.getElementById('orgChart').getContext('2d');
            orgChart = new Chart(orgCtx, {
                type: 'bar',
                data: {
                    labels: attendanceData.organizations.map(org => org.name.length > 20 ? org.name.substring(0, 20) + '...' : org.name),
                    datasets: [{
                        label: 'Participants',
                        data: attendanceData.organizations.map(org => org.participant_count),
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#a3a3a3',
                                stepSize: 2
                            },
                            grid: {
                                color: '#252525'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#a3a3a3',
                                maxRotation: 45,
                                minRotation: 45,
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
            
            // Accommodation Chart
            const accomData = {};
            attendanceData.accommodations.forEach(acc => {
                const type = acc.room_type;
                accomData[type] = (accomData[type] || 0) + acc.current_occupancy;
            });
            
            const accomCtx = document.getElementById('accommodationChart').getContext('2d');
            accomChart = new Chart(accomCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(accomData),
                    datasets: [{
                        data: Object.values(accomData),
                        backgroundColor: ['#3b82f6', '#60a5fa', '#2563eb', '#1d4ed8'],
                        borderColor: '#1a1a1a',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#a3a3a3',
                                padding: 10,
                                font: {
                                    size: 12
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Table sorting state
        let participantSortColumn = null;
        let participantSortDirection = 'asc';
        let isEditingTable = false;
        
        // Update participants table
        function updateParticipantsTable(filterOrg = '') {
            const tbody = document.getElementById('participantsTable');
            tbody.innerHTML = '';
            
            let filteredParticipants = filterOrg 
                ? attendanceData.participants.filter(p => p.organization === filterOrg)
                : [...attendanceData.participants];
            
            // Apply sorting if active
            if (participantSortColumn) {
                filteredParticipants.sort((a, b) => {
                    let aVal = a[participantSortColumn];
                    let bVal = b[participantSortColumn];
                    
                    // Handle numeric values
                    if (participantSortColumn === 'participant_id' || participantSortColumn === 'total_cost') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    }
                    
                    if (aVal < bVal) return participantSortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return participantSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            
            // Update participant count
            const countElement = document.getElementById('participantCount');
            if (countElement) {
                countElement.textContent = filteredParticipants.length;
            }
            
            filteredParticipants.forEach((participant, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-tertiary-dark hover:bg-tertiary-dark';
                
                const dietary = [participant.food_preferences, participant.food_allergies].filter(Boolean).join(', ');
                const medical = [participant.environmental_allergies, participant.medical_conditions].filter(Boolean).join(', ');
                
                // Calculate discounted room cost
                const roomCost = participant.room_price * participant.nights;
                const discountedRoomCost = roomCost * (1 - FINANCIAL_CONSTANTS.ROOM_DISCOUNT_RATE);
                const totalCostWithDiscount = discountedRoomCost + participant.lunch_cost + participant.supper_cost + FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
                
                row.innerHTML = `
                    <td class="py-2 sm:py-3 px-2 sm:px-4 whitespace-nowrap text-sm sm:text-base">${participant.participant_id}</td>
                    <td class="py-2 sm:py-3 px-2 sm:px-4 editable-cell font-medium text-sm sm:text-base ${!isEditingTable ? 'cursor-pointer hover:text-accent-blue' : ''}" data-field="name" data-participant-id="${participant.id}" ${!isEditingTable ? `onclick="showParticipantProfile(${participant.id})"` : ''}>${participant.name}</td>
                    <td class="py-2 sm:py-3 px-2 sm:px-4 text-text-secondary editable-cell hidden sm:table-cell text-sm sm:text-base ${!isEditingTable ? 'cursor-pointer hover:text-accent-blue' : ''}" data-field="organization" data-participant-id="${participant.id}" ${!isEditingTable ? `onclick="showOrganizationProfile('${participant.organization.replace(/'/g, "\\'")}')"` : ''}>${participant.organization}</td>
                    <td class="py-2 sm:py-3 px-2 sm:px-4 editable-cell whitespace-nowrap text-sm sm:text-base" data-field="room_number" data-participant-id="${participant.id}">${participant.room_number}</td>
                    <td class="py-2 sm:py-3 px-2 sm:px-4 editable-cell whitespace-nowrap text-sm sm:text-base" data-field="total_cost" data-participant-id="${participant.id}">$${totalCostWithDiscount.toFixed(2)}</td>
                    <td class="py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm editable-cell hide-mobile" data-field="dietary" data-participant-id="${participant.id}">${dietary || '-'}</td>
                    <td class="py-2 sm:py-3 px-2 sm:px-4 text-xs sm:text-sm editable-cell hide-mobile" data-field="medical" data-participant-id="${participant.id}">${medical || '-'}</td>
                `;
                tbody.appendChild(row);
            });
            
            // Add click handlers for editable cells if in edit mode
            if (isEditingTable) {
                enableTableEditing();
            }
        }
        
        // Update health and safety information
        function updateHealthSafety() {
            // Dietary requirements
            const dietaryMap = {};
            const allergyMap = {};
            let cprCount = 0;
            let firstAidCount = 0;
            let lifeguardCount = 0;
            
            attendanceData.participants.forEach(p => {
                // Dietary
                if (p.food_preferences) {
                    dietaryMap[p.food_preferences] = (dietaryMap[p.food_preferences] || 0) + 1;
                }
                
                // Allergies
                if (p.food_allergies || p.environmental_allergies) {
                    const allergies = [p.food_allergies, p.environmental_allergies].filter(Boolean).join(', ');
                    allergyMap[allergies] = (allergyMap[allergies] || 0) + 1;
                }
                
                // Certifications
                if (p.cpr_certified && p.cpr_certified.toLowerCase().includes('y')) cprCount++;
                if (p.first_aid_certified && p.first_aid_certified.toLowerCase().includes('y')) firstAidCount++;
                if (p.lifeguard && p.lifeguard.toLowerCase().includes('y')) lifeguardCount++;
            });
            
            // Update dietary list
            const dietaryList = document.getElementById('dietaryList');
            dietaryList.innerHTML = Object.entries(dietaryMap)
                .map(([diet, count]) => `
                    <div class="flex justify-between items-center p-2 bg-tertiary-dark rounded">
                        <span class="text-sm">${diet}</span>
                        <span class="text-xs bg-accent-blue bg-opacity-20 px-2 py-1 rounded">${count}</span>
                    </div>
                `).join('');
            
            // Update allergy list
            const allergyList = document.getElementById('allergyList');
            allergyList.innerHTML = Object.entries(allergyMap)
                .map(([allergy, count]) => `
                    <div class="flex justify-between items-center p-2 bg-tertiary-dark rounded">
                        <span class="text-sm">${allergy}</span>
                        <span class="text-xs bg-yellow-400 bg-opacity-20 text-yellow-400 px-2 py-1 rounded">${count}</span>
                    </div>
                `).join('');
            
            // Update certifications
            const certList = document.getElementById('certificationsList');
            certList.innerHTML = `
                <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                    <span><i class="fas fa-heartbeat mr-2"></i>CPR Certified</span>
                    <span class="text-lg font-bold text-green-400">${cprCount}</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                    <span><i class="fas fa-first-aid mr-2"></i>First Aid</span>
                    <span class="text-lg font-bold text-green-400">${firstAidCount}</span>
                </div>
                <div class="flex justify-between items-center p-3 bg-tertiary-dark rounded">
                    <span><i class="fas fa-swimmer mr-2"></i>Lifeguard</span>
                    <span class="text-lg font-bold text-green-400">${lifeguardCount}</span>
                </div>
            `;
        }
        
        // Populate filter dropdowns
        function populateFilters() {
            const orgFilter = document.getElementById('orgFilter');
            orgFilter.innerHTML = '<option value="">All Organizations</option>';
            
            attendanceData.organizations.forEach(org => {
                const option = document.createElement('option');
                option.value = org.name;
                option.textContent = `${org.name} (${org.participant_count})`;
                orgFilter.appendChild(option);
            });
        }
        
        // Initialize table search functionality
        function initializeTableSearch() {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    const rows = document.querySelectorAll('#participantsTable tr');
                    
                    rows.forEach(row => {
                        const text = row.textContent.toLowerCase();
                        row.style.display = text.includes(searchTerm) ? '' : 'none';
                    });
                });
            }
            
            // Organization filter
            const orgFilter = document.getElementById('orgFilter');
            if (orgFilter) {
                orgFilter.addEventListener('change', function(e) {
                    updateParticipantsTable(e.target.value);
                });
            }
        }
        
        // Export functionality
        function exportData() {
            const dataStr = JSON.stringify(attendanceData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `attendance_export_${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        function exportParticipantsPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // Landscape orientation
            
            // Add title
            doc.setFontSize(20);
            doc.setTextColor(33, 150, 243);
            doc.text('Co-learning Exchange Participants', 148.5, 20, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(128, 128, 128);
            doc.text('June 10-14, 2025 - Flying Dust First Nation', 148.5, 28, { align: 'center' });
            doc.text(`Total Participants: ${attendanceData.participants.length}`, 148.5, 36, { align: 'center' });
            
            // Prepare table data
            const headers = [['#', 'Name', 'Organization', 'Room', 'Total Cost', 'Dietary', 'Medical']];
            const data = attendanceData.participants.map(p => {
                const dietary = [p.food_preferences, p.food_allergies].filter(Boolean).join(', ') || '-';
                const medical = [p.environmental_allergies, p.medical_conditions].filter(Boolean).join(', ') || '-';
                return [
                    p.participant_id,
                    p.name,
                    p.organization,
                    p.room_number,
                    `$${p.total_cost.toFixed(2)}`,
                    dietary,
                    medical
                ];
            });
            
            // Add table using autoTable plugin (we'll use manual table for now)
            let yPosition = 45;
            const pageHeight = 210; // A4 height in landscape
            const cellHeight = 7;
            const margin = 15;
            
            // Draw headers
            doc.setFillColor(37, 37, 37);
            doc.rect(margin, yPosition - 5, 267, cellHeight, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.setFont(undefined, 'bold');
            
            const columnWidths = [10, 45, 60, 45, 25, 40, 42];
            let xPosition = margin;
            headers[0].forEach((header, index) => {
                doc.text(header, xPosition + 2, yPosition);
                xPosition += columnWidths[index];
            });
            
            yPosition += cellHeight + 2;
            
            // Draw data rows
            doc.setFont(undefined, 'normal');
            data.forEach((row, rowIndex) => {
                // Check if we need a new page
                if (yPosition > pageHeight - 20) {
                    doc.addPage();
                    yPosition = 20;
                    
                    // Redraw headers
                    doc.setFillColor(37, 37, 37);
                    doc.rect(margin, yPosition - 5, 267, cellHeight, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFont(undefined, 'bold');
                    xPosition = margin;
                    headers[0].forEach((header, index) => {
                        doc.text(header, xPosition + 2, yPosition);
                        xPosition += columnWidths[index];
                    });
                    yPosition += cellHeight + 2;
                    doc.setFont(undefined, 'normal');
                }
                
                // Alternate row colors
                if (rowIndex % 2 === 0) {
                    doc.setFillColor(245, 245, 245);
                    doc.rect(margin, yPosition - 5, 267, cellHeight, 'F');
                }
                
                doc.setTextColor(0, 0, 0);
                xPosition = margin;
                row.forEach((cell, index) => {
                    const text = cell.toString();
                    const maxWidth = columnWidths[index] - 4;
                    
                    // Truncate text if too long
                    let displayText = text;
                    if (doc.getTextWidth(text) > maxWidth) {
                        while (doc.getTextWidth(displayText + '...') > maxWidth && displayText.length > 0) {
                            displayText = displayText.substring(0, displayText.length - 1);
                        }
                        displayText += '...';
                    }
                    
                    doc.text(displayText, xPosition + 2, yPosition);
                    xPosition += columnWidths[index];
                });
                
                yPosition += cellHeight;
            });
            
            // Add summary
            yPosition += 10;
            if (yPosition > pageHeight - 30) {
                doc.addPage();
                yPosition = 20;
            }
            
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('Summary:', margin, yPosition);
            yPosition += 8;
            
            doc.setFont(undefined, 'normal');
            doc.setFontSize(10);
            doc.text(`Total Revenue: $${attendanceData.summary.total_revenue.toLocaleString('en-CA', {minimumFractionDigits: 2})}`, margin, yPosition);
            yPosition += 6;
            doc.text(`Average Cost per Participant: $${attendanceData.summary.average_cost_per_participant.toFixed(2)}`, margin, yPosition);
            yPosition += 6;
            doc.text(`Organizations: ${attendanceData.summary.organizations_count}`, margin, yPosition);
            
            // Add footer to all pages
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.text(`Page ${i} of ${totalPages}`, 148.5, 200, { align: 'center' });
                doc.text(`Generated on ${new Date().toLocaleDateString('en-CA')}`, 267, 200, { align: 'right' });
            }
            
            // Save the PDF
            doc.save('CoLearning_Exchange_Participants.pdf');
            showNotification('Participants PDF downloaded successfully!', 'success');
        }
        
        // Refresh data
        function refreshData() {
            try {
                initDashboard();
                // Show a non-blocking notification instead of alert
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                notification.textContent = 'Data refreshed successfully!';
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            } catch (error) {
                console.error('Error refreshing data:', error);
            }
        }
        
        // Toggle sidebar for mobile
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('overlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }
        
        // Initialize sidebar state
        if (window.innerWidth < 1024) {
            document.getElementById('sidebar').classList.add('-translate-x-full');
        }
        
        // Window resize handler
        window.addEventListener('resize', function() {
            if (window.innerWidth >= 1024) {
                document.getElementById('sidebar').classList.remove('-translate-x-full');
                document.getElementById('overlay').classList.add('hidden');
            }
        });
        
        // Show specific section
        function showSection(sectionName, event) {
            try {
                console.log('Showing section:', sectionName);
                
                // Prevent default anchor behavior if event exists
                if (event && event.preventDefault) {
                    event.preventDefault();
                }
                
                // Hide all sections
                const sections = ['overview', 'participants', 'organizations', 'accommodations', 'health', 'financial', 'agenda', 'menu', 'changelog'];
                sections.forEach(section => {
                    const element = document.getElementById(section);
                    if (element) {
                        element.classList.add('hidden');
                    }
                });
                
                // Show selected section
                const selectedSection = document.getElementById(sectionName);
                if (selectedSection) {
                    selectedSection.classList.remove('hidden');
                    console.log('Section shown:', sectionName);
                } else {
                    console.error('Section not found:', sectionName);
                }
                
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('bg-tertiary-dark');
                });
                
                // Find and highlight the clicked nav item
                const clickedItem = event && event.currentTarget ? event.currentTarget : document.querySelector(`a[href="#${sectionName}"]`);
                if (clickedItem) {
                    clickedItem.classList.add('bg-tertiary-dark');
                }
                
                // Close mobile sidebar
                if (window.innerWidth < 1024) {
                    const sidebar = document.getElementById('sidebar');
                    const overlay = document.getElementById('overlay');
                    if (sidebar && sidebar.classList && !sidebar.classList.contains('-translate-x-full')) {
                        toggleSidebar();
                    }
                }
            } catch (error) {
                console.error('Error in showSection:', error);
            }
        }
        
        // Update organizations section
        let isEditingOrganizations = false;
        let originalOrganizationsData = null;
        let organizationSortColumn = null;
        let organizationSortDirection = 'asc';
        
        function updateOrganizationsSection() {
            const container = document.getElementById('organizations').querySelector('.bg-secondary-dark');
            
            // Sort organizations if needed
            let sortedOrganizations = [...attendanceData.organizations];
            if (organizationSortColumn) {
                sortedOrganizations.sort((a, b) => {
                    let aVal = a[organizationSortColumn];
                    let bVal = b[organizationSortColumn];
                    
                    if (organizationSortColumn === 'participant_count' || organizationSortColumn === 'total_revenue') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    }
                    
                    if (aVal < bVal) return organizationSortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return organizationSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            
            container.innerHTML = `
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold">Organizations Overview</h2>
                    <div class="flex space-x-2">
                        <button onclick="toggleOrganizationsEdit()" id="editOrganizationsBtn" class="px-4 py-2 bg-accent-blue text-white rounded-lg hover:bg-accent-blue-dark transition-colors">
                            <i class="fas fa-edit mr-2"></i>Edit
                        </button>
                        <button onclick="saveOrganizationsChanges()" id="saveOrganizationsBtn" class="hidden px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-save mr-2"></i>Save
                        </button>
                        <button onclick="cancelOrganizationsEdit()" id="cancelOrganizationsBtn" class="hidden px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full min-w-[700px]">
                        <thead class="bg-tertiary-dark">
                            <tr class="border-b border-secondary-dark">
                                <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortOrganizations('name')">
                                    Organization <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortOrganizations('participant_count')">
                                    <span class="hidden sm:inline">Participants</span>
                                    <span class="sm:hidden">Count</span>
                                    <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-left py-3 px-4 text-text-secondary font-medium cursor-pointer hover:text-accent-blue" onclick="sortOrganizations('total_revenue')">
                                    <span class="hidden sm:inline">Total Revenue</span>
                                    <span class="sm:hidden">Revenue</span>
                                    <i class="fas fa-sort text-xs ml-1"></i>
                                </th>
                                <th class="text-left py-3 px-4 text-text-secondary font-medium hide-mobile">Avg/Person</th>
                                <th class="text-center py-3 px-4 text-text-secondary font-medium">Invoice</th>
                            </tr>
                        </thead>
                        <tbody id="organizationsTable">
                            ${sortedOrganizations.map(org => {
                                const editableClass = isEditingOrganizations ? 'editable-organization cursor-text hover:bg-tertiary-dark hover:ring-1 hover:ring-accent-blue rounded' : '';
                                return `
                                    <tr class="border-b border-tertiary-dark hover:bg-tertiary-dark">
                                        <td class="py-3 px-4 font-medium cursor-pointer hover:text-accent-blue" onclick="showOrganizationProfile('${org.name.replace(/'/g, "\\'")}')">${org.name}</td>
                                        <td class="py-3 px-4 ${editableClass}" data-field="participant_count" data-org-id="${org.id}">
                                            <span class="px-2 py-1 bg-accent-blue bg-opacity-20 text-accent-blue rounded-full text-xs">
                                                ${org.participant_count}
                                            </span>
                                        </td>
                                        <td class="py-3 px-4 ${editableClass}" data-field="total_revenue" data-org-id="${org.id}">
                                            <span class="font-bold text-green-400">$${org.total_revenue.toLocaleString('en-CA', {minimumFractionDigits: 2})}</span>
                                        </td>
                                        <td class="py-3 px-4 hide-mobile">$${(org.total_revenue / org.participant_count).toFixed(2)}</td>
                                        <td class="py-3 px-4 text-center">
                                            <button onclick="generateValidatedInvoice('${org.name.replace(/'/g, "\\'")}')" 
                                                    class="px-3 py-1 bg-accent-blue text-white rounded hover:bg-accent-blue-dark transition-colors text-sm"
                                                    title="Generate Validated Invoice for ${org.name}">
                                                <i class="fas fa-file-invoice-dollar mr-1"></i>
                                                <span class="hidden sm:inline">Invoice</span>
                                                <span class="sm:hidden">PDF</span>
                                            </button>
                                        </td>
                                    </tr>
                                `;
                            }).join('')}
                            <tr class="bg-tertiary-dark font-bold">
                                <td class="py-3 px-4">TOTAL</td>
                                <td class="py-3 px-4">
                                    <span class="px-2 py-1 bg-accent-blue bg-opacity-20 text-accent-blue rounded-full text-xs">
                                        ${attendanceData.participants.length}
                                    </span>
                                </td>
                                <td class="py-3 px-4">
                                    <span class="font-bold text-green-400">$${attendanceData.summary.total_revenue.toLocaleString('en-CA', {minimumFractionDigits: 2})}</span>
                                </td>
                                <td class="py-3 px-4 hide-mobile">$${(attendanceData.summary.total_revenue / attendanceData.participants.length).toFixed(2)}</td>
                                <td class="py-3 px-4 text-center">-</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 p-4 bg-tertiary-dark rounded-lg">
                    <p class="text-sm text-text-secondary">
                        <i class="fas fa-info-circle mr-2"></i>
                        Total of ${attendanceData.organizations.length} organizations with ${attendanceData.participants.length} participants
                    </p>
                </div>
            `;
            
            if (isEditingOrganizations) {
                enableOrganizationsEditing();
            }
        }
        
        // Update accommodations section
        let isEditingAccommodations = false;
        let originalAccommodationsData = null;
        let accommodationSortColumn = null;
        let accommodationSortDirection = 'asc';
        
        function updateAccommodationsSection() {
            const tbody = document.getElementById('accommodationsTable');
            
            // Sort accommodations if needed
            let sortedAccommodations = [...attendanceData.accommodations];
            if (accommodationSortColumn) {
                sortedAccommodations.sort((a, b) => {
                    let aVal = a[accommodationSortColumn];
                    let bVal = b[accommodationSortColumn];
                    
                    if (accommodationSortColumn === 'current_occupancy' || accommodationSortColumn === 'price_per_night') {
                        aVal = parseFloat(aVal) || 0;
                        bVal = parseFloat(bVal) || 0;
                    }
                    
                    if (aVal < bVal) return accommodationSortDirection === 'asc' ? -1 : 1;
                    if (aVal > bVal) return accommodationSortDirection === 'asc' ? 1 : -1;
                    return 0;
                });
            }
            
            tbody.innerHTML = sortedAccommodations.map(acc => {
                const editableClass = isEditingAccommodations ? 'editable-accommodation cursor-text hover:bg-tertiary-dark hover:ring-1 hover:ring-accent-blue rounded' : '';
                return `
                    <tr class="border-b border-tertiary-dark hover:bg-tertiary-dark">
                        <td class="py-3 px-4 whitespace-nowrap">${acc.room_number}</td>
                        <td class="py-3 px-4 ${editableClass}" data-field="room_type" data-room-id="${acc.id}">${acc.room_type}</td>
                        <td class="py-3 px-4 ${editableClass}" data-field="current_occupancy" data-room-id="${acc.id}">
                            <span class="px-2 py-1 bg-accent-blue bg-opacity-20 text-accent-blue rounded-full text-xs whitespace-nowrap">
                                ${acc.current_occupancy} <span class="hidden sm:inline">guests</span>
                            </span>
                        </td>
                        <td class="py-3 px-4 ${editableClass} whitespace-nowrap" data-field="price_per_night" data-room-id="${acc.id}">$${acc.price_per_night.toFixed(2)}</td>
                        <td class="py-3 px-4 font-bold whitespace-nowrap hide-mobile">$${(acc.price_per_night * acc.current_occupancy * 4).toFixed(2)}</td>
                    </tr>
                `;
            }).join('');
            
            if (isEditingAccommodations) {
                enableAccommodationsEditing();
            }
        }
        
        function sortAccommodations(column) {
            if (accommodationSortColumn === column) {
                accommodationSortDirection = accommodationSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                accommodationSortColumn = column;
                accommodationSortDirection = 'asc';
            }
            
            // Update sort icons
            document.querySelectorAll('#accommodations th i.fa-sort, #accommodations th i.fa-sort-up, #accommodations th i.fa-sort-down').forEach(icon => {
                icon.className = 'fas fa-sort text-xs ml-1';
            });
            
            // Update current column icon
            const th = event.currentTarget;
            const icon = th.querySelector('i');
            if (icon) {
                icon.className = `fas fa-sort-${accommodationSortDirection === 'asc' ? 'up' : 'down'} text-xs ml-1`;
            }
            
            updateAccommodationsSection();
        }
        
        function toggleAccommodationsEdit() {
            isEditingAccommodations = true;
            originalAccommodationsData = JSON.stringify(attendanceData.accommodations);
            
            document.getElementById('editAccommodationsBtn').classList.add('hidden');
            document.getElementById('saveAccommodationsBtn').classList.remove('hidden');
            document.getElementById('cancelAccommodationsBtn').classList.remove('hidden');
            
            updateAccommodationsSection();
        }
        
        function enableAccommodationsEditing() {
            document.querySelectorAll('.editable-accommodation').forEach(cell => {
                cell.contentEditable = true;
                cell.addEventListener('focus', handleAccommodationFocus);
                cell.addEventListener('blur', handleAccommodationBlur);
                cell.addEventListener('keydown', handleAccommodationKeydown);
            });
        }
        
        function handleAccommodationFocus(e) {
            const cell = e.target;
            cell.dataset.originalValue = cell.textContent;
            
            const range = document.createRange();
            range.selectNodeContents(cell);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }
        
        function handleAccommodationBlur(e) {
            const cell = e.target;
            const field = cell.dataset.field;
            const roomId = parseInt(cell.dataset.roomId);
            let newValue = cell.textContent.trim();
            
            const accommodation = attendanceData.accommodations.find(a => a.id === roomId);
            if (accommodation) {
                if (field === 'price_per_night') {
                    accommodation[field] = parseFloat(newValue.replace('$', '')) || 0;
                } else if (field === 'current_occupancy') {
                    accommodation[field] = parseInt(newValue.replace(/\D/g, '')) || 1;
                } else {
                    accommodation[field] = newValue;
                }
            }
        }
        
        function handleAccommodationKeydown(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                e.target.blur();
            } else if (e.key === 'Escape') {
                e.target.textContent = e.target.dataset.originalValue;
                e.target.blur();
            }
        }
        
        function saveAccommodationsChanges() {
            // Save to localStorage
            const savedData = localStorage.getItem('colearningTableData') || '{}';
            const tableData = JSON.parse(savedData);
            tableData.accommodations = attendanceData.accommodations;
            tableData.lastUpdated = new Date().toISOString();
            localStorage.setItem('colearningTableData', JSON.stringify(tableData));
            
            isEditingAccommodations = false;
            
            document.getElementById('editAccommodationsBtn').classList.remove('hidden');
            document.getElementById('saveAccommodationsBtn').classList.add('hidden');
            document.getElementById('cancelAccommodationsBtn').classList.add('hidden');
            
            updateAccommodationsSection();
            showNotification('Accommodations saved successfully!', 'success');
        }
        
        function cancelAccommodationsEdit() {
            attendanceData.accommodations = JSON.parse(originalAccommodationsData);
            isEditingAccommodations = false;
            
            document.getElementById('editAccommodationsBtn').classList.remove('hidden');
            document.getElementById('saveAccommodationsBtn').classList.add('hidden');
            document.getElementById('cancelAccommodationsBtn').classList.add('hidden');
            
            updateAccommodationsSection();
        }
        
        // Organizations editing functions
        function sortOrganizations(column) {
            if (organizationSortColumn === column) {
                organizationSortDirection = organizationSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                organizationSortColumn = column;
                organizationSortDirection = 'asc';
            }
            
            // Update sort icons
            document.querySelectorAll('#organizations th i.fa-sort, #organizations th i.fa-sort-up, #organizations th i.fa-sort-down').forEach(icon => {
                icon.className = 'fas fa-sort text-xs ml-1';
            });
            
            // Update current column icon
            const th = event.currentTarget;
            const icon = th.querySelector('i');
            if (icon) {
                icon.className = `fas fa-sort-${organizationSortDirection === 'asc' ? 'up' : 'down'} text-xs ml-1`;
            }
            
            updateOrganizationsSection();
        }
        
        function toggleOrganizationsEdit() {
            isEditingOrganizations = true;
            originalOrganizationsData = JSON.stringify(attendanceData.organizations);
            
            document.getElementById('editOrganizationsBtn').classList.add('hidden');
            document.getElementById('saveOrganizationsBtn').classList.remove('hidden');
            document.getElementById('cancelOrganizationsBtn').classList.remove('hidden');
            
            updateOrganizationsSection();
        }
        
        function enableOrganizationsEditing() {
            document.querySelectorAll('.editable-organization').forEach(cell => {
                cell.contentEditable = true;
                cell.addEventListener('focus', handleOrganizationFocus);
                cell.addEventListener('blur', handleOrganizationBlur);
                cell.addEventListener('keydown', handleOrganizationKeydown);
            });
        }
        
        function handleOrganizationFocus(e) {
            const cell = e.target;
            cell.dataset.originalValue = cell.textContent;
            
            const range = document.createRange();
            range.selectNodeContents(cell);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }
        
        function handleOrganizationBlur(e) {
            const cell = e.target;
            const field = cell.dataset.field;
            const orgId = parseInt(cell.dataset.orgId);
            let newValue = cell.textContent.trim();
            
            const organization = attendanceData.organizations.find(o => o.id === orgId);
            if (organization) {
                if (field === 'total_revenue') {
                    organization[field] = parseFloat(newValue.replace(/[$,]/g, '')) || 0;
                } else if (field === 'participant_count') {
                    organization[field] = parseInt(newValue) || 0;
                }
            }
        }
        
        function handleOrganizationKeydown(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                e.target.blur();
            } else if (e.key === 'Escape') {
                e.target.textContent = e.target.dataset.originalValue;
                e.target.blur();
            }
        }
        
        function saveOrganizationsChanges() {
            // Save to localStorage
            const savedData = localStorage.getItem('colearningTableData') || '{}';
            const tableData = JSON.parse(savedData);
            tableData.organizations = attendanceData.organizations;
            tableData.lastUpdated = new Date().toISOString();
            localStorage.setItem('colearningTableData', JSON.stringify(tableData));
            
            isEditingOrganizations = false;
            
            document.getElementById('editOrganizationsBtn').classList.remove('hidden');
            document.getElementById('saveOrganizationsBtn').classList.add('hidden');
            document.getElementById('cancelOrganizationsBtn').classList.add('hidden');
            
            updateOrganizationsSection();
            showNotification('Organizations saved successfully!', 'success');
        }
        
        function cancelOrganizationsEdit() {
            attendanceData.organizations = JSON.parse(originalOrganizationsData);
            isEditingOrganizations = false;
            
            document.getElementById('editOrganizationsBtn').classList.remove('hidden');
            document.getElementById('saveOrganizationsBtn').classList.add('hidden');
            document.getElementById('cancelOrganizationsBtn').classList.add('hidden');
            
            updateOrganizationsSection();
        }
        
        // Menu section functions
        
        function initializeMenu() {
            const savedMenu = localStorage.getItem('colearningMenu');
            menuData = savedMenu ? JSON.parse(savedMenu) : defaultMenuItems;
            updateMenuDisplay();
            updateFinancialSummary();
        }
        
        function updateMenuDisplay() {
            const menuTable = document.getElementById('menuTable');
            if (!menuTable) return;
            
            menuTable.innerHTML = menuData.map(item => `
                <tr class="border-b border-tertiary-dark hover:bg-tertiary-dark">
                    <td class="py-3 px-4 ${isEditingMenu ? 'editable-menu-cell' : ''}" data-field="date" data-item-id="${item.id}">
                        ${new Date(item.date).toLocaleDateString('en-CA')}
                    </td>
                    <td class="py-3 px-4 ${isEditingMenu ? 'editable-menu-cell' : ''}" data-field="meal" data-item-id="${item.id}">
                        ${item.meal}
                    </td>
                    <td class="py-3 px-4 ${isEditingMenu ? 'editable-menu-cell' : ''}" data-field="description" data-item-id="${item.id}">
                        ${item.description}
                    </td>
                    <td class="py-3 px-4 text-right ${isEditingMenu ? 'editable-menu-cell' : ''}" data-field="cost" data-item-id="${item.id}">
                        $${item.cost.toFixed(2)}
                    </td>
                    <td class="py-3 px-4 text-center">
                        <button onclick="removeMenuItem(${item.id})" class="px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Update summary
            updateMenuSummary();
            
            // Enable editing if in edit mode
            if (isEditingMenu) {
                enableMenuEditing();
            }
        }
        
        function updateMenuSummary() {
            if (!menuData || menuData.length === 0) {
                menuData = defaultMenuItems;
            }
            
            const totalCost = menuData.reduce((sum, item) => sum + item.cost, 0);
            const gst = totalCost * 0.05;
            const pst = totalCost * 0.06;
            const totalWithTax = totalCost + gst + pst;
            
            const totalMenuCostEl = document.getElementById('totalMenuCost');
            const menuGSTEl = document.getElementById('menuGST');
            const menuPSTEl = document.getElementById('menuPST');
            const menuTotalWithTaxEl = document.getElementById('menuTotalWithTax');
            
            if (totalMenuCostEl) totalMenuCostEl.textContent = `$${totalCost.toFixed(2)}`;
            if (menuGSTEl) menuGSTEl.textContent = `$${gst.toFixed(2)}`;
            if (menuPSTEl) menuPSTEl.textContent = `$${pst.toFixed(2)}`;
            if (menuTotalWithTaxEl) menuTotalWithTaxEl.textContent = `$${totalWithTax.toFixed(2)}`;
            
            // Recalculate organization revenues when menu changes
            recalculateOrganizationRevenues();
            
            // Update financial summary when menu changes
            updateFinancialSummary();
        }
        
        function addMenuItem() {
            const date = document.getElementById('menuItemDate').value;
            const meal = document.getElementById('menuItemMeal').value;
            const description = document.getElementById('menuItemDescription').value;
            const cost = parseFloat(document.getElementById('menuItemCost').value) || 0;
            
            if (!date || !meal || !description) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                date: date,
                meal: meal,
                description: description,
                cost: cost
            };
            
            menuData.push(newItem);
            localStorage.setItem('colearningMenu', JSON.stringify(menuData));
            updateMenuDisplay();
            
            // Clear form
            document.getElementById('menuItemDate').value = '';
            document.getElementById('menuItemMeal').value = '';
            document.getElementById('menuItemDescription').value = '';
            document.getElementById('menuItemCost').value = '';
            
            showNotification('Menu item added successfully', 'success');
        }
        
        function removeMenuItem(itemId) {
            if (!confirm('Are you sure you want to remove this menu item?')) return;
            
            menuData = menuData.filter(item => item.id !== itemId);
            localStorage.setItem('colearningMenu', JSON.stringify(menuData));
            updateMenuDisplay();
            showNotification('Menu item removed', 'success');
        }
        
        function toggleMenuEdit() {
            isEditingMenu = true;
            originalMenuData = JSON.stringify(menuData);
            
            document.getElementById('editMenuBtn').classList.add('hidden');
            document.getElementById('saveMenuBtn').classList.remove('hidden');
            document.getElementById('cancelMenuBtn').classList.remove('hidden');
            
            updateMenuDisplay();
        }
        
        function enableMenuEditing() {
            document.querySelectorAll('.editable-menu-cell').forEach(cell => {
                cell.contentEditable = true;
                cell.classList.add('cursor-text', 'hover:bg-tertiary-dark', 'hover:ring-1', 'hover:ring-accent-blue', 'rounded');
                
                cell.addEventListener('blur', function() {
                    const field = this.dataset.field;
                    const itemId = parseInt(this.dataset.itemId);
                    const item = menuData.find(i => i.id === itemId);
                    
                    if (item) {
                        let newValue = this.textContent.trim();
                        
                        if (field === 'cost') {
                            newValue = parseFloat(newValue.replace('$', '')) || 0;
                            item[field] = newValue;
                        } else if (field === 'date') {
                            // Handle date editing - keep as is for now
                            item[field] = item[field];
                        } else {
                            item[field] = newValue;
                        }
                    }
                });
            });
        }
        
        function saveMenuChanges() {
            localStorage.setItem('colearningMenu', JSON.stringify(menuData));
            isEditingMenu = false;
            
            document.getElementById('editMenuBtn').classList.remove('hidden');
            document.getElementById('saveMenuBtn').classList.add('hidden');
            document.getElementById('cancelMenuBtn').classList.add('hidden');
            
            updateMenuDisplay();
            showNotification('Menu changes saved', 'success');
        }
        
        function cancelMenuEdit() {
            menuData = JSON.parse(originalMenuData);
            isEditingMenu = false;
            
            document.getElementById('editMenuBtn').classList.remove('hidden');
            document.getElementById('saveMenuBtn').classList.add('hidden');
            document.getElementById('cancelMenuBtn').classList.add('hidden');
            
            updateMenuDisplay();
        }
        
        // Shopping List functions
        const shoppingListData = [
            { category: 'Meat & Protein', item: 'New York steaks', originalQty: '40', adjustedQty: '31 + 4 veggie alternatives', adjustment: 'Reduced for 5 vegetarians', price: 465.00 },
            { category: 'Meat & Protein', item: 'Burger patties', originalQty: '40', adjustedQty: '30 beef + 10 veggie', adjustment: '10 veggie patties for vegetarians/vegans', price: 180.00 },
            { category: 'Meat & Protein', item: 'Chicken breasts', originalQty: '40', adjustedQty: '31', adjustment: 'Reduced for vegetarians/vegans', price: 248.00 },
            { category: 'Meat & Protein', item: 'Parmesan chicken', originalQty: '40', adjustedQty: '31', adjustment: 'Reduced for vegetarians/vegans', price: 186.00 },
            { category: 'Meat & Protein', item: 'Fried pickerel', originalQty: '40 fillets', adjustedQty: '32-33 fillets', adjustment: 'OK for pescatarians, skip Brenda', price: 320.00 },
            { category: 'Meat & Protein', item: 'Turkey slices', originalQty: '40 wraps', adjustedQty: '31 wraps', adjustment: 'Alternative protein for vegetarians', price: 93.00 },
            { category: 'Meat & Protein', item: 'Eggs', originalQty: '10 dozen', adjustedQty: '10 dozen', adjustment: 'OK for most vegetarians', price: 45.00 },
            { category: 'Meat & Protein', item: 'Tofu/Tempeh', originalQty: '-', adjustedQty: '3kg', adjustment: 'Added for vegan options', price: 36.00 },
            { category: 'Meat & Protein', item: 'Bison roast', originalQty: '-', adjustedQty: '12kg', adjustment: 'For fourth supper feast (~340g/person)', price: 480.00 },
            
            { category: 'Grains', item: 'Wraps', originalQty: '40', adjustedQty: '50', adjustment: 'Extra for variety', price: 30.00 },
            { category: 'Grains', item: 'Garlic bread', originalQty: '8 loaves', adjustedQty: '8 loaves', adjustment: 'No change needed', price: 32.00 },
            { category: 'Grains', item: 'Buns', originalQty: '40', adjustedQty: '45', adjustment: 'Extra for dietary options', price: 27.00 },
            { category: 'Grains', item: 'Spaghetti', originalQty: '4kg', adjustedQty: '4kg', adjustment: 'No change needed', price: 16.00 },
            { category: 'Grains', item: 'Fettuccine', originalQty: '4kg', adjustedQty: '4kg', adjustment: 'No change needed', price: 16.00 },
            { category: 'Grains', item: 'Cereal', originalQty: '5 boxes', adjustedQty: '5 boxes + 2 gluten-free', adjustment: 'Added gluten-free options', price: 45.00 },
            { category: 'Grains', item: 'Bannock mix', originalQty: '8kg', adjustedQty: '8kg', adjustment: 'Traditional item maintained', price: 64.00 },
            { category: 'Grains', item: 'Potato salad', originalQty: '20 lbs', adjustedQty: '15 lbs', adjustment: 'Reduced - Brenda no potatoes', price: 45.00 },
            { category: 'Grains', item: 'Wedges', originalQty: '20 lbs', adjustedQty: '15 lbs + alternatives', adjustment: 'Sweet potato option for Brenda', price: 50.00 },
            { category: 'Grains', item: 'Wild rice', originalQty: '-', adjustedQty: '3kg', adjustment: 'For bison feast', price: 45.00 },
            
            { category: 'Dairy', item: 'Milk', originalQty: '8L', adjustedQty: '6L dairy + 4L alternatives', adjustment: 'Added oat/almond milk for lactose intolerant & vegan', price: 48.00 },
            { category: 'Dairy', item: 'Yogurt', originalQty: '5kg', adjustedQty: '3kg dairy + 2kg coconut', adjustment: 'Non-dairy options added', price: 40.00 },
            { category: 'Dairy', item: 'Parmesan cheese', originalQty: '2kg', adjustedQty: '1.5kg + vegan alternative', adjustment: 'Vegan parmesan added', price: 45.00 },
            { category: 'Dairy', item: 'Butter', originalQty: '2kg', adjustedQty: '1.5kg + 0.5kg vegan', adjustment: 'Plant-based option added', price: 28.00 },
            
            { category: 'Vegetables & Fruit', item: 'Lettuce', originalQty: '10 heads', adjustedQty: '12 heads', adjustment: 'Extra for more salads', price: 36.00 },
            { category: 'Vegetables & Fruit', item: 'Tomatoes', originalQty: '5kg', adjustedQty: '6kg', adjustment: 'Popular item increased', price: 30.00 },
            { category: 'Vegetables & Fruit', item: 'Carrots', originalQty: '5kg', adjustedQty: '3kg + alternatives', adjustment: 'Reduced - Brenda no carrots, added bell peppers', price: 25.00 },
            { category: 'Vegetables & Fruit', item: 'Coleslaw mix', originalQty: '5kg', adjustedQty: '5kg', adjustment: 'No change needed', price: 25.00 },
            { category: 'Vegetables & Fruit', item: 'Berries', originalQty: '6kg', adjustedQty: '7kg', adjustment: 'Popular healthy option', price: 70.00 },
            { category: 'Vegetables & Fruit', item: 'Apples', originalQty: '40', adjustedQty: '45', adjustment: 'Extra for snacks', price: 27.00 },
            { category: 'Vegetables & Fruit', item: 'Fruit cups', originalQty: '40', adjustedQty: '40', adjustment: 'No change needed', price: 60.00 },
            { category: 'Vegetables & Fruit', item: 'Green salad mix', originalQty: '4kg', adjustedQty: '5kg', adjustment: 'Extra for vegetarian meals', price: 40.00 },
            { category: 'Vegetables & Fruit', item: 'Avocados', originalQty: '-', adjustedQty: 'NONE', adjustment: 'ALLERGY WARNING - Adam', price: 0.00 },
            { category: 'Vegetables & Fruit', item: 'Root vegetables mix', originalQty: '-', adjustedQty: '8kg', adjustment: 'Turnips, parsnips, beets for bison feast', price: 32.00 },
            
            { category: 'Bakery & Snacks', item: 'Bagels', originalQty: '80', adjustedQty: '90', adjustment: 'Extra for breakfast variety', price: 45.00 },
            { category: 'Bakery & Snacks', item: 'Granola bars', originalQty: '80', adjustedQty: '80 + 20 diabetic-friendly', adjustment: 'Low-sugar options for Joe', price: 60.00 },
            { category: 'Bakery & Snacks', item: 'Cookies', originalQty: '40', adjustedQty: '40 + sugar-free', adjustment: 'Diabetic options added', price: 30.00 },
            { category: 'Bakery & Snacks', item: 'Muffins', originalQty: '80', adjustedQty: '80 varied', adjustment: 'Include vegan & low-sugar options', price: 80.00 },
            
            { category: 'Beverages', item: 'Blueberry iced tea', originalQty: '40L', adjustedQty: '40L', adjustment: 'No change needed', price: 80.00 },
            { category: 'Beverages', item: 'Juice boxes', originalQty: '80', adjustedQty: '80 + sugar-free', adjustment: 'Sugar-free options for diabetic', price: 48.00 },
            { category: 'Beverages', item: 'Water bottles', originalQty: '80', adjustedQty: '100', adjustment: 'Extra for outdoor activities', price: 50.00 },
            
            { category: 'Other', item: 'Jam', originalQty: '2 jars', adjustedQty: '3 jars varied', adjustment: 'Sugar-free option included', price: 18.00 },
            { category: 'Other', item: 'Hot chocolate mix', originalQty: '1 box', adjustedQty: '2 boxes', adjustment: 'Regular + sugar-free', price: 20.00 },
            { category: 'Other', item: 'Popcorn', originalQty: '4 bags', adjustedQty: '5 bags', adjustment: 'Extra for movie night', price: 20.00 },
            { category: 'Other', item: 'Salt & seasoning', originalQty: 'As needed', adjustedQty: 'Varied', adjustment: 'Include low-sodium options', price: 25.00 },
            { category: 'Other', item: 'Olive oil', originalQty: '-', adjustedQty: '2L', adjustment: 'For cooking (Joe - no veg oil)', price: 30.00 }
        ];
        
        function initializeShoppingList() {
            updateShoppingListDisplay();
        }
        
        function updateShoppingListDisplay() {
            const shoppingTable = document.getElementById('shoppingListTable');
            if (!shoppingTable) return;
            
            let totalCost = 0;
            
            shoppingTable.innerHTML = shoppingListData.map(item => {
                totalCost += item.price;
                return `
                    <tr class="border-b border-tertiary-dark hover:bg-tertiary-dark">
                        <td class="py-3 px-4 font-medium">${item.category}</td>
                        <td class="py-3 px-4">${item.item}</td>
                        <td class="py-3 px-4 text-right">${item.adjustedQty}</td>
                        <td class="py-3 px-4 text-sm text-text-secondary">${item.adjustment}</td>
                        <td class="py-3 px-4 text-right font-medium ${item.price === 0 ? 'text-gray-500' : 'text-green-400'}">
                            ${item.price === 0 ? '-' : `$${item.price.toFixed(2)}`}
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Update total
            document.getElementById('shoppingListTotal').textContent = `$${totalCost.toFixed(2)}`;
        }
        
        function exportMenuPDF() {
            try {
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    throw new Error('jsPDF library not loaded');
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Header
                doc.setFontSize(20);
                doc.setTextColor(33, 150, 243);
                doc.text('Event Menu & Catering', 105, 20, { align: 'center' });
                
                doc.setFontSize(12);
                doc.setTextColor(128, 128, 128);
                doc.text('Co-learning Exchange - June 10-14, 2025', 105, 30, { align: 'center' });
                
                // Table
                let yPosition = 45;
                
                // Table headers
                doc.setFillColor(37, 37, 37);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                
                doc.text('Date', 22, yPosition);
                doc.text('Meal', 50, yPosition);
                doc.text('Description', 100, yPosition);
                doc.text('Cost', 180, yPosition, { align: 'right' });
                
                yPosition += 10;
                
                // Table rows
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                
                menuData.forEach((item, index) => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Alternate row background
                    if (index % 2 === 0) {
                        doc.setFillColor(245, 245, 245);
                        doc.rect(20, yPosition - 5, 170, 7, 'F');
                    }
                    
                    const dateStr = new Date(item.date).toLocaleDateString('en-CA');
                    doc.setFontSize(9);
                    doc.text(dateStr, 22, yPosition);
                    doc.text(item.meal.substring(0, 25), 50, yPosition);
                    
                    // Handle long descriptions
                    const descWords = item.description.split(' ');
                    let descLine = '';
                    let lineCount = 0;
                    
                    for (let word of descWords) {
                        if (doc.getTextWidth(descLine + word) < 70 && lineCount === 0) {
                            descLine += word + ' ';
                        } else {
                            break;
                        }
                    }
                    
                    doc.text(descLine.trim() + (descWords.length > descLine.split(' ').length ? '...' : ''), 80, yPosition);
                    doc.text(`$${item.cost.toFixed(2)}`, 188, yPosition, { align: 'right' });
                    
                    yPosition += 8;
                });
                
                // Summary
                yPosition += 10;
                const totalCost = menuData.reduce((sum, item) => sum + item.cost, 0);
                const gst = totalCost * 0.05;
                const pst = totalCost * 0.06;
                const totalWithTax = totalCost + gst + pst;
                
                doc.setFillColor(240, 240, 240);
                doc.rect(100, yPosition - 5, 90, 30, 'F');
                
                doc.setFont(undefined, 'bold');
                doc.text('Subtotal:', 150, yPosition, { align: 'right' });
                doc.text(`$${totalCost.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                yPosition += 7;
                doc.setFont(undefined, 'normal');
                doc.text('GST (5%):', 150, yPosition, { align: 'right' });
                doc.text(`$${gst.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                yPosition += 7;
                doc.text('PST (6%):', 150, yPosition, { align: 'right' });
                doc.text(`$${pst.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                yPosition += 7;
                doc.setFont(undefined, 'bold');
                doc.text('Total:', 150, yPosition, { align: 'right' });
                doc.text(`$${totalWithTax.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // Save
                doc.save('CoLearning_Exchange_Menu.pdf');
                showNotification('Menu PDF exported successfully', 'success');
                
            } catch (error) {
                console.error('Error exporting menu PDF:', error);
                showNotification('Error exporting menu PDF', 'error');
            }
        }
        
        // Weather functionality
        let weatherData = null;
        const MEADOW_LAKE_COORDS = {
            lat: 54.4167,
            lon: -108.4167
        };
        
        async function fetchWeatherData() {
            try {
                // Using a free weather API that doesn't require authentication
                // For production, you'd want to use a proper API key
                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${MEADOW_LAKE_COORDS.lat}&longitude=${MEADOW_LAKE_COORDS.lon}&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max&timezone=America/Regina&forecast_days=7`);
                
                if (!response.ok) {
                    throw new Error('Weather data fetch failed');
                }
                
                const data = await response.json();
                weatherData = data;
                displayWeatherData(data);
                
                // Save to localStorage with timestamp
                localStorage.setItem('weatherData', JSON.stringify({
                    data: data,
                    timestamp: Date.now()
                }));
                
            } catch (error) {
                console.error('Error fetching weather:', error);
                displayWeatherError();
            }
        }
        
        function displayWeatherData(data) {
            const widget = document.getElementById('weatherWidget');
            if (!widget) return;
            
            const weatherCodes = {
                0: { icon: 'sun', desc: 'Clear sky' },
                1: { icon: 'sun', desc: 'Mainly clear' },
                2: { icon: 'cloud-sun', desc: 'Partly cloudy' },
                3: { icon: 'cloud', desc: 'Overcast' },
                45: { icon: 'smog', desc: 'Foggy' },
                48: { icon: 'smog', desc: 'Depositing rime fog' },
                51: { icon: 'cloud-rain', desc: 'Light drizzle' },
                53: { icon: 'cloud-rain', desc: 'Moderate drizzle' },
                55: { icon: 'cloud-rain', desc: 'Dense drizzle' },
                61: { icon: 'cloud-showers-heavy', desc: 'Slight rain' },
                63: { icon: 'cloud-showers-heavy', desc: 'Moderate rain' },
                65: { icon: 'cloud-showers-heavy', desc: 'Heavy rain' },
                71: { icon: 'snowflake', desc: 'Slight snow' },
                73: { icon: 'snowflake', desc: 'Moderate snow' },
                75: { icon: 'snowflake', desc: 'Heavy snow' },
                77: { icon: 'snowflake', desc: 'Snow grains' },
                80: { icon: 'cloud-showers-heavy', desc: 'Slight rain showers' },
                81: { icon: 'cloud-showers-heavy', desc: 'Moderate rain showers' },
                82: { icon: 'cloud-showers-heavy', desc: 'Violent rain showers' },
                85: { icon: 'snowflake', desc: 'Slight snow showers' },
                86: { icon: 'snowflake', desc: 'Heavy snow showers' },
                95: { icon: 'bolt', desc: 'Thunderstorm' },
                96: { icon: 'bolt', desc: 'Thunderstorm with slight hail' },
                99: { icon: 'bolt', desc: 'Thunderstorm with heavy hail' }
            };
            
            // Find the event dates (June 10-14, 2025)
            const eventStartDate = new Date('2025-06-10');
            const eventEndDate = new Date('2025-06-14');
            const today = new Date();
            
            let html = '<div class="grid grid-cols-2 md:grid-cols-5 gap-4">';
            
            // Show current conditions if available
            if (data.daily && data.daily.time) {
                // Display forecast for event dates or next 5 days
                for (let i = 0; i < Math.min(5, data.daily.time.length); i++) {
                    const date = new Date(data.daily.time[i]);
                    const weatherCode = data.daily.weather_code[i];
                    const weather = weatherCodes[weatherCode] || { icon: 'question', desc: 'Unknown' };
                    const maxTemp = Math.round(data.daily.temperature_2m_max[i]);
                    const minTemp = Math.round(data.daily.temperature_2m_min[i]);
                    const precipitation = data.daily.precipitation_sum[i] || 0;
                    const windSpeed = Math.round(data.daily.wind_speed_10m_max[i]);
                    
                    const isEventDay = date >= eventStartDate && date <= eventEndDate;
                    
                    html += `
                        <div class="bg-tertiary-dark rounded-lg p-4 text-center ${isEventDay ? 'ring-2 ring-accent-blue' : ''}">
                            <div class="text-sm font-medium mb-2 ${isEventDay ? 'text-accent-blue' : 'text-text-secondary'}">
                                ${date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })}
                            </div>
                            <div class="text-3xl mb-2">
                                <i class="fas fa-${weather.icon} ${getWeatherColor(weatherCode)}"></i>
                            </div>
                            <div class="text-xs text-text-secondary mb-2">${weather.desc}</div>
                            <div class="font-bold">
                                ${maxTemp}°C
                                <span class="text-text-secondary font-normal">/ ${minTemp}°C</span>
                            </div>
                            ${precipitation > 0 ? `<div class="text-xs text-blue-400 mt-1"><i class="fas fa-tint"></i> ${precipitation.toFixed(1)}mm</div>` : ''}
                            <div class="text-xs text-text-secondary mt-1">
                                <i class="fas fa-wind"></i> ${windSpeed} km/h
                            </div>
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            
            // Add last updated timestamp
            html += `<div class="text-xs text-text-secondary mt-4 text-center">
                Last updated: ${new Date().toLocaleString('en-US', { timeZone: 'America/Regina' })} CST
            </div>`;
            
            widget.innerHTML = html;
        }
        
        function getWeatherColor(code) {
            if (code <= 1) return 'text-yellow-400';
            if (code <= 3) return 'text-gray-400';
            if (code <= 48) return 'text-gray-500';
            if (code <= 65) return 'text-blue-400';
            if (code <= 77 || code >= 85 && code <= 86) return 'text-blue-200';
            if (code >= 95) return 'text-purple-400';
            return 'text-gray-400';
        }
        
        function displayWeatherError() {
            const widget = document.getElementById('weatherWidget');
            if (!widget) return;
            
            widget.innerHTML = `
                <div class="text-center py-8">
                    <i class="fas fa-exclamation-triangle text-4xl text-yellow-400 mb-4"></i>
                    <p class="text-text-secondary">Unable to load weather data</p>
                    <p class="text-sm text-text-secondary mt-2">Please check your connection and try again</p>
                </div>
            `;
        }
        
        function refreshWeather() {
            const widget = document.getElementById('weatherWidget');
            if (widget) {
                widget.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-4xl text-accent-blue"></i>
                        <p class="mt-2 text-text-secondary">Loading weather data...</p>
                    </div>
                `;
            }
            fetchWeatherData();
        }
        
        function initWeather() {
            // Check if we have cached weather data
            const cached = localStorage.getItem('weatherData');
            if (cached) {
                const { data, timestamp } = JSON.parse(cached);
                // Use cached data if less than 1 hour old
                if (Date.now() - timestamp < 3600000) {
                    displayWeatherData(data);
                    return;
                }
            }
            
            // Otherwise fetch fresh data
            fetchWeatherData();
        }
        
        // Fire Information functionality
        let fireInfoData = null;
        let parkInfoExpanded = false;
        
        function initFireInfo() {
            // Since we can't directly parse the PDF from JavaScript, we'll simulate the fire ban status
            // In a real implementation, this would come from an API or backend service that parses the PDF
            displayFireInfo();
        }
        
        function refreshFireInfo() {
            const statusIcon = document.getElementById('fireStatusIcon');
            const statusTitle = document.getElementById('fireStatusTitle');
            const statusDetails = document.getElementById('fireStatusDetails');
            
            // Show loading state
            if (statusIcon) {
                statusIcon.innerHTML = '<i class="fas fa-spinner fa-spin text-accent-blue"></i>';
            }
            if (statusTitle) {
                statusTitle.textContent = 'Fire Ban Status: Checking...';
            }
            if (statusDetails) {
                statusDetails.innerHTML = '<p>Retrieving current fire restrictions...</p>';
            }
            
            // Simulate API delay
            setTimeout(() => {
                displayFireInfo();
            }, 1000);
        }
        
        function displayFireInfo() {
            const statusIcon = document.getElementById('fireStatusIcon');
            const statusTitle = document.getElementById('fireStatusTitle');
            const statusDetails = document.getElementById('fireStatusDetails');
            
            // Simulate fire ban status based on current date
            // In production, this would be fetched from a real data source
            const currentMonth = new Date().getMonth();
            const isSummerSeason = currentMonth >= 5 && currentMonth <= 8; // June through September
            
            // Randomly determine status for demo (in production, use real data)
            const statuses = [
                {
                    level: 'low',
                    icon: 'fire-extinguisher',
                    color: 'green-500',
                    title: 'No Fire Ban in Effect',
                    details: [
                        'Campfires are permitted in designated fire pits',
                        'Exercise caution and follow all fire safety guidelines',
                        'Keep fires small and attended at all times',
                        'Ensure complete extinguishment before leaving'
                    ]
                },
                {
                    level: 'moderate',
                    icon: 'exclamation-triangle',
                    color: 'yellow-500',
                    title: 'Fire Advisory in Effect',
                    details: [
                        'Increased fire risk due to dry conditions',
                        'Campfires permitted but extra caution required',
                        'No burning between 12:00 PM and 6:00 PM',
                        'Fire permits required for any open burning'
                    ]
                },
                {
                    level: 'high',
                    icon: 'ban',
                    color: 'red-500',
                    title: 'Total Fire Ban in Effect',
                    details: [
                        'ALL open fires are PROHIBITED',
                        'This includes campfires, fire pits, and charcoal BBQs',
                        'Propane/gas stoves and BBQs are permitted',
                        'Violations may result in fines up to $25,000'
                    ]
                }
            ];
            
            // For June (event month), let's show moderate risk
            let status;
            if (currentMonth === 5) { // June
                status = statuses[1]; // Moderate
            } else if (isSummerSeason) {
                status = statuses[Math.random() > 0.7 ? 2 : 1]; // Higher chance of restrictions in summer
            } else {
                status = statuses[0]; // Low risk in other seasons
            }
            
            // Update the display
            if (statusIcon) {
                statusIcon.innerHTML = `<i class="fas fa-${status.icon} text-${status.color}"></i>`;
            }
            
            if (statusTitle) {
                statusTitle.innerHTML = `Fire Ban Status: <span class="text-${status.color}">${status.title}</span>`;
            }
            
            if (statusDetails) {
                statusDetails.innerHTML = status.details.map(detail => 
                    `<p class="flex items-start">
                        <i class="fas fa-chevron-right text-xs mt-1 mr-2 text-${status.color}"></i>
                        <span>${detail}</span>
                    </p>`
                ).join('');
                
                // Add last updated time
                statusDetails.innerHTML += `
                    <p class="text-xs text-text-secondary mt-3">
                        Last updated: ${new Date().toLocaleString('en-US', { timeZone: 'America/Regina' })} CST
                    </p>
                `;
            }
            
            // Store in localStorage
            localStorage.setItem('fireInfoStatus', JSON.stringify({
                status: status,
                timestamp: Date.now()
            }));
        }
        
        // Park Safety Information toggle
        function toggleParkInfo() {
            parkInfoExpanded = !parkInfoExpanded;
            const collapsibles = document.querySelectorAll('.parkInfoCollapsible');
            const toggleIcon = document.getElementById('parkInfoToggleIcon');
            const toggleButton = toggleIcon.parentElement;
            
            if (parkInfoExpanded) {
                collapsibles.forEach(el => el.classList.remove('hidden'));
                toggleIcon.className = 'fas fa-chevron-up mr-1';
                toggleButton.innerHTML = '<i class="fas fa-chevron-up mr-1"></i>Show Less';
            } else {
                collapsibles.forEach(el => el.classList.add('hidden'));
                toggleIcon.className = 'fas fa-chevron-down mr-1';
                toggleButton.innerHTML = '<i class="fas fa-chevron-down mr-1"></i>View All';
            }
        }
        
        // Initialize dashboard on page load
        window.addEventListener('DOMContentLoaded', function() {
            initDashboard();
            initAgenda();
            initializeMenu();
            initializeShoppingList();
            initWeather();
            initFireInfo();
            
            // Recalculate organization revenues after everything is initialized
            recalculateOrganizationRevenues();
            updateStats();
            updateOrganizationsSection();
            updateFinancialSummary();
            
            // Restore sidebar state
            const savedState = localStorage.getItem('sidebarCollapsed');
            if (savedState === 'true' && window.innerWidth >= 1024) {
                collapseSidebar();
            }
            
            // Handle window resize
            let resizeTimer;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(function() {
                    if (window.innerWidth < 1024) {
                        // Reset to mobile state
                        const sidebar = document.getElementById('sidebar');
                        const mainContent = document.getElementById('mainContent');
                        sidebar.classList.add('-translate-x-full');
                        sidebar.classList.remove('lg:w-16', 'lg:w-64');
                        mainContent.classList.remove('lg:ml-16', 'lg:ml-64');
                    } else {
                        // Restore desktop state
                        const sidebar = document.getElementById('sidebar');
                        sidebar.classList.remove('-translate-x-full');
                        if (sidebarCollapsed) {
                            collapseSidebar();
                        } else {
                            expandSidebar();
                        }
                    }
                }, 250);
            });
        });
        
        // Agenda functionality
        let originalAgendaContent = '';
        let isEditingAgenda = false;
        let currentEditingAgenda = null;
        let draggedElement = null;
        let draggedData = null;
        
        const defaultAgenda = {
            days: [
                {
                    date: "Tuesday, June 10, 2025",
                    color: "accent-blue",
                    events: [
                        {
                            time: "5:00 PM",
                            location: "Greig Lake - Meadow Lake Provincial Park",
                            title: "Students arriving from Edmonton by vans",
                            details: []
                        },
                        {
                            time: "5:30 PM",
                            location: "Community Fire Place - Lake Front",
                            title: "Supper - New York Steak Buffet",
                            details: ["Two seasonal green salads, potato salad, garlic toast, dessert, and Blueberry Ice tea"]
                        },
                        {
                            time: "7:00 PM",
                            location: "Presentation Area",
                            title: "Introduction to Flying Dust Market Garden & Projects",
                            details: ["Soil Science presentation by Teresa Porter and Lauren Reynolds (UofS)", "Open sharing time for all participants"]
                        },
                        {
                            time: "After Presentations",
                            location: "Various Locations",
                            title: "Free Time",
                            details: []
                        },
                        {
                            time: "10:30 PM - 12:00 AM",
                            location: "Accommodations",
                            title: "Bedtime",
                            details: []
                        }
                    ]
                },
                {
                    date: "Wednesday, June 11, 2025",
                    color: "green-400",
                    events: [
                        {
                            time: "7:00 AM - 9:00 AM",
                            location: "Dining Room",
                            title: "Breakfast",
                            details: []
                        },
                        {
                            time: "9:00 AM - 12:00 PM",
                            location: "FDFN Market Garden",
                            title: "Market Garden Exploration",
                            details: [
                                "Tour of greenhouse facilities",
                                "Cold frame operations walkthrough",
                                "Irrigation system demonstration",
                                "Soil health assessment areas",
                                "Equipment storage and maintenance facility",
                                "Composting operations",
                                "Seed starting area",
                                "Questions & hands-on exploration"
                            ]
                        },
                        {
                            time: "12:00 PM - 1:00 PM",
                            location: "Dining Room",
                            title: "Lunch",
                            details: []
                        },
                        {
                            time: "1:00 PM - 5:00 PM",
                            location: "Bison Processing Facility",
                            title: "Bison Activity & Value-Added Production",
                            details: [
                                "Tour of bison processing facility",
                                "Value-added product demonstration (jerky, sausages)",
                                "Traditional meat preparation techniques",
                                "Food safety protocols",
                                "Packaging and labeling requirements",
                                "Marketing strategies for Indigenous foods",
                                "Hands-on jerky making workshop",
                                "Product sampling and feedback session"
                            ]
                        },
                        {
                            time: "5:30 PM",
                            location: "Dining Room",
                            title: "Traditional Feast featuring Bison",
                            details: []
                        }
                    ]
                },
                {
                    date: "Thursday, June 12, 2025",
                    color: "yellow-400",
                    events: [
                        {
                            time: "7:00 AM - 9:00 AM",
                            location: "Dining Room",
                            title: "Breakfast",
                            details: []
                        },
                        {
                            time: "9:00 AM - 12:00 PM",
                            location: "FDFN Market Garden",
                            title: "Hands-On Growing Workshop",
                            details: [
                                "Soil preparation techniques",
                                "Direct seeding demonstrations",
                                "Transplanting workshop",
                                "Companion planting strategies",
                                "Indigenous crop varieties (Three Sisters)",
                                "Water management and drip irrigation",
                                "Pest management using natural methods",
                                "Participants plant their own garden beds"
                            ]
                        },
                        {
                            time: "12:00 PM - 1:00 PM",
                            location: "Dining Room",
                            title: "Lunch featuring Market Garden produce",
                            details: []
                        },
                        {
                            time: "1:00 PM - 3:00 PM",
                            location: "Processing Kitchen",
                            title: "Value-Added Production Workshop",
                            details: [
                                "Pickling and preserving vegetables",
                                "Making salsa and hot sauces",
                                "Dehydrating vegetables and herbs",
                                "Packaging for farmers markets",
                                "Food safety certification requirements",
                                "Costing and pricing strategies"
                            ]
                        },
                        {
                            time: "3:00 PM - 5:00 PM",
                            location: "Market Garden & Greenhouse",
                            title: "Season Extension & Technology Integration",
                            details: [
                                "Greenhouse management systems",
                                "Temperature and humidity control",
                                "Winter growing techniques",
                                "LED grow light demonstrations",
                                "Automated watering systems",
                                "Data collection and crop tracking"
                            ]
                        },
                        {
                            time: "5:30 PM",
                            location: "Dining Room",
                            title: "Dinner & Knowledge Sharing Circle",
                            details: []
                        }
                    ]
                },
                {
                    date: "Friday, June 13, 2025",
                    color: "purple-400",
                    events: [
                        {
                            time: "7:00 AM - 9:00 AM",
                            location: "Dining Room",
                            title: "Breakfast",
                            details: []
                        },
                        {
                            time: "9:00 AM - 12:00 PM",
                            location: "FDFN Market Garden",
                            title: "Equipment Operations & Maintenance",
                            details: [
                                "Tractor operation and safety",
                                "Rototiller and bed preparation equipment",
                                "Seeding equipment demonstrations",
                                "Irrigation system maintenance",
                                "Greenhouse climate control systems",
                                "Tool care and storage",
                                "Preventative maintenance schedules",
                                "Hands-on equipment operation"
                            ]
                        },
                        {
                            time: "12:00 PM - 1:00 PM",
                            location: "Dining Room",
                            title: "Lunch",
                            details: []
                        },
                        {
                            time: "1:00 PM - 3:00 PM",
                            location: "Board Room & Market Garden",
                            title: "Business Planning & Marketing",
                            details: [
                                "Market garden financial planning",
                                "CSA (Community Supported Agriculture) models",
                                "Farmers market strategies",
                                "Restaurant and institutional sales",
                                "Social media marketing for farms",
                                "Building customer relationships",
                                "Pricing strategies for profitability"
                            ]
                        },
                        {
                            time: "3:00 PM - 5:00 PM",
                            location: "Market Garden",
                            title: "Harvest & Post-Harvest Workshop",
                            details: [
                                "Optimal harvest timing",
                                "Proper harvesting techniques",
                                "Washing and packing stations",
                                "Cold storage management",
                                "Quality control standards",
                                "Preparing for market presentation",
                                "Reducing post-harvest losses"
                            ]
                        },
                        {
                            time: "5:30 PM",
                            location: "Dining Room",
                            title: "Closing Feast & Cultural Exchange",
                            details: [
                                "Traditional foods prepared with market garden produce",
                                "Participant sharing circle",
                                "Exchange of seeds and knowledge"
                            ]
                        }
                    ]
                },
                {
                    date: "Saturday, June 14, 2025",
                    color: "red-400",
                    events: [
                        {
                            time: "7:00 AM - 9:00 AM",
                            location: "Dining Room",
                            title: "Breakfast",
                            details: []
                        },
                        {
                            time: "9:00 AM - 11:00 AM",
                            location: "Board Room",
                            title: "Wrap-Up Session",
                            details: [
                                "Knowledge Exchange Summary",
                                "Next Steps & Action Items",
                                "Partnership Opportunities",
                                "Future Collaboration Planning",
                                "Closing Ceremony"
                            ]
                        },
                        {
                            time: "11:00 AM",
                            location: "Departure",
                            title: "Guest Departures",
                            details: []
                        }
                    ]
                }
            ],
            notes: [
                "All hands-on activities at the Market Garden require closed-toe shoes and weather-appropriate clothing",
                "Participants will receive work gloves for garden activities",
                "Bring water bottles - refill stations available at all locations",
                "Traditional foods will be featured in meals throughout the exchange",
                "Transportation provided between venues",
                "Photography permitted with consent for knowledge sharing purposes",
                "Seeds and plant materials will be available for participants to take home",
                "Schedule may be adjusted based on weather conditions"
            ]
        };
        
        function initAgenda() {
            // Load saved agenda from localStorage or use default
            const savedAgenda = localStorage.getItem('colearningAgenda');
            const agenda = savedAgenda ? JSON.parse(savedAgenda) : defaultAgenda;
            renderAgenda(agenda, false);
        }
        
        function renderAgenda(agenda, editable = false) {
            const container = document.getElementById('agendaContent');
            let html = '';
            
            // Render each day
            agenda.days.forEach((day, dayIndex) => {
                html += `
                    <div class="mb-8 border-l-4 border-${day.color} pl-4 relative group">
                        ${editable && agenda.days.length > 1 ? `
                            <button onclick="removeDay(${dayIndex})" class="absolute -left-8 top-0 text-red-500 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity" title="Remove this day">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                        <h3 class="text-lg font-semibold text-${day.color} mb-3" ${editable ? `contenteditable="true" data-day="${dayIndex}" data-field="date"` : ''}>${day.date}</h3>
                        <div class="space-y-3 ${editable ? 'drop-zone' : ''}" ${editable ? `data-day-index="${dayIndex}"` : ''}>
                `;
                
                // Render events for each day
                day.events.forEach((event, eventIndex) => {
                    html += `
                        <div class="bg-tertiary-dark rounded-lg p-4 relative group ${editable ? 'draggable-event cursor-move' : ''}" 
                             ${editable ? `draggable="true" data-day-index="${dayIndex}" data-event-index="${eventIndex}"` : ''}>
                            ${editable ? `
                                <div class="absolute top-2 left-2 text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i class="fas fa-grip-vertical"></i>
                                </div>
                                <button onclick="removeEvent(${dayIndex}, ${eventIndex})" class="absolute top-2 right-2 text-red-500 hover:text-red-600 opacity-0 group-hover:opacity-100 transition-opacity">
                                    <i class="fas fa-times"></i>
                                </button>
                            ` : ''}
                            <div class="flex justify-between items-start mb-2">
                                <span class="font-medium" ${editable ? `contenteditable="true" data-day="${dayIndex}" data-event="${eventIndex}" data-field="time"` : ''}>${event.time}</span>
                                <span class="text-sm text-text-secondary" ${editable ? `contenteditable="true" data-day="${dayIndex}" data-event="${eventIndex}" data-field="location"` : ''}>${event.location}</span>
                            </div>
                            <p class="text-sm font-medium mb-2" ${editable ? `contenteditable="true" data-day="${dayIndex}" data-event="${eventIndex}" data-field="title"` : ''}>${event.title}</p>
                    `;
                    
                    if (event.details && event.details.length > 0) {
                        html += '<ul class="text-xs text-text-secondary space-y-1 list-disc list-inside">';
                        event.details.forEach((detail, detailIndex) => {
                            html += `<li ${editable ? `contenteditable="true" data-day="${dayIndex}" data-event="${eventIndex}" data-detail="${detailIndex}"` : ''}>${detail}</li>`;
                        });
                        html += '</ul>';
                    }
                    
                    if (editable) {
                        html += `
                            <div class="mt-2 flex space-x-2">
                                <button onclick="addDetail(${dayIndex}, ${eventIndex})" class="text-xs px-2 py-1 bg-green-500 text-white rounded hover:bg-green-600">
                                    <i class="fas fa-plus mr-1"></i>Add Detail
                                </button>
                                ${event.details.length > 0 ? `<button onclick="removeLastDetail(${dayIndex}, ${eventIndex})" class="text-xs px-2 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                                    <i class="fas fa-minus mr-1"></i>Remove Last Detail
                                </button>` : ''}
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                });
                
                // Add button to add new event
                if (editable) {
                    html += `
                        <div class="mt-3">
                            <button onclick="addEvent(${dayIndex})" class="w-full py-2 border-2 border-dashed border-accent-blue text-accent-blue rounded-lg hover:bg-accent-blue hover:text-white transition-colors">
                                <i class="fas fa-plus mr-2"></i>Add Time Block
                            </button>
                        </div>
                    `;
                }
                
                html += '</div></div>';
            });
            
            // Render notes section
            html += `
                <div class="mt-8 p-4 bg-tertiary-dark rounded-lg">
                    <h4 class="font-medium text-yellow-400 mb-2">
                        <i class="fas fa-info-circle mr-2"></i>Important Notes
                    </h4>
                    <ul class="text-sm text-text-secondary space-y-1 list-disc list-inside">
            `;
            
            agenda.notes.forEach((note, noteIndex) => {
                html += `<li ${editable ? `contenteditable="true" data-note="${noteIndex}"` : ''}>${note}</li>`;
            });
            
            html += '</ul></div>';
            
            // Add button to add new day
            if (editable) {
                html += `
                    <div class="mt-6">
                        <button onclick="addDay()" class="w-full py-3 border-2 border-dashed border-green-400 text-green-400 rounded-lg hover:bg-green-400 hover:text-white transition-colors font-medium">
                            <i class="fas fa-calendar-plus mr-2"></i>Add New Day
                        </button>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
            // Initialize drag and drop if in edit mode
            if (editable) {
                initDragAndDrop();
            }
        }
        
        function toggleAgendaEdit() {
            isEditingAgenda = true;
            const agenda = getCurrentAgenda();
            originalAgendaContent = JSON.stringify(agenda);
            currentEditingAgenda = JSON.parse(JSON.stringify(agenda)); // Deep copy for editing
            
            // Show/hide buttons
            document.getElementById('editAgendaBtn').classList.add('hidden');
            document.getElementById('saveAgendaBtn').classList.remove('hidden');
            document.getElementById('cancelAgendaBtn').classList.remove('hidden');
            
            // Render editable version
            renderAgenda(currentEditingAgenda, true);
        }
        
        function saveAgenda() {
            // Use the current editing agenda
            const agenda = currentEditingAgenda;
            
            // Update agenda from contenteditable fields
            const editableElements = document.querySelectorAll('[contenteditable="true"]');
            editableElements.forEach(el => {
                const text = el.textContent.trim();
                
                if (el.dataset.day !== undefined && el.dataset.field === 'date') {
                    agenda.days[parseInt(el.dataset.day)].date = text;
                } else if (el.dataset.event !== undefined) {
                    const dayIndex = parseInt(el.dataset.day);
                    const eventIndex = parseInt(el.dataset.event);
                    const field = el.dataset.field;
                    
                    if (field) {
                        agenda.days[dayIndex].events[eventIndex][field] = text;
                    } else if (el.dataset.detail !== undefined) {
                        const detailIndex = parseInt(el.dataset.detail);
                        agenda.days[dayIndex].events[eventIndex].details[detailIndex] = text;
                    }
                } else if (el.dataset.note !== undefined) {
                    agenda.notes[parseInt(el.dataset.note)] = text;
                }
            });
            
            // Save to localStorage
            localStorage.setItem('colearningAgenda', JSON.stringify(agenda));
            
            // Reset edit mode
            isEditingAgenda = false;
            currentEditingAgenda = null;
            document.getElementById('editAgendaBtn').classList.remove('hidden');
            document.getElementById('saveAgendaBtn').classList.add('hidden');
            document.getElementById('cancelAgendaBtn').classList.add('hidden');
            
            // Re-render non-editable version
            renderAgenda(agenda, false);
            
            // Show success notification
            showNotification('Agenda saved successfully!', 'success');
        }
        
        function cancelAgendaEdit() {
            isEditingAgenda = false;
            currentEditingAgenda = null; // Reset editing state
            
            // Reset buttons
            document.getElementById('editAgendaBtn').classList.remove('hidden');
            document.getElementById('saveAgendaBtn').classList.add('hidden');
            document.getElementById('cancelAgendaBtn').classList.add('hidden');
            
            // Restore original content
            const agenda = JSON.parse(originalAgendaContent);
            renderAgenda(agenda, false);
        }
        
        function getCurrentAgenda() {
            const savedAgenda = localStorage.getItem('colearningAgenda');
            return savedAgenda ? JSON.parse(savedAgenda) : defaultAgenda;
        }
        
        function getCurrentEditingAgenda() {
            // If we're editing, return the current editing state
            if (isEditingAgenda && currentEditingAgenda) {
                return currentEditingAgenda;
            }
            // Otherwise return from localStorage
            return getCurrentAgenda();
        }
        
        function initDragAndDrop() {
            const draggableEvents = document.querySelectorAll('.draggable-event');
            const dropZones = document.querySelectorAll('.drop-zone');
            
            draggableEvents.forEach(event => {
                event.addEventListener('dragstart', handleDragStart);
                event.addEventListener('dragend', handleDragEnd);
            });
            
            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }
        
        function handleDragStart(e) {
            draggedElement = e.target;
            draggedData = {
                dayIndex: parseInt(e.target.dataset.dayIndex),
                eventIndex: parseInt(e.target.dataset.eventIndex)
            };
            
            e.target.classList.add('opacity-50');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', e.target.innerHTML);
        }
        
        function handleDragEnd(e) {
            e.target.classList.remove('opacity-50');
            
            // Remove all drag-over classes
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('bg-accent-blue', 'bg-opacity-10', 'border-2', 'border-dashed', 'border-accent-blue');
            });
        }
        
        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            
            e.dataTransfer.dropEffect = 'move';
            
            // Add visual feedback
            const dropZone = e.currentTarget;
            dropZone.classList.add('bg-accent-blue', 'bg-opacity-10', 'border-2', 'border-dashed', 'border-accent-blue');
            
            return false;
        }
        
        function handleDragLeave(e) {
            const dropZone = e.currentTarget;
            dropZone.classList.remove('bg-accent-blue', 'bg-opacity-10', 'border-2', 'border-dashed', 'border-accent-blue');
        }
        
        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            e.preventDefault();
            
            const dropZone = e.currentTarget;
            const targetDayIndex = parseInt(dropZone.dataset.dayIndex);
            
            // Remove visual feedback
            dropZone.classList.remove('bg-accent-blue', 'bg-opacity-10', 'border-2', 'border-dashed', 'border-accent-blue');
            
            // Get the current agenda
            const agenda = getCurrentEditingAgenda();
            
            // Get the event being moved
            const eventToMove = agenda.days[draggedData.dayIndex].events[draggedData.eventIndex];
            
            // Find the drop position
            let dropIndex = agenda.days[targetDayIndex].events.length;
            
            // Check if we're dropping on a specific event
            const dropTarget = e.target.closest('.draggable-event');
            if (dropTarget && dropTarget !== draggedElement) {
                const targetEventIndex = parseInt(dropTarget.dataset.eventIndex);
                
                // If same day, adjust for removal
                if (draggedData.dayIndex === targetDayIndex) {
                    dropIndex = targetEventIndex;
                    if (draggedData.eventIndex < targetEventIndex) {
                        dropIndex--;
                    }
                } else {
                    dropIndex = targetEventIndex;
                }
                
                // Check if dropping below or above
                const rect = dropTarget.getBoundingClientRect();
                const y = e.clientY - rect.top;
                if (y > rect.height / 2) {
                    dropIndex++;
                }
            }
            
            // Remove event from original position
            agenda.days[draggedData.dayIndex].events.splice(draggedData.eventIndex, 1);
            
            // Insert at new position
            agenda.days[targetDayIndex].events.splice(dropIndex, 0, eventToMove);
            
            // Re-render the agenda
            renderAgenda(agenda, true);
            
            return false;
        }
        
        function addDetail(dayIndex, eventIndex) {
            const agenda = getCurrentEditingAgenda();
            agenda.days[dayIndex].events[eventIndex].details.push('New detail item');
            renderAgenda(agenda, true);
        }
        
        function removeLastDetail(dayIndex, eventIndex) {
            const agenda = getCurrentEditingAgenda();
            agenda.days[dayIndex].events[eventIndex].details.pop();
            renderAgenda(agenda, true);
        }
        
        function addEvent(dayIndex) {
            const agenda = getCurrentEditingAgenda();
            const newEvent = {
                time: "Time",
                location: "Location",
                title: "New Activity",
                details: []
            };
            agenda.days[dayIndex].events.push(newEvent);
            renderAgenda(agenda, true);
        }
        
        function removeEvent(dayIndex, eventIndex) {
            if (confirm('Are you sure you want to remove this time block?')) {
                // Get the current editing state, not from localStorage
                const container = document.getElementById('agendaContent');
                const agenda = getCurrentEditingAgenda();
                agenda.days[dayIndex].events.splice(eventIndex, 1);
                renderAgenda(agenda, true);
            }
        }
        
        function addDay() {
            const agenda = getCurrentEditingAgenda();
            const colors = ['accent-blue', 'green-400', 'yellow-400', 'purple-400', 'red-400'];
            const newDay = {
                date: "New Day",
                color: colors[agenda.days.length % colors.length],
                events: [
                    {
                        time: "9:00 AM - 12:00 PM",
                        location: "Location",
                        title: "Morning Activity",
                        details: []
                    }
                ]
            };
            agenda.days.push(newDay);
            renderAgenda(agenda, true);
        }
        
        function removeDay(dayIndex) {
            const agenda = getCurrentEditingAgenda();
            if (confirm('Are you sure you want to remove this entire day?')) {
                agenda.days.splice(dayIndex, 1);
                renderAgenda(agenda, true);
            }
        }
        
        function exportAgendaToPDF() {
            try {
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    throw new Error('jsPDF library not loaded');
                }
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const agenda = getCurrentAgenda();
                
                if (!agenda || !agenda.days) {
                    throw new Error('Agenda data not found or invalid');
                }
                
                // Set up document
                doc.setFontSize(20);
                doc.setTextColor(33, 150, 243); // Blue color
                doc.text('Market Garden Co-learning Exchange', 105, 20, { align: 'center' });
                
                doc.setFontSize(14);
                doc.setTextColor(128, 128, 128); // Gray color
                doc.text('June 10-14, 2025 - Flying Dust First Nation', 105, 30, { align: 'center' });
                
                let yPosition = 45;
                const lineHeight = 7;
                const pageHeight = 280;
            
            // Process each day
            agenda.days.forEach((day, dayIndex) => {
                // Check if we need a new page
                if (yPosition > pageHeight - 50) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Day header
                doc.setFontSize(16);
                const rgb = getColorRGB(day.color);
                doc.setTextColor(rgb[0], rgb[1], rgb[2]);
                doc.text(day.date, 20, yPosition);
                yPosition += lineHeight + 3;
                
                // Events for the day
                day.events.forEach((event) => {
                    // Check if we need a new page
                    if (yPosition > pageHeight - 30) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Event time and location
                    doc.setFontSize(12);
                    doc.setTextColor(0, 0, 0);
                    doc.setFont(undefined, 'bold');
                    doc.text(event.time, 25, yPosition);
                    
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(128, 128, 128);
                    doc.text(event.location, 120, yPosition);
                    yPosition += lineHeight;
                    
                    // Event title
                    doc.setFontSize(11);
                    doc.setTextColor(0, 0, 0);
                    doc.text(event.title, 25, yPosition);
                    yPosition += lineHeight;
                    
                    // Event details
                    if (event.details && event.details.length > 0) {
                        doc.setFontSize(10);
                        doc.setTextColor(100, 100, 100);
                        event.details.forEach((detail) => {
                            // Check if we need a new page
                            if (yPosition > pageHeight - 10) {
                                doc.addPage();
                                yPosition = 20;
                            }
                            doc.text('• ' + detail, 30, yPosition);
                            yPosition += lineHeight - 1;
                        });
                    }
                    
                    yPosition += 5; // Space between events
                });
                
                yPosition += 5; // Extra space between days
            });
            
            // Add footer
            const totalPages = doc.internal.getNumberOfPages();
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFontSize(10);
                doc.setTextColor(128, 128, 128);
                doc.text(`Page ${i} of ${totalPages}`, 105, 290, { align: 'center' });
            }
            
            // Save the PDF
            doc.save('CoLearning_Exchange_Agenda_2025.pdf');
            showNotification('Agenda exported to PDF successfully!', 'success');
            } catch (error) {
                console.error('Error exporting agenda to PDF:', error);
                showNotification('Error exporting agenda to PDF. Please check console for details.', 'error');
            }
        }
        
        function getColorRGB(colorClass) {
            const colorMap = {
                'accent-blue': [59, 130, 246],
                'green-400': [74, 222, 128],
                'yellow-400': [250, 204, 21],
                'purple-400': [192, 132, 252],
                'red-400': [248, 113, 113]
            };
            return colorMap[colorClass] || [0, 0, 0];
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            notification.className = `fixed top-4 right-4 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg z-50`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }
        
        // Show participant profile modal
        function showParticipantProfile(participantId) {
            const participant = attendanceData.participants.find(p => p.id === participantId);
            if (!participant) return;
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            const modalContent = document.createElement('div');
            modalContent.className = 'bg-primary-dark rounded-lg p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto';
            
            modalContent.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-2xl font-bold text-accent-blue">${participant.name}</h2>
                    <button onclick="this.closest('.fixed').remove()" class="text-text-secondary hover:text-white">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-tertiary-dark rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-2 text-green-400">Basic Information</h3>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-text-secondary">ID:</span> <span class="font-medium">${participant.participant_id}</span></div>
                            <div><span class="text-text-secondary">Organization:</span> <span class="font-medium">${participant.organization}</span></div>
                            <div><span class="text-text-secondary">Room:</span> <span class="font-medium">${participant.room_number}</span></div>
                            <div><span class="text-text-secondary">Total Cost:</span> <span class="font-medium text-green-400">$${participant.total_cost.toFixed(2)}</span></div>
                        </div>
                    </div>
                    
                    ${(participant.food_preferences || participant.food_allergies) ? `
                    <div class="bg-tertiary-dark rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-2 text-yellow-400">Dietary Requirements</h3>
                        <div class="space-y-1 text-sm">
                            ${participant.food_preferences ? `<p><span class="text-text-secondary">Preferences:</span> ${participant.food_preferences}</p>` : ''}
                            ${participant.food_allergies ? `<p><span class="text-text-secondary">Allergies:</span> <span class="text-red-400">${participant.food_allergies}</span></p>` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${(participant.environmental_allergies || participant.medical_conditions) ? `
                    <div class="bg-tertiary-dark rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-2 text-red-400">Health Information</h3>
                        <div class="space-y-1 text-sm">
                            ${participant.environmental_allergies ? `<p><span class="text-text-secondary">Environmental Allergies:</span> ${participant.environmental_allergies}</p>` : ''}
                            ${participant.medical_conditions ? `<p><span class="text-text-secondary">Medical Conditions:</span> ${participant.medical_conditions}</p>` : ''}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="bg-tertiary-dark rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-2 text-purple-400">Certifications</h3>
                        <div class="grid grid-cols-3 gap-2 text-sm">
                            <div class="text-center">
                                <i class="fas ${participant.cpr_certified?.toLowerCase().includes('y') ? 'fa-check-circle text-green-400' : 'fa-times-circle text-red-400'} text-2xl mb-1"></i>
                                <p class="text-xs">CPR Certified</p>
                            </div>
                            <div class="text-center">
                                <i class="fas ${participant.first_aid_certified?.toLowerCase().includes('y') ? 'fa-check-circle text-green-400' : 'fa-times-circle text-red-400'} text-2xl mb-1"></i>
                                <p class="text-xs">First Aid</p>
                            </div>
                            <div class="text-center">
                                <i class="fas ${participant.lifeguard?.toLowerCase().includes('y') ? 'fa-check-circle text-green-400' : 'fa-times-circle text-red-400'} text-2xl mb-1"></i>
                                <p class="text-xs">Lifeguard</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }
        
        // Show organization profile modal
        function showOrganizationProfile(organizationName) {
            const org = attendanceData.organizations.find(o => o.name === organizationName);
            if (!org) return;
            
            const orgParticipants = attendanceData.participants.filter(p => p.organization === organizationName);
            
            // Create modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            const modalContent = document.createElement('div');
            modalContent.className = 'bg-primary-dark rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto';
            
            modalContent.innerHTML = `
                <div class="flex justify-between items-start mb-4">
                    <h2 class="text-2xl font-bold text-accent-blue">${organizationName}</h2>
                    <button onclick="this.closest('.fixed').remove()" class="text-text-secondary hover:text-white">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <div class="bg-tertiary-dark rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-2 text-green-400">Organization Summary</h3>
                        <div class="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <p class="text-2xl font-bold text-accent-blue">${org.participant_count}</p>
                                <p class="text-sm text-text-secondary">Participants</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-green-400">$${org.total_revenue.toLocaleString('en-CA', {minimumFractionDigits: 2})}</p>
                                <p class="text-sm text-text-secondary">Total Cost</p>
                            </div>
                            <div>
                                <p class="text-2xl font-bold text-yellow-400">$${(org.total_revenue / org.participant_count).toFixed(2)}</p>
                                <p class="text-sm text-text-secondary">Avg/Person</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-tertiary-dark rounded-lg p-4">
                        <h3 class="text-lg font-semibold mb-3 text-purple-400">Participants</h3>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-primary-dark">
                                        <th class="text-left py-2 px-3 text-sm text-text-secondary">Name</th>
                                        <th class="text-left py-2 px-3 text-sm text-text-secondary">Room</th>
                                        <th class="text-right py-2 px-3 text-sm text-text-secondary">Cost</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${orgParticipants.map(p => `
                                        <tr class="border-b border-primary-dark hover:bg-primary-dark cursor-pointer" onclick="showParticipantProfile(${p.id})">
                                            <td class="py-2 px-3 text-sm">${p.name}</td>
                                            <td class="py-2 px-3 text-sm text-text-secondary">${p.room_number}</td>
                                            <td class="py-2 px-3 text-sm text-right font-medium">$${p.total_cost.toFixed(2)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-2">
                        <button onclick="exportOrganizationInvoice('${organizationName.replace(/'/g, "\\'")}')" 
                                class="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 transition-colors">
                            <i class="fas fa-file-invoice mr-2"></i>Export Invoice
                        </button>
                        <button onclick="this.closest('.fixed').remove()" 
                                class="px-4 py-2 bg-tertiary-dark text-white rounded hover:bg-opacity-80 transition-colors">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            modal.appendChild(modalContent);
            document.body.appendChild(modal);
        }
        
        function exportOrganizationInvoice(organizationName) {
            try {
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    throw new Error('jsPDF library not loaded');
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Find organization data
                const org = attendanceData.organizations.find(o => o.name === organizationName);
                if (!org) {
                    throw new Error('Organization not found');
                }
                
                // Get participants for this organization
                const orgParticipants = attendanceData.participants.filter(p => p.organization === organizationName);
                
                // Add header
                doc.setFontSize(24);
                doc.setTextColor(33, 150, 243);
                doc.text('INVOICE', 105, 25, { align: 'center' });
                
                // Add invoice info
                doc.setFontSize(10);
                doc.setTextColor(0, 0, 0);
                doc.text('Invoice Date: ' + new Date().toLocaleDateString('en-CA'), 20, 40);
                doc.text('Invoice #: INV-' + org.id.toString().padStart(4, '0'), 20, 45);
                
                // Add event info
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Co-learning Exchange', 190, 40, { align: 'right' });
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.text('June 10-14, 2025', 190, 45, { align: 'right' });
                doc.text('Flying Dust First Nation', 190, 50, { align: 'right' });
                doc.text('Saskatchewan, Canada', 190, 55, { align: 'right' });
                
                // Add organization info
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Bill To:', 20, 65);
                doc.setFont(undefined, 'normal');
                doc.setFontSize(11);
                doc.text(organizationName, 20, 72);
                
                // Add table headers
                let yPosition = 90;
                doc.setFillColor(37, 37, 37);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                
                doc.text('Participant', 22, yPosition);
                doc.text('Room', 80, yPosition);
                doc.text('Nights', 125, yPosition);
                doc.text('Meals', 145, yPosition);
                doc.text('Total', 175, yPosition, { align: 'right' });
                
                yPosition += 10;
                
                // Add participant rows
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                let subtotal = 0;
                
                orgParticipants.forEach((participant, index) => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Alternate row background
                    if (index % 2 === 0) {
                        doc.setFillColor(245, 245, 245);
                        doc.rect(20, yPosition - 5, 170, 7, 'F');
                    }
                    
                    doc.text(participant.name, 22, yPosition);
                    doc.text(participant.room_number, 80, yPosition);
                    
                    const accommodationCost = participant.room_price * participant.nights;
                    const mealsCost = participant.lunch_cost + participant.supper_cost;
                    
                    doc.text(participant.nights.toString(), 125, yPosition);
                    doc.text(`$${mealsCost.toFixed(2)}`, 145, yPosition);
                    doc.text(`$${participant.total_cost.toFixed(2)}`, 188, yPosition, { align: 'right' });
                    
                    subtotal += participant.total_cost;
                    yPosition += 7;
                });
                
                // Add meals section
                yPosition += 15;
                if (yPosition > 200) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Meals header
                doc.setFillColor(37, 37, 37);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFont(undefined, 'bold');
                doc.text('Catering & Meals', 22, yPosition);
                doc.text('Qty', 140, yPosition);
                doc.text('Cost', 175, yPosition, { align: 'right' });
                
                yPosition += 10;
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                
                // Get menu items
                let mealsCost = 0;
                const participantCount = orgParticipants.length;
                const menuItems = menuData || defaultMenuItems;
                
                menuItems.forEach((item, index) => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    if (index % 2 === 0) {
                        doc.setFillColor(245, 245, 245);
                        doc.rect(20, yPosition - 5, 170, 7, 'F');
                    }
                    
                    // Calculate proportional cost for this organization
                    const itemCostPerPerson = item.cost / attendanceData.participants.length;
                    const orgItemCost = itemCostPerPerson * participantCount;
                    mealsCost += orgItemCost;
                    
                    doc.setFontSize(9);
                    doc.text(item.meal.substring(0, 50), 22, yPosition);
                    doc.text(participantCount.toString(), 140, yPosition);
                    doc.text(`$${orgItemCost.toFixed(2)}`, 188, yPosition, { align: 'right' });
                    
                    yPosition += 7;
                });
                
                // Add summary
                yPosition += 10;
                
                // Check if we need a new page for the summary section
                if (yPosition > 220) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                // Accommodation subtotal
                const accommodationSubtotal = subtotal;
                doc.setFont(undefined, 'bold');
                doc.text('Accommodation Subtotal:', 150, yPosition, { align: 'right' });
                doc.text(`$${accommodationSubtotal.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                yPosition += 7;
                doc.text('Meals Subtotal:', 150, yPosition, { align: 'right' });
                doc.text(`$${mealsCost.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // Add honorarium fee
                yPosition += 7;
                const honorariumPerParticipant = FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT;
                const totalHonorarium = honorariumPerParticipant * participantCount;
                doc.setFontSize(9);
                doc.text('Presenter & Community Honorarium:', 150, yPosition, { align: 'right' });
                doc.setFontSize(10);
                doc.setFont(undefined, 'bold');
                doc.text(`$${totalHonorarium.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // Grand subtotal
                yPosition += 10;
                const grandSubtotal = accommodationSubtotal + mealsCost + totalHonorarium;
                doc.setFillColor(240, 240, 240);
                doc.rect(100, yPosition - 5, 90, 8, 'F');
                doc.text('Subtotal:', 150, yPosition, { align: 'right' });
                doc.text(`$${grandSubtotal.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // Gratuity (only on accommodation and meals, not honorarium)
                yPosition += 10;
                const gratuityBase = accommodationSubtotal + mealsCost;
                const gratuity = gratuityBase * FINANCIAL_CONSTANTS.GRATUITY_RATE;
                doc.setFont(undefined, 'normal');
                doc.text('Gratuity (15%):', 150, yPosition, { align: 'right' });
                doc.text(`$${gratuity.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // Subtotal with gratuity
                const subtotalWithGratuity = grandSubtotal + gratuity;
                
                // GST
                yPosition += 10;
                const gst = subtotalWithGratuity * FINANCIAL_CONSTANTS.GST_RATE;
                doc.text('GST (5%):', 150, yPosition, { align: 'right' });
                doc.text(`$${gst.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // PST
                yPosition += 7;
                const pst = subtotalWithGratuity * FINANCIAL_CONSTANTS.PST_RATE;
                doc.text('PST (6%):', 150, yPosition, { align: 'right' });
                doc.text(`$${pst.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // Total - ensure it fits on the page
                yPosition += 10;
                if (yPosition > 260) {
                    doc.addPage();
                    yPosition = 30;
                }
                
                const total = subtotalWithGratuity + gst + pst;
                doc.setFillColor(33, 150, 243);
                doc.rect(100, yPosition - 5, 90, 10, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFont(undefined, 'bold');
                doc.setFontSize(12);
                doc.text('TOTAL:', 150, yPosition, { align: 'right' });
                doc.text(`$${total.toFixed(2)}`, 188, yPosition, { align: 'right' });
                
                // Add footer at the bottom of the current page
                const pageCount = doc.internal.getNumberOfPages();
                doc.setPage(pageCount);
                doc.setTextColor(100, 100, 100);
                doc.setFontSize(8);
                doc.setFont(undefined, 'normal');
                doc.text('Thank you for participating in the Co-learning Exchange', 105, 285, { align: 'center' });
                
                // Save the PDF
                const fileName = `Invoice_${organizationName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                showNotification(`Invoice for ${organizationName} downloaded successfully!`, 'success');
                
            } catch (error) {
                console.error('Error generating invoice:', error);
                showNotification('Error generating invoice. Please check console for details.', 'error');
            }
        }
        
        // Table editing functions
        let originalTableData = null;
        let currentEditingTable = null;
        
        function sortTable(column) {
            if (participantSortColumn === column) {
                participantSortDirection = participantSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                participantSortColumn = column;
                participantSortDirection = 'asc';
            }
            
            // Update sort icons
            document.querySelectorAll('th i.fa-sort, th i.fa-sort-up, th i.fa-sort-down').forEach(icon => {
                icon.className = 'fas fa-sort text-xs ml-1';
            });
            
            // Update current column icon
            const th = event.currentTarget;
            const icon = th.querySelector('i');
            if (icon) {
                icon.className = `fas fa-sort-${participantSortDirection === 'asc' ? 'up' : 'down'} text-xs ml-1`;
            }
            
            updateParticipantsTable(document.getElementById('orgFilter').value);
        }
        
        function toggleTableEdit(tableType) {
            currentEditingTable = tableType;
            isEditingTable = true;
            
            // Save original data
            const savedData = localStorage.getItem('colearningTableData');
            const tableData = savedData ? JSON.parse(savedData) : { participants: attendanceData.participants };
            originalTableData = JSON.stringify(tableData);
            
            // Update buttons
            document.getElementById(`edit${capitalize(tableType)}Btn`).classList.add('hidden');
            document.getElementById(`save${capitalize(tableType)}Btn`).classList.remove('hidden');
            document.getElementById(`cancel${capitalize(tableType)}Btn`).classList.remove('hidden');
            
            // Enable editing
            updateParticipantsTable(document.getElementById('orgFilter').value);
            
            // Add editing styles
            document.querySelectorAll('.editable-cell').forEach(cell => {
                cell.classList.add('cursor-text', 'hover:bg-tertiary-dark', 'hover:ring-1', 'hover:ring-accent-blue', 'rounded');
            });
        }
        
        function enableTableEditing() {
            document.querySelectorAll('.editable-cell').forEach(cell => {
                cell.contentEditable = true;
                cell.addEventListener('focus', handleCellFocus);
                cell.addEventListener('blur', handleCellBlur);
                cell.addEventListener('keydown', handleCellKeydown);
            });
        }
        
        function handleCellFocus(e) {
            const cell = e.target;
            cell.dataset.originalValue = cell.textContent;
            
            // Select all text for easy editing
            const range = document.createRange();
            range.selectNodeContents(cell);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
        }
        
        function handleCellBlur(e) {
            const cell = e.target;
            const field = cell.dataset.field;
            const participantId = parseInt(cell.dataset.participantId);
            const newValue = cell.textContent.trim();
            
            // Update the data
            const participant = attendanceData.participants.find(p => p.id === participantId);
            if (participant) {
                if (field === 'total_cost') {
                    participant[field] = parseFloat(newValue.replace('$', '')) || 0;
                } else if (field === 'dietary') {
                    const parts = newValue.split(',').map(s => s.trim());
                    participant.food_preferences = parts[0] || '';
                    participant.food_allergies = parts[1] || '';
                } else if (field === 'medical') {
                    const parts = newValue.split(',').map(s => s.trim());
                    participant.environmental_allergies = parts[0] || '';
                    participant.medical_conditions = parts[1] || '';
                } else {
                    participant[field] = newValue;
                }
                
                // Update organization if changed
                if (field === 'organization') {
                    updateOrganizationCounts();
                }
            }
        }
        
        function handleCellKeydown(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                e.target.blur();
            } else if (e.key === 'Escape') {
                e.target.textContent = e.target.dataset.originalValue;
                e.target.blur();
            }
        }
        
        function saveTableChanges(tableType) {
            // Save to localStorage
            const tableData = {
                participants: attendanceData.participants,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('colearningTableData', JSON.stringify(tableData));
            
            // Update summary statistics
            updateStats();
            updateOrganizationCounts();
            
            // Reset edit mode
            isEditingTable = false;
            currentEditingTable = null;
            
            // Update buttons
            document.getElementById(`edit${capitalize(tableType)}Btn`).classList.remove('hidden');
            document.getElementById(`save${capitalize(tableType)}Btn`).classList.add('hidden');
            document.getElementById(`cancel${capitalize(tableType)}Btn`).classList.add('hidden');
            
            // Disable editing
            document.querySelectorAll('.editable-cell').forEach(cell => {
                cell.contentEditable = false;
                cell.classList.remove('cursor-text', 'hover:bg-tertiary-dark', 'hover:ring-1', 'hover:ring-accent-blue', 'rounded');
            });
            
            // Refresh the table
            updateParticipantsTable(document.getElementById('orgFilter').value);
            
            showNotification('Table changes saved successfully!', 'success');
        }
        
        function cancelTableEdit(tableType) {
            // Restore original data
            const originalData = JSON.parse(originalTableData);
            Object.assign(attendanceData, originalData);
            
            // Reset edit mode
            isEditingTable = false;
            currentEditingTable = null;
            
            // Update buttons
            document.getElementById(`edit${capitalize(tableType)}Btn`).classList.remove('hidden');
            document.getElementById(`save${capitalize(tableType)}Btn`).classList.add('hidden');
            document.getElementById(`cancel${capitalize(tableType)}Btn`).classList.add('hidden');
            
            // Refresh the table
            updateParticipantsTable(document.getElementById('orgFilter').value);
            
            // Disable editing
            document.querySelectorAll('.editable-cell').forEach(cell => {
                cell.contentEditable = false;
                cell.classList.remove('cursor-text', 'hover:bg-tertiary-dark', 'hover:ring-1', 'hover:ring-accent-blue', 'rounded');
            });
        }
        
        function updateOrganizationCounts() {
            // Recalculate organization statistics
            const orgCounts = {};
            
            attendanceData.participants.forEach(p => {
                if (!orgCounts[p.organization]) {
                    orgCounts[p.organization] = 0;
                }
                orgCounts[p.organization]++;
            });
            
            // Update organizations array with invoice total calculation
            attendanceData.organizations = Object.keys(orgCounts).map((org, index) => ({
                id: index + 1,
                name: org,
                participant_count: orgCounts[org],
                total_revenue: calculateOrganizationInvoiceTotal(org)
            }));
            
            // Update summary totals using invoice total calculation
            let totalRevenue = 0;
            attendanceData.organizations.forEach(org => {
                totalRevenue += org.total_revenue;
            });
            
            attendanceData.summary.total_revenue = totalRevenue;
            attendanceData.summary.total_participants = attendanceData.participants.length;
            attendanceData.summary.organizations_count = Object.keys(orgCounts).length;
            attendanceData.summary.average_cost_per_participant = totalRevenue / attendanceData.participants.length;
            
            // Update all displays
            updateStats();
            updateCharts();
            updateOrganizationsSection();
            updateFinancialSummary();
        }
        
        function capitalize(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        // Load saved table data on init
        function loadSavedTableData() {
            const savedData = localStorage.getItem('colearningTableData');
            if (savedData) {
                const tableData = JSON.parse(savedData);
                if (tableData.participants) {
                    attendanceData.participants = tableData.participants;
                    updateOrganizationCounts();
                }
                if (tableData.accommodations) {
                    attendanceData.accommodations = tableData.accommodations;
                }
            }
        }
        
        // Update initialization
        const originalInitDashboard = initDashboard;
        initDashboard = function() {
            loadSavedTableData();
            originalInitDashboard();
        };
        
        // Generate validated invoice with proper meal handling and gratuity logic
        function generateValidatedInvoice(organizationName) {
            try {
                if (!window.jspdf || !window.jspdf.jsPDF) {
                    throw new Error('jsPDF library not loaded');
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Find organization data
                const org = attendanceData.organizations.find(o => o.name === organizationName);
                if (!org) {
                    throw new Error('Organization not found');
                }
                
                // Get participants for this organization
                const orgParticipants = attendanceData.participants.filter(p => p.organization === organizationName);
                if (orgParticipants.length === 0) {
                    throw new Error('No participants found for this organization');
                }
                
                // Generate unique invoice number
                const invoiceNumber = 'INV-' + new Date().getFullYear() + '-' + org.id.toString().padStart(4, '0');
                const invoiceDate = new Date().toLocaleDateString('en-CA', { year: 'numeric', month: 'long', day: 'numeric' });
                
                // Header Section
                doc.setFontSize(28);
                doc.setTextColor(15, 15, 15);
                doc.text('INVOICE', 105, 25, { align: 'center' });
                
                // Invoice metadata
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text('Invoice Number: ' + invoiceNumber, 20, 40);
                doc.text('Invoice Date: ' + invoiceDate, 20, 45);
                doc.text('Payment Terms: Net 30', 20, 50);
                
                // Event Information
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(59, 130, 246);
                doc.text('Co-learning Exchange', 190, 40, { align: 'right' });
                doc.setFont(undefined, 'normal');
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text('June 10-14, 2025', 190, 45, { align: 'right' });
                doc.text('Flying Dust First Nation', 190, 50, { align: 'right' });
                doc.text('Waters Edge Eco Lodge', 190, 55, { align: 'right' });
                doc.text('Meadow Lake Provincial Park, SK', 190, 60, { align: 'right' });
                
                // Billing Information
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('Bill To:', 20, 65);
                doc.setFont(undefined, 'normal');
                doc.setFontSize(11);
                doc.text(organizationName, 20, 72);
                doc.setFontSize(10);
                doc.text(`${orgParticipants.length} Participants`, 20, 77);
                
                // Section 1: Participant Room Charges
                let yPosition = 95;
                doc.setFillColor(245, 245, 245);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('ACCOMMODATION CHARGES', 22, yPosition);
                
                yPosition += 10;
                // Table headers
                doc.setFillColor(37, 37, 37);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.text('Participant Name', 22, yPosition);
                doc.text('Room/Cabin', 80, yPosition);
                doc.text('Nights', 125, yPosition, { align: 'center' });
                doc.text('Rate/Night', 145, yPosition, { align: 'right' });
                doc.text('Total', 185, yPosition, { align: 'right' });
                
                yPosition += 10;
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                
                let accommodationSubtotal = 0;
                
                orgParticipants.forEach((participant, index) => {
                    if (yPosition > 250) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Alternate row background
                    if (index % 2 === 0) {
                        doc.setFillColor(250, 250, 250);
                        doc.rect(20, yPosition - 5, 170, 7, 'F');
                    }
                    
                    const roomCost = participant.room_price * participant.nights;
                    const discountedCost = roomCost * (1 - FINANCIAL_CONSTANTS.ROOM_DISCOUNT_RATE);
                    accommodationSubtotal += discountedCost;
                    
                    doc.setFontSize(9);
                    doc.text(participant.name.substring(0, 35), 22, yPosition);
                    doc.setFontSize(8);
                    doc.text(participant.room_number, 80, yPosition);
                    doc.text(participant.nights.toString(), 125, yPosition, { align: 'center' });
                    doc.text(`$${participant.room_price.toFixed(2)}`, 145, yPosition, { align: 'right' });
                    doc.text(`$${roomCost.toFixed(2)}`, 185, yPosition, { align: 'right' });
                    
                    yPosition += 7;
                });
                
                // Show room discount
                yPosition += 3;
                doc.setFont(undefined, 'normal');
                doc.setFontSize(8);
                const totalBeforeDiscount = orgParticipants.reduce((sum, p) => sum + (p.room_price * p.nights), 0);
                const discountAmount = totalBeforeDiscount * FINANCIAL_CONSTANTS.ROOM_DISCOUNT_RATE;
                
                doc.text('Room Total (before discount):', 140, yPosition, { align: 'right' });
                doc.text(`$${totalBeforeDiscount.toFixed(2)}`, 185, yPosition, { align: 'right' });
                yPosition += 5;
                
                doc.setTextColor(34, 197, 94); // Green for discount
                doc.text('15% Room Discount:', 140, yPosition, { align: 'right' });
                doc.text(`-$${discountAmount.toFixed(2)}`, 185, yPosition, { align: 'right' });
                yPosition += 5;
                
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'bold');
                doc.setFontSize(9);
                doc.text('Accommodation Subtotal:', 140, yPosition, { align: 'right' });
                doc.text(`$${accommodationSubtotal.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Section 2: Catering & Meals
                yPosition += 15;
                if (yPosition > 200) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFillColor(245, 245, 245);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.setTextColor(0, 0, 0);
                doc.text('CATERING & MEALS', 22, yPosition);
                
                yPosition += 10;
                // Meals table headers
                doc.setFillColor(37, 37, 37);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.text('Event', 22, yPosition);
                doc.text('Quantity', 125, yPosition, { align: 'center' });
                doc.text('Unit Cost', 145, yPosition, { align: 'right' });
                doc.text('Total', 185, yPosition, { align: 'right' });
                
                yPosition += 10;
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'normal');
                
                let mealsSubtotal = 0;
                const menuItems = menuData || defaultMenuItems;
                const participantCount = orgParticipants.length;
                
                // First, add bagged lunches as a single line item
                const lunchQuantity = participantCount * 4; // 4 lunches per participant
                const lunchUnitCost = 15.00;
                const lunchTotal = lunchQuantity * lunchUnitCost;
                mealsSubtotal += lunchTotal;
                
                // Add lunch line
                doc.setFillColor(250, 250, 250);
                doc.rect(20, yPosition - 5, 170, 7, 'F');
                doc.setFontSize(9);
                doc.text('Bagged Lunches (4 days)', 22, yPosition);
                doc.text(lunchQuantity.toString(), 125, yPosition, { align: 'center' });
                doc.text(`$${lunchUnitCost.toFixed(2)}`, 145, yPosition, { align: 'right' });
                doc.text(`$${lunchTotal.toFixed(2)}`, 185, yPosition, { align: 'right' });
                yPosition += 7;
                
                // Then add suppers as a single line item (4 days × participants × $30)
                const supperQuantity = participantCount * 4; // 4 suppers per participant
                const supperUnitCost = 30.00;
                const supperTotal = supperQuantity * supperUnitCost;
                mealsSubtotal += supperTotal;
                
                // Add supper line
                doc.setFillColor(255, 255, 255);
                doc.rect(20, yPosition - 5, 170, 7, 'F');
                doc.setFontSize(9);
                doc.text('Suppers (4 days)', 22, yPosition);
                doc.text(supperQuantity.toString(), 125, yPosition, { align: 'center' });
                doc.text(`$${supperUnitCost.toFixed(2)}`, 145, yPosition, { align: 'right' });
                doc.text(`$${supperTotal.toFixed(2)}`, 185, yPosition, { align: 'right' });
                yPosition += 7;
                
                // Meals Subtotal
                yPosition += 3;
                doc.setFont(undefined, 'bold');
                doc.text('Catering & Meals Subtotal:', 140, yPosition, { align: 'right' });
                doc.text(`$${mealsSubtotal.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Section 3: Additional Fees
                yPosition += 15;
                if (yPosition > 220) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFillColor(245, 245, 245);
                doc.rect(20, yPosition - 5, 170, 8, 'F');
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text('ADDITIONAL FEES', 22, yPosition);
                
                yPosition += 10;
                doc.setFont(undefined, 'normal');
                const honorariumTotal = FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT * participantCount;
                doc.text('Presenter & Community Honorarium', 22, yPosition);
                doc.text(`${participantCount} × $${FINANCIAL_CONSTANTS.HONORARIUM_PER_PARTICIPANT.toFixed(2)}`, 125, yPosition, { align: 'center' });
                doc.text(`$${honorariumTotal.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Summary Section
                yPosition += 20;
                if (yPosition > 200) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setDrawColor(200, 200, 200);
                doc.line(100, yPosition, 190, yPosition);
                yPosition += 10;
                
                // Subtotal before gratuity
                const subtotalBeforeGratuity = accommodationSubtotal + mealsSubtotal + honorariumTotal;
                doc.setFont(undefined, 'normal');
                doc.text('Subtotal:', 150, yPosition, { align: 'right' });
                doc.text(`$${subtotalBeforeGratuity.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Gratuity (15% on accommodation and meals only)
                yPosition += 7;
                const gratuityBase = accommodationSubtotal + mealsSubtotal;
                const gratuity = gratuityBase * FINANCIAL_CONSTANTS.GRATUITY_RATE;
                doc.text('Gratuity (15% on Accommodation & Meals):', 150, yPosition, { align: 'right' });
                doc.text(`$${gratuity.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Subtotal after gratuity
                yPosition += 7;
                const subtotalWithGratuity = subtotalBeforeGratuity + gratuity;
                doc.setFillColor(245, 245, 245);
                doc.rect(100, yPosition - 5, 90, 8, 'F');
                doc.setFont(undefined, 'bold');
                doc.text('Subtotal with Gratuity:', 150, yPosition, { align: 'right' });
                doc.text(`$${subtotalWithGratuity.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Taxes
                yPosition += 10;
                doc.setFont(undefined, 'normal');
                const gst = subtotalWithGratuity * FINANCIAL_CONSTANTS.GST_RATE;
                doc.text('GST (5%):', 150, yPosition, { align: 'right' });
                doc.text(`$${gst.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                yPosition += 7;
                const pst = subtotalWithGratuity * FINANCIAL_CONSTANTS.PST_RATE;
                doc.text('PST (6%):', 150, yPosition, { align: 'right' });
                doc.text(`$${pst.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Total taxes
                yPosition += 7;
                const totalTaxes = gst + pst;
                doc.text('Total Taxes:', 150, yPosition, { align: 'right' });
                doc.text(`$${totalTaxes.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Grand Total
                yPosition += 10;
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 30;
                }
                
                const grandTotal = subtotalWithGratuity + totalTaxes;
                doc.setFillColor(59, 130, 246);
                doc.rect(100, yPosition - 5, 90, 10, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFont(undefined, 'bold');
                doc.setFontSize(12);
                doc.text('AMOUNT DUE:', 150, yPosition, { align: 'right' });
                doc.text(`$${grandTotal.toFixed(2)}`, 185, yPosition, { align: 'right' });
                
                // Footer
                doc.setTextColor(100, 100, 100);
                doc.setFontSize(9);
                doc.setFont(undefined, 'normal');
                const pageHeight = doc.internal.pageSize.height;
                doc.text('Thank you for participating in the Co-learning Exchange.', 105, pageHeight - 20, { align: 'center' });
                doc.text('We appreciate your collaboration.', 105, pageHeight - 15, { align: 'center' });
                
                // Add page numbers
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(`Page ${i} of ${pageCount}`, 105, pageHeight - 10, { align: 'center' });
                }
                
                // Save the PDF
                const fileName = `CoLearning_Invoice_${organizationName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);
                showNotification(`Validated invoice for ${organizationName} generated successfully!`, 'success');
                
            } catch (error) {
                console.error('Error generating validated invoice:', error);
                showNotification('Error generating invoice: ' + error.message, 'error');
            }
        }
        
        // Weather functions
        function refreshWeather() {
            const weatherWidget = document.getElementById('weatherWidget');
            if (weatherWidget) {
                weatherWidget.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
                        ${generateWeatherForecast()}
                    </div>
                `;
            }
        }
        
        function generateWeatherForecast() {
            // Simulated weather data for June 10-14, 2025
            const forecast = [
                { date: 'Mon Jun 10', high: 21, low: 12, condition: 'Partly Cloudy', icon: 'fa-cloud-sun' },
                { date: 'Tue Jun 11', high: 23, low: 14, condition: 'Sunny', icon: 'fa-sun' },
                { date: 'Wed Jun 12', high: 22, low: 13, condition: 'Mostly Sunny', icon: 'fa-cloud-sun' },
                { date: 'Thu Jun 13', high: 20, low: 11, condition: 'Light Rain', icon: 'fa-cloud-rain' },
                { date: 'Fri Jun 14', high: 19, low: 10, condition: 'Partly Cloudy', icon: 'fa-cloud' }
            ];
            
            return forecast.map(day => `
                <div class="bg-tertiary-dark rounded-lg p-4 text-center">
                    <div class="font-semibold text-sm">${day.date}</div>
                    <div class="my-3">
                        <i class="fas ${day.icon} text-3xl text-accent-blue"></i>
                    </div>
                    <div class="text-2xl font-bold">${day.high}°</div>
                    <div class="text-sm text-text-secondary">${day.low}°</div>
                    <div class="text-xs mt-2">${day.condition}</div>
                </div>
            `).join('');
        }
        
        function refreshFireInfo() {
            const fireStatusIcon = document.getElementById('fireStatusIcon');
            const fireStatusTitle = document.getElementById('fireStatusTitle');
            const fireStatusDetails = document.getElementById('fireStatusDetails');
            
            if (fireStatusIcon && fireStatusTitle && fireStatusDetails) {
                // Simulated fire ban status
                fireStatusIcon.innerHTML = '<i class="fas fa-fire-extinguisher text-green-500"></i>';
                fireStatusTitle.textContent = 'Fire Ban Status: No Current Restrictions';
                fireStatusDetails.innerHTML = `
                    <p class="text-green-400 font-semibold">✓ Campfires are currently permitted</p>
                    <p>• Follow all standard fire safety protocols</p>
                    <p>• Keep fires small and contained</p>
                    <p>• Ensure complete extinguishment</p>
                    <p class="mt-2 text-xs">Last updated: ${new Date().toLocaleString('en-CA')}</p>
                `;
            }
        }
        
        function toggleParkInfo() {
            const collapsibles = document.querySelectorAll('.parkInfoCollapsible');
            const icon = document.getElementById('parkInfoToggleIcon');
            
            collapsibles.forEach(el => {
                el.classList.toggle('hidden');
            });
            
            if (icon) {
                if (icon.classList.contains('fa-chevron-down')) {
                    icon.classList.remove('fa-chevron-down');
                    icon.classList.add('fa-chevron-up');
                } else {
                    icon.classList.remove('fa-chevron-up');
                    icon.classList.add('fa-chevron-down');
                }
            }
        }
        
        // Initialize weather and fire info on page load
        function initializeHealthSafety() {
            refreshWeather();
            refreshFireInfo();
        }
        
        // Initialize dashboard when page loads
        window.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Starting dashboard initialization...');
                initDashboard();
                initializeHealthSafety();
                console.log('Dashboard initialization complete');
            } catch (error) {
                console.error('Dashboard initialization error:', error);
                console.error('Error stack:', error.stack);
                
                // Show error to user
                const mainContent = document.getElementById('mainContent');
                if (mainContent) {
                    mainContent.innerHTML = `
                        <div style="background: #fee; color: #c00; padding: 20px; margin: 20px; border-radius: 8px;">
                            <h2>Dashboard Loading Error</h2>
                            <p>There was an error loading the dashboard:</p>
                            <pre>${error.message}</pre>
                            <p>Please check the browser console for more details.</p>
                        </div>
                    `;
                }
            }
        });
        
        // Global error handler
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Global error:', msg, 'at line:', lineNo, 'column:', columnNo);
            console.error('Error object:', error);
            return true;
        };
    </script>
</body>
</html>